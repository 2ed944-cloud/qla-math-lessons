<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>G7 ‚Ä¢ Unit 1 ‚Ä¢ Comparing & Simplifying Rational Numbers ‚Äî QLA Enhanced</title>

<!-- Fonts & Tailwind -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<!-- KaTeX (robust auto-render) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    const run = (root=document.body) => {
      if (!window.renderMathInElement) return;
      window.renderMathInElement(root, {
        delimiters: [
          { left: '$$', right: '$$', display: true },
          { left: '\\[', right: '\\]', display: true },
          { left: '\\(', right: '\\)', display: false }
        ],
        throwOnError: false
      });
    };
    if (window.renderMathInElement) run();
    else {
      const t=setInterval(()=>{ if(window.renderMathInElement){ clearInterval(t); run(); }},25);
      setTimeout(()=>clearInterval(t),6000);
    }
    window._rerenderMath = run;
  });
</script>

<style>
  :root{--maroon:#6C1D45;--gold:#C7A34F;--dark:#2C2C2E;--light:#F5F5F5;--accent:#E8D5B7;--qatar:#8D1B3D}
  html,body{height:100%;background:#2d3748;color:#111;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  #deck{position:relative;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;padding:10px}
  #slides{position:relative;width:100%;max-width:1280px;aspect-ratio:16/9;background:#fff;box-shadow:0 14px 36px rgba(0,0,0,.35);overflow:hidden;border-radius:18px}

  .slide{position:absolute;inset:0;padding:3.5%;display:flex;flex-direction:column;justify-content:flex-start;align-items:center;text-align:center;opacity:0;transform:translateY(14px) scale(.985);transition:.55s ease;pointer-events:none;overflow-y:auto}
  .slide.active{opacity:1;transform:none;pointer-events:auto}

  .bg-maroon{background-color:var(--maroon)} 
  .text-maroon{color:var(--maroon)} 
  .text-gold{color:var(--gold)}
  .text-qatar{color:var(--qatar)}
  .bg-qatar{background-color:var(--qatar)}
  .banner{width:100%;height:110px;background:#fff center/contain no-repeat;border-bottom:3px solid var(--gold);border-radius:10px}

  .card{border:1px solid #e5e7eb;border-radius:14px;background:#fafafa;transition:transform .2s,box-shadow .2s}
  .card:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.1)}
  .chip{display:inline-flex;align-items:center;gap:.5rem;background:rgba(0,0,0,.05);border-radius:9999px;padding:.35rem .75rem;cursor:pointer;transition:all .2s}
  .chip:hover{outline:2px solid var(--gold);transform:scale(1.05)}
  .btn{padding:.55rem 1rem;border-radius:999px;border:1px solid #e5e7eb;background:#fff;font-weight:700;cursor:pointer;transition:all .2s}
  .btn.maroon{background:var(--maroon);color:#fff;border-color:var(--maroon)}
  .btn.qatar{background:var(--qatar);color:#fff;border-color:var(--qatar)}
  .btn:hover{filter:brightness(0.95);transform:scale(1.02)}
  .btn:disabled{opacity:.5;cursor:not-allowed}

  #controls{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:.5rem;background:rgba(0,0,0,.55);padding:.4rem .6rem;border-radius:999px;z-index:20;backdrop-filter:blur(6px)}
  #controls button{width:42px;height:42px;border-radius:999px;border:none;background:#fff;cursor:pointer;font-weight:700;transition:transform .2s}
  #controls button:hover{transform:scale(1.06)}
  #counter{color:#fff;font-weight:700;min-width:84px;text-align:center}
  #progress{position:fixed;left:0;bottom:0;height:5px;width:0;background:var(--gold);z-index:30;transition:width .35s ease}
  #fsHint{position:absolute;top:10px;right:12px;color:#fff;background:rgba(0,0,0,.35);padding:.25rem .5rem;border-radius:8px;font-size:.8rem}

  .hint{background:#fff3cd;border:1px solid #ffe69c;border-radius:10px;padding:.5rem .75rem;margin:.5rem 0}
  .student-instruction{background:#ddd6fe;border-left:4px solid #7c3aed;border-radius:10px;padding:.75rem 1rem;margin:.5rem 0;font-weight:600}
  .student-work{background:#fef3c7;border:2px dashed #f59e0b;border-radius:10px;padding:1rem;margin:.5rem 0;min-height:80px}
  .confetti{position:fixed;pointer-events:none;z-index:50}

  .sortable{list-style:none;padding:0;margin:0}
  .sortable li{user-select:none;background:#fff;border:1px solid #e5e7eb;border-radius:10px;margin:.3rem 0;padding:.6rem .8rem;cursor:grab;transition:all .2s}
  .sortable .dragging{opacity:.55;transform:scale(.98)}
  .sortable li:hover{background:#fafafa;box-shadow:0 2px 8px rgba(0,0,0,.1)}

  .level-badge{display:inline-block;padding:.25rem .5rem;border-radius:6px;font-size:.75rem;font-weight:700;margin-left:.5rem}
  .level-easy{background:#dcfce7;color:#166534}
  .level-medium{background:#fef3c7;color:#92400e}
  .level-hard{background:#fecaca;color:#991b1b}
  
  .student-name{display:inline-block;background:var(--gold);color:#fff;padding:.25rem .75rem;border-radius:999px;font-weight:700;margin:.25rem}
  
  .popup-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:100;align-items:center;justify-content:center}
  .popup-overlay.active{display:flex}
  .popup-content{background:#fff;border-radius:16px;padding:2rem;max-width:600px;max-height:80vh;overflow-y:auto}
  
  .board-area{background:#f8f9fa;border:3px solid var(--maroon);border-radius:12px;padding:1.5rem;min-height:200px;margin:1rem 0}
  
  .answer-reveal{background:#f0fdf4;border:2px solid #22c55e;border-radius:10px;padding:1rem;margin:.5rem 0;display:none}
  .answer-reveal.show{display:block}

  #pop{display:none;position:fixed;background:#fff;border:2px solid var(--gold);border-radius:12px;padding:1rem;box-shadow:0 8px 24px rgba(0,0,0,.2);z-index:90;max-width:400px}
  #pop .close{position:absolute;top:8px;right:12px;cursor:pointer;font-size:1.5rem;font-weight:700;color:#666}
  #pop .close:hover{color:#000}

  .interactive-zone{border:2px dashed #60a5fa;background:#eff6ff;border-radius:12px;padding:1rem;margin:1rem 0}
  
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}
  .pulse{animation:pulse 2s infinite}
  
  .qatar-context{border-left:4px solid var(--qatar);padding-left:1rem;margin:1rem 0}
</style>
</head>
<body>

<div id="deck" aria-live="polite">
  <div id="slides" class="relative">
    <div id="fsHint">Press <strong>F</strong> for fullscreen</div>

    <!-- 0 ‚Ä¢ Title -->
    <section class="slide active bg-maroon text-white" id="titleSlide">
      <div class="w-full h-16 banner mb-6 rounded-md" style="background-image:url('../assets/qla_banner.png')" aria-label="QLA Partner Banner"></div>
      <div class="flex items-center gap-8">
        <img src="../assets/qla_logo.png" alt="QLA Logo" class="h-20 w-auto" onerror="this.style.display='none'"/>
        <div class="text-left">
          <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight">Comparing & Simplifying Rational Numbers</h1>
          <p class="text-gold text-2xl md:text-3xl mt-2 font-semibold">Fractions ‚Ä¢ Decimals ‚Ä¢ Mixed Numbers ‚Ä¢ Order & Equivalence</p>
          <p class="mt-2 text-lg">Qatar Leadership Academy ‚Äî Grade 7 ‚Ä¢ </p>
        </div>
      </div>
      <div class="absolute bottom-6 text-sm text-gray-100">Aligned to AERO 7.NS.1 & 7.NS.2 | Qatar Context Integrated</div>
    </section>

    <!-- 1 ‚Ä¢ Learning Objectives & Success Criteria -->
    <section class="slide" id="loSlide">
      <h2 class="text-4xl font-extrabold text-maroon mb-3">Learning Objectives & Success Criteria</h2>
      
      <div class="student-instruction text-left max-w-5xl mb-3">
        <strong>ü§î Think & Share:</strong> When have you used fractions in your daily life in Qatar? Think about shopping, sharing food, or cooking. Share one example with your partner.
      </div>

      <div class="grid md:grid-cols-2 gap-6 text-left max-w-5xl">
        <div class="card p-5">
          <h3 class="text-2xl font-bold text-maroon mb-2">By the end of this lesson, I can:</h3>
          <ul class="list-disc list-inside space-y-2 text-lg">
            <li>‚úì Simplify fractions to <b>simplest form</b> using GCF</li>
            <li>‚úì Compare rational numbers using <b>3 different methods</b></li>
            <li>‚úì Order rational numbers from least to greatest</li>
            <li>‚úì Apply these skills to <b>Qatar real-world problems</b></li>
            <li>‚úì Explain my thinking clearly to others</li>
          </ul>
        </div>
        <div class="card p-5">
          <h3 class="text-2xl font-bold text-maroon mb-2">Key Vocabulary (Click to Explore)</h3>
          <div class="flex flex-wrap gap-2 text-lg">
            <span class="chip" data-key="rat">rational number</span>
            <span class="chip" data-key="eqv">equivalent fractions</span>
            <span class="chip" data-key="simp">simplest form</span>
            <span class="chip" data-key="gcf">GCF</span>
            <span class="chip" data-key="lcd">LCD</span>
            <span class="chip" data-key="cross">cross-multiplication</span>
            <span class="chip" data-key="mixed">mixed number</span>
          </div>
          <div class="mt-3">
            <button class="btn maroon" onclick="openVocabQuiz()">Vocabulary Challenge</button>
          </div>
        </div>
      </div>

      <div class="interactive-zone max-w-5xl mt-4">
        <strong>Quick Check:</strong> Turn to your partner and explain what a rational number is in your own words.
      </div>
    </section>

    <!-- 2 ‚Ä¢ Warm-Up: Real Qatar Context -->
    <section class="slide" id="warmupSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Warm-Up: Fractions Around Us in Qatar</h2>
      
      <div class="student-instruction text-left max-w-5xl">
        <strong>üìù Your Task:</strong> Look at the three scenarios below. Work with your group to solve each problem. Write your answers in the yellow boxes. Be ready to explain your thinking to the class!
      </div>

      <div class="grid md:grid-cols-3 gap-4 w-full max-w-5xl">
        <div class="card p-4 qatar-context">
          <h4 class="font-bold text-qatar">üõí Shopping at Carrefour</h4>
          <p class="text-sm mt-2">A 2 kg bag of rice costs 15 QAR. You buy \( \frac{3}{4} \) kg. How much do you pay?</p>
          <div class="student-work mt-2" contenteditable="true" data-answer="11.25"></div>
        </div>
        <div class="card p-4 qatar-context">
          <h4 class="font-bold text-qatar">‚öΩ Sports Day</h4>
          <p class="text-sm mt-2">In PE class, \( \frac{5}{8} \) of students chose football, \( \frac{3}{5} \) chose basketball. Which is more popular?</p>
          <div class="student-work mt-2" contenteditable="true" data-answer="football"></div>
        </div>
        <div class="card p-4 qatar-context">
          <h4 class="font-bold text-qatar">üèóÔ∏è Building Project</h4>
          <p class="text-sm mt-2">A construction project in Lusail is \( \frac{15}{20} \) complete. Simplify this fraction.</p>
          <div class="student-work mt-2" contenteditable="true" data-answer="3/4"></div>
        </div>
      </div>

      <div class="mt-4">
        <button class="btn maroon" onclick="checkWarmup()">Check Our Answers</button>
        <button class="btn" onclick="discussWarmup()">Class Discussion</button>
      </div>
      <div id="warmupFb" class="mt-2 font-semibold"></div>
    </section>

    <!-- 3 ‚Ä¢ Guided Exploration: Three Methods to Compare -->
    <section class="slide" id="methodsSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Three Methods to Compare Fractions</h2>
      
      <div class="student-instruction text-left max-w-5xl mb-3">
        <strong>üéì Learning Challenge:</strong> 
        We will explore three powerful methods to compare fractions. Click through each method, study the explanation and examples carefully. Practice with a classmate, and decide which method works best for you!
      </div>

      <div class="w-full max-w-5xl">
        <!-- Method 1 Container -->
        <div id="method1Container" class="card p-5 mb-4" style="display:block;">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-2xl font-bold text-maroon">Method 1: Common Denominator <span class="level-badge level-easy">Easy</span></h3>
          </div>
          
          <div class="grid md:grid-cols-2 gap-4 text-left">
            <div>
              <h4 class="font-bold text-lg mb-2 text-qatar">What is this method?</h4>
              <p class="mb-3">When fractions have the <strong>same denominator</strong>, we can easily compare them by looking at the numerators. This method converts both fractions to equivalent fractions with a common denominator (usually the LCD).</p>
              
              <div class="hint">
                <strong>Key Idea:</strong> \( \frac{9}{12} \) vs \( \frac{10}{12} \) is easy because we just compare 9 and 10!
              </div>

              <h4 class="font-bold text-lg mt-3 mb-2 text-qatar">When to use it?</h4>
              <ul class="list-disc list-inside text-sm space-y-1">
                <li>When denominators are small</li>
                <li>When you can easily find the LCD</li>
                <li>When adding/subtracting fractions later</li>
              </ul>
            </div>

            <div>
              <h4 class="font-bold text-lg mb-2 text-qatar">Example: Compare \( \frac{3}{4} \) and \( \frac{5}{6} \)</h4>
              <div class="board-area">
                <p class="font-bold mb-2">Step-by-Step Solution:</p>
                <ol class="list-decimal list-inside space-y-2">
                  <li><strong>Find the LCD of 4 and 6</strong>
                    <br/>Multiples of 4: 4, 8, <span class="text-maroon font-bold">12</span>, 16...
                    <br/>Multiples of 6: 6, <span class="text-maroon font-bold">12</span>, 18...
                    <br/>LCD = 12
                  </li>
                  <li><strong>Convert \( \frac{3}{4} \) to denominator 12</strong>
                    <br/>\( \frac{3}{4} = \frac{3 \times 3}{4 \times 3} = \frac{9}{12} \)
                  </li>
                  <li><strong>Convert \( \frac{5}{6} \) to denominator 12</strong>
                    <br/>\( \frac{5}{6} = \frac{5 \times 2}{6 \times 2} = \frac{10}{12} \)
                  </li>
                  <li><strong>Compare numerators:</strong>
                    <br/>9 < 10
                    <br/>Therefore: \( \frac{9}{12} < \frac{10}{12} \)
                  </li>
                  <li><strong>Conclusion:</strong> \( \frac{3}{4} < \frac{5}{6} \) ‚úì</li>
                </ol>
              </div>
            </div>
          </div>

          <div class="mt-4 text-center">
            <button class="btn maroon" onclick="showMethod(2)">Continue to Method 2 ‚Üí</button>
          </div>
        </div>

        <!-- Method 2 Container -->
        <div id="method2Container" class="card p-5 mb-4" style="display:none;">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-2xl font-bold text-maroon">Method 2: Cross-Multiplication <span class="level-badge level-medium">Medium</span></h3>
          </div>
          
          <div class="grid md:grid-cols-2 gap-4 text-left">
            <div>
              <h4 class="font-bold text-lg mb-2 text-qatar">What is this method?</h4>
              <p class="mb-3">Cross-multiplication is a quick shortcut! To compare \( \frac{a}{b} \) and \( \frac{c}{d} \), we multiply <strong>diagonally</strong> and compare the products.</p>
              
              <div class="hint">
                <strong>Key Idea:</strong> Multiply: \( a \times d \) and \( c \times b \)
                <br/>The larger product tells you which fraction is larger!
                <br/><span class="text-red-600">‚ö†Ô∏è Important: Only works when both denominators are positive!</span>
              </div>

              <h4 class="font-bold text-lg mt-3 mb-2 text-qatar">When to use it?</h4>
              <ul class="list-disc list-inside text-sm space-y-1">
                <li>Quick comparison needed</li>
                <li>When LCD is hard to find</li>
                <li>With positive denominators only</li>
                <li>For multiple choice questions</li>
              </ul>
            </div>

            <div>
              <h4 class="font-bold text-lg mb-2 text-qatar">Example: Compare \( \frac{3}{4} \) and \( \frac{5}{6} \)</h4>
              <div class="board-area">
                <p class="font-bold mb-2">Step-by-Step Solution:</p>
                <ol class="list-decimal list-inside space-y-2">
                  <li><strong>Write the fractions</strong>
                    <br/>\( \frac{3}{4} \) ? \( \frac{5}{6} \)
                  </li>
                  <li><strong>Cross-multiply LEFT fraction</strong>
                    <br/>Multiply numerator of left √ó denominator of right
                    <br/>\( 3 \times 6 = 18 \)
                  </li>
                  <li><strong>Cross-multiply RIGHT fraction</strong>
                    <br/>Multiply numerator of right √ó denominator of left
                    <br/>\( 5 \times 4 = 20 \)
                  </li>
                  <li><strong>Compare the products:</strong>
                    <br/>18 < 20
                    <br/>Since the LEFT product is smaller, the LEFT fraction is smaller
                  </li>
                  <li><strong>Conclusion:</strong> \( \frac{3}{4} < \frac{5}{6} \) ‚úì</li>
                </ol>
                
                <div class="mt-3 p-2 bg-blue-50 rounded border border-blue-200">
                  <strong>Visual:</strong> Think of it like this:
                  <br/>\( \frac{3}{4} \) gives 18 points
                  <br/>\( \frac{5}{6} \) gives 20 points
                  <br/>More points = bigger fraction!
                </div>
              </div>
            </div>
          </div>

          <div class="mt-4 text-center flex gap-2 justify-center">
            <button class="btn" onclick="showMethod(1)">‚Üê Back to Method 1</button>
            <button class="btn maroon" onclick="showMethod(3)">Continue to Method 3 ‚Üí</button>
          </div>
        </div>

        <!-- Method 3 Container -->
        <div id="method3Container" class="card p-5 mb-4" style="display:none;">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-2xl font-bold text-maroon">Method 3: Decimal Conversion <span class="level-badge level-hard">Advanced</span></h3>
          </div>
          
          <div class="grid md:grid-cols-2 gap-4 text-left">
            <div>
              <h4 class="font-bold text-lg mb-2 text-qatar">What is this method?</h4>
              <p class="mb-3">Convert each fraction to its <strong>decimal form</strong> by dividing the numerator by the denominator. Then compare the decimals just like regular numbers!</p>
              
              <div class="hint">
                <strong>Key Idea:</strong> \( \frac{3}{4} = 3 \div 4 = 0.75 \)
                <br/>Comparing 0.75 and 0.833 is easier than comparing fractions!
              </div>

              <h4 class="font-bold text-lg mt-3 mb-2 text-qatar">When to use it?</h4>
              <ul class="list-disc list-inside text-sm space-y-1">
                <li>When you have a calculator</li>
                <li>When fractions have large denominators</li>
                <li>When comparing many fractions at once</li>
                <li>In real-world contexts (money, measurements)</li>
              </ul>

              <div class="hint mt-3">
                <strong>Pro Tip:</strong> Some fractions give repeating decimals like \( \frac{1}{3} = 0.333... \)
                <br/>Use at least 3 decimal places for accuracy!
              </div>
            </div>

            <div>
              <h4 class="font-bold text-lg mb-2 text-qatar">Example: Compare \( \frac{3}{4} \) and \( \frac{5}{6} \)</h4>
              <div class="board-area">
                <p class="font-bold mb-2">Step-by-Step Solution:</p>
                <ol class="list-decimal list-inside space-y-2">
                  <li><strong>Convert \( \frac{3}{4} \) to decimal</strong>
                    <br/>Divide: 3 √∑ 4 = 0.75
                    <br/>\( \frac{3}{4} = 0.75 \)
                  </li>
                  <li><strong>Convert \( \frac{5}{6} \) to decimal</strong>
                    <br/>Divide: 5 √∑ 6 = 0.8333...
                    <br/>\( \frac{5}{6} \approx 0.833 \) (rounded to 3 places)
                  </li>
                  <li><strong>Compare the decimals:</strong>
                    <br/>0.75 < 0.833
                    <br/>The smaller decimal means smaller fraction
                  </li>
                  <li><strong>Conclusion:</strong> \( \frac{3}{4} < \frac{5}{6} \) ‚úì</li>
                </ol>
                
                <div class="mt-3 p-2 bg-green-50 rounded border border-green-200">
                  <strong>Verification:</strong> All three methods give the same answer!
                  <br/>‚úì Method 1: \( \frac{9}{12} < \frac{10}{12} \)
                  <br/>‚úì Method 2: 18 < 20
                  <br/>‚úì Method 3: 0.75 < 0.833
                </div>
              </div>
            </div>
          </div>

          <div class="mt-4 text-center">
            <button class="btn" onclick="showMethod(2)">‚Üê Back to Method 2</button>
          </div>
        </div>

        <!-- Discussion Area -->
        <div id="methodDiscussion" style="display:none;">
          <div class="interactive-zone">
            <h4 class="font-bold text-xl mb-2">üéì Class Discussion Questions:</h4>
            <ol class="list-decimal list-inside space-y-2 text-left">
              <li>Which method do you find easiest? Why?</li>
              <li>When would you choose Method 1 over Method 2?</li>
              <li>Can you think of a situation where Method 3 would be best?</li>
              <li>Try this challenge: Compare \( \frac{7}{12} \) and \( \frac{11}{18} \) using your favorite method!</li>
              <li>What if one fraction is negative? Which methods still work?</li>
            </ol>
          </div>
        </div>
      </div>
    </section>

    <!-- 4 ‚Ä¢ Student-Led Practice: Come to the Board -->
    <section class="slide" id="boardSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Practice: Come to the Board!</h2>
      
      <div class="student-instruction text-left max-w-5xl mb-3">
        <strong>üôã Volunteer Opportunity:</strong> Four students will be selected to come to the board and solve one problem each. While they work, you should solve all problems in your notebook. Then we'll discuss the solutions together. Who's ready to show their skills?
      </div>

      <div class="grid md:grid-cols-2 gap-4 w-full max-w-5xl">
        <div class="card p-5">
          <div class="flex items-center justify-between mb-2">
            <h4 class="font-bold text-lg">Problem 1: Simplify</h4>
            <input type="text" id="student1Name" placeholder="Student name" class="border rounded px-2 py-1 text-sm"/>
          </div>
          <div class="text-xl mb-2">Simplify: \( \frac{84}{126} \)</div>
          <div class="board-area" id="board1" contenteditable="true"></div>
          <button class="btn maroon mt-2" onclick="revealAnswer(1, '2/3')">Show Answer</button>
          <div id="answer1" class="answer-reveal"></div>
        </div>

        <div class="card p-5">
          <div class="flex items-center justify-between mb-2">
            <h4 class="font-bold text-lg">Problem 2: Compare</h4>
            <input type="text" id="student2Name" placeholder="Student name" class="border rounded px-2 py-1 text-sm"/>
          </div>
          <div class="text-xl mb-2">Compare: \( \frac{7}{12} \) __ \( \frac{11}{18} \)</div>
          <div class="board-area" id="board2" contenteditable="true"></div>
          <button class="btn maroon mt-2" onclick="revealAnswer(2, '<')">Show Answer</button>
          <div id="answer2" class="answer-reveal"></div>
        </div>

        <div class="card p-5">
          <div class="flex items-center justify-between mb-2">
            <h4 class="font-bold text-lg">Problem 3: Qatar Context</h4>
            <input type="text" id="student3Name" placeholder="Student name" class="border rounded px-2 py-1 text-sm"/>
          </div>
          <div class="text-md mb-2">At Souq Waqif, mangoes are \( \frac{12}{20} \) off and dates are \( \frac{9}{15} \) off. Which discount is better?</div>
          <div class="board-area" id="board3" contenteditable="true"></div>
          <button class="btn maroon mt-2" onclick="revealAnswer(3, 'same')">Show Answer</button>
          <div id="answer3" class="answer-reveal"></div>
        </div>

        <div class="card p-5">
          <div class="flex items-center justify-between mb-2">
            <h4 class="font-bold text-lg">Problem 4: Mixed Challenge</h4>
            <input type="text" id="student4Name" placeholder="Student name" class="border rounded px-2 py-1 text-sm"/>
          </div>
          <div class="text-xl mb-2">Order: \( \frac{5}{8}, \frac{3}{5}, \frac{7}{10} \)</div>
          <div class="board-area" id="board4" contenteditable="true"></div>
          <button class="btn maroon mt-2" onclick="revealAnswer(4, '3/5, 5/8, 7/10')">Show Answer</button>
          <div id="answer4" class="answer-reveal"></div>
        </div>
      </div>

      <div class="mt-4">
        <button class="btn qatar" onclick="celebrateStudents()">Celebrate Student Work! üéâ</button>
      </div>
    </section>

    <!-- 5 ‚Ä¢ Differentiated Practice Stations -->
    <section class="slide" id="stationsSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Practice Stations (Differentiated)</h2>
      
      <div class="student-instruction text-left max-w-5xl mb-3">
        <strong>üéØ Choose Your Challenge Level:</strong> Select the level that matches where you are right now. Remember: it's okay to start at any level! You can always move up when you're ready. Growth mindset means challenging yourself at the right level.
      </div>

      <div class="flex gap-3 mb-4 justify-center">
        <button class="btn" onclick="selectStation('emerging')">üå± Emerging (Level 1)</button>
        <button class="btn" onclick="selectStation('developing')">üìö Developing (Level 2)</button>
        <button class="btn" onclick="selectStation('proficient')">‚≠ê Proficient (Level 3)</button>
        <button class="btn" onclick="selectStation('advanced')">üöÄ Advanced (Level 4)</button>
      </div>

      <div id="stationContent" class="w-full max-w-5xl"></div>
    </section>

    <!-- 6 ‚Ä¢ Qatar Real-World Applications -->
    <section class="slide" id="qatarSlide">
      <h2 class="text-3xl font-extrabold text-qatar mb-2">üá∂üá¶ Qatar Real-World Challenges</h2>
      
      <div class="student-instruction text-left max-w-5xl mb-3">
        <strong>üë• Group Work Time:</strong> Form groups of 3-4 students. Your group will tackle one real-world challenge from Qatar. Work together to find the solution, then choose one person to present your answer and explain your reasoning to the class. Show all your work!
      </div>

      <div class="grid md:grid-cols-2 gap-4 w-full max-w-5xl" id="qatarChallenges"></div>

      <div class="mt-4">
        <button class="btn maroon" onclick="newQatarChallenges()">New Challenge Set</button>
        <button class="btn qatar" onclick="checkQatarAnswers()">Check All Groups</button>
      </div>
      <div id="qatarFb" class="mt-2 font-semibold"></div>
    </section>

    <!-- 7 ‚Ä¢ Interactive Ordering Game -->
    <section class="slide" id="orderSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Ordering Challenge: Drag & Drop</h2>
      
      <div class="student-instruction text-left max-w-5xl mb-3">
        <strong>üéÆ Interactive Challenge:</strong> One student will come to the front to drag and arrange the numbers on the projected screen. The rest of the class: guide your classmate! Tell them where to place each number and explain why. Let's work together to get the correct order from LEAST to GREATEST.
      </div>

      <div class="card p-5 w-full max-w-4xl text-left">
        <div class="flex items-center gap-3 mb-3">
          <button id="orNew" class="btn maroon">New Set</button>
          <select id="orLevel" class="border rounded px-3 py-2">
            <option value="easy">Easy (Positive, Similar Denominators)</option>
            <option value="medium" selected>Medium (Mixed Forms)</option>
            <option value="hard">Hard (Negatives & Mixed Numbers)</option>
          </select>
          <button id="orHint" class="btn">Get Hint</button>
        </div>
        <div id="orHintBox" class="hint" style="display:none;"></div>
        <p class="text-lg mb-2"><strong>Drag to order from LEAST to GREATEST:</strong></p>
        <ul id="orList" class="sortable"></ul>
        <div class="mt-3">
          <button id="orCheck" class="btn qatar">Check Order</button>
          <button id="orReveal" class="btn">Show Correct Order</button>
          <div id="orFb" class="mt-2 h-6 font-semibold"></div>
        </div>
      </div>
    </section>

    <!-- 8 ‚Ä¢ Simplification Station with Scaffolding -->
    <section class="slide" id="simpSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Simplification Station</h2>
      
      <div class="student-instruction text-left max-w-5xl mb-3">
        <strong>üîç Guided Practice:</strong> 
        <ul class="list-disc list-inside ml-4 mt-2">
          <li>First, watch as we solve one example together as a class</li>
          <li>Then, try the practice problems independently</li>
          <li>Think aloud: What steps are you taking to find the GCF?</li>
          <li>Use the GCF Helper Tool if you need support</li>
          <li><strong>Challenge:</strong> Can you simplify without using the tool?</li>
        </ul>
      </div>

      <div class="card p-5 w-full max-w-5xl">
        <div class="flex gap-3 mb-3 flex-wrap">
          <select id="simpLevel" class="border rounded px-3 py-2">
            <option value="easy">Level 1: Small Numbers (2-20)</option>
            <option value="medium" selected>Level 2: Larger Numbers (20-100)</option>
            <option value="hard">Level 3: Challenge (100-200 & Negatives)</option>
          </select>
          <button id="simpNew" class="btn maroon">New Problems</button>
          <button class="btn" onclick="showGCFHelper()">GCF Helper Tool</button>
          <label class="flex items-center gap-2">
            <input type="checkbox" id="showSteps"/> Show working steps
          </label>
        </div>

        <div id="gcfHelper" class="hint" style="display:none;">
          <strong>GCF Quick Finder:</strong>
          <div class="flex gap-2 items-center mt-2">
            <input type="number" id="gcfA" placeholder="Number 1" class="border rounded px-2 py-1 w-24"/>
            <input type="number" id="gcfB" placeholder="Number 2" class="border rounded px-2 py-1 w-24"/>
            <button class="btn btn-sm" onclick="calculateGCF()">Calculate GCF</button>
            <span id="gcfResult" class="font-bold"></span>
          </div>
        </div>

        <div id="simpList" class="grid md:grid-cols-3 gap-3 mt-3"></div>
        
        <div class="mt-3 flex gap-2">
          <button id="simpCheck" class="btn qatar">Check My Answers</button>
          <button id="simpHint" class="btn">Need Help?</button>
          <div id="simpFb" class="mt-2 h-6 font-semibold ml-3"></div>
        </div>
      </div>
    </section>

    <!-- 9 ‚Ä¢ Comparison Tournament -->
    <section class="slide" id="tournamentSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">‚öîÔ∏è Comparison Tournament</h2>
      
      <div class="student-instruction text-left max-w-5xl mb-3">
        <strong>‚öîÔ∏è Team Competition Time:</strong> Your class is split into two teams. Each team will discuss the problem and submit one answer. Every correct answer = 1 point. First team to 5 points wins! Work together, discuss strategies, and support your teammates!
      </div>

      <div class="card p-5 w-full max-w-5xl">
        <div class="flex justify-between items-center mb-4">
          <div>
            <span class="text-xl font-bold">Team Scores:</span>
            <span class="student-name">Team 1: <span id="team1Score">0</span></span>
            <span class="student-name bg-qatar">Team 2: <span id="team2Score">0</span></span>
          </div>
          <select id="tournLevel" class="border rounded px-3 py-2">
            <option value="easy">Easy Mode</option>
            <option value="medium" selected>Medium Mode</option>
            <option value="hard">Challenge Mode</option>
          </select>
        </div>

        <div id="tournamentQuestion" class="board-area text-2xl mb-4"></div>

        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <h4 class="font-bold mb-2">Team 1 Answer:</h4>
            <select id="team1Answer" class="border rounded px-3 py-2 w-full text-xl">
              <option value="">Choose...</option>
              <option value="<">&lt;</option>
              <option value=">">&gt;</option>
              <option value="=">=</option>
            </select>
          </div>
          <div>
            <h4 class="font-bold mb-2">Team 2 Answer:</h4>
            <select id="team2Answer" class="border rounded px-3 py-2 w-full text-xl">
              <option value="">Choose...</option>
              <option value="<">&lt;</option>
              <option value=">">&gt;</option>
              <option value="=">=</option>
            </select>
          </div>
        </div>

        <div class="mt-4 flex gap-2">
          <button class="btn qatar" onclick="checkTournament()">Check Answers</button>
          <button class="btn maroon" onclick="newTournamentQ()">Next Question</button>
          <button class="btn" onclick="resetTournament()">Reset Tournament</button>
        </div>
        <div id="tournFb" class="mt-2 font-semibold"></div>
      </div>
    </section>

    <!-- 10 ‚Ä¢ Student Reflection & Self-Assessment -->
    <section class="slide" id="reflectSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Reflection & Self-Assessment</h2>
      
      <div class="student-instruction text-left max-w-5xl mb-3">
        <strong>üí≠ Time to Reflect on Your Learning:</strong> Take 3-5 minutes to think about today's lesson individually. Complete the self-assessment and exit ticket honestly - this helps you understand your own learning. Then, pair up with a partner and share your thoughts before we discuss as a whole class.
      </div>

      <div class="grid md:grid-cols-2 gap-6 w-full max-w-5xl">
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon mb-3">Self-Assessment Checklist</h3>
          <div class="space-y-2">
            <label class="flex items-start gap-2">
              <input type="checkbox" class="mt-1"/> 
              <span>I can simplify fractions by finding the GCF</span>
            </label>
            <label class="flex items-start gap-2">
              <input type="checkbox" class="mt-1"/> 
              <span>I can compare fractions using at least 2 methods</span>
            </label>
            <label class="flex items-start gap-2">
              <input type="checkbox" class="mt-1"/> 
              <span>I can order rational numbers correctly</span>
            </label>
            <label class="flex items-start gap-2">
              <input type="checkbox" class="mt-1"/> 
              <span>I can solve Qatar real-world problems</span>
            </label>
            <label class="flex items-start gap-2">
              <input type="checkbox" class="mt-1"/> 
              <span>I can explain my thinking to others</span>
            </label>
          </div>
          <div class="mt-4">
            <label class="block font-bold mb-1">My confidence level (1-10):</label>
            <input type="range" min="1" max="10" value="5" class="w-full" id="confidenceSlider" oninput="updateConfidence(this.value)"/>
            <div class="text-center text-2xl font-bold text-maroon"><span id="confidenceVal">5</span>/10</div>
          </div>
        </div>

        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon mb-3">3-2-1 Exit Ticket</h3>
          <div class="space-y-3">
            <div>
              <label class="font-bold">3 things I learned today:</label>
              <textarea class="w-full border rounded p-2 mt-1" rows="2" placeholder="Type here..."></textarea>
            </div>
            <div>
              <label class="font-bold">2 methods I can use confidently:</label>
              <textarea class="w-full border rounded p-2 mt-1" rows="2" placeholder="Type here..."></textarea>
            </div>
            <div>
              <label class="font-bold">1 question I still have:</label>
              <textarea class="w-full border rounded p-2 mt-1" rows="2" placeholder="Type here..."></textarea>
            </div>
          </div>
          <button class="btn maroon mt-3 w-full" onclick="saveReflection()">Save My Reflection</button>
        </div>
      </div>
    </section>

    <!-- 11 ‚Ä¢ Next Steps & Extension -->
    <section class="slide" id="exitSlide">
      <h2 class="text-4xl font-extrabold text-maroon mb-3">üéØ Next Steps & Extensions</h2>
      
      <div class="grid md:grid-cols-2 gap-6 text-left max-w-5xl">
        <div class="card p-5">
          <h3 class="text-xl font-bold text-qatar mb-2">üè† Homework Options (Choose Your Challenge)</h3>
          <div class="space-y-2">
            <div class="p-3 border rounded">
              <strong class="level-badge level-easy">Level 1:</strong> Complete 10 simplification problems from workbook p.42
            </div>
            <div class="p-3 border rounded">
              <strong class="level-badge level-medium">Level 2:</strong> Create a Qatar shopping scenario using fractions and solve it
            </div>
            <div class="p-3 border rounded">
              <strong class="level-badge level-hard">Level 3:</strong> Research: How are fractions used in Islamic architecture in Qatar? (Symmetry, geometric patterns)
            </div>
          </div>
        </div>

        <div class="card p-5">
          <h3 class="text-xl font-bold text-qatar mb-2">üöÄ Coming Next</h3>
          <ul class="list-disc list-inside space-y-2">
            <li><strong>Prime Factorization Toolkit</strong> - Master GCF and LCM</li>
            <li><strong>Adding & Subtracting Rationals</strong> - Build on today's LCD skills</li>
            <li><strong>Qatar STEM Project</strong> - Design a scaled model using ratios</li>
          </ul>
          
          <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded">
            <strong>üì± Digital Resources:</strong>
            <ul class="text-sm ml-4 mt-2">
              <li>‚Ä¢ Khan Academy: Rational Numbers</li>
              <li>‚Ä¢ IXL: Grade 7 Qatar Standards</li>
              <li>‚Ä¢ Desmos: Fraction Calculator</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="absolute bottom-4 left-1/2 -translate-x-1/2 w-[88%] h-[100px] banner rounded-md" style="background-image:url('../assets/qla_banner.png')"></div>
    </section>

  </div>
</div>

<!-- Controls -->
<div id="controls" role="group" aria-label="Slideshow controls">
  <button id="prev" title="Previous (‚Üê)">&laquo;</button>
  <button id="fs" title="Toggle Fullscreen (F)">‚§¢</button>
  <div id="counter">1 / 12</div>
  <button id="next" title="Next (‚Üí)">&raquo;</button>
</div>
<div id="progress"></div>

<!-- Glossary popover -->
<div id="pop" role="dialog" aria-modal="true" aria-live="polite">
  <span class="close" title="Close">‚úï</span>
  <div id="popBody"></div>
</div>

<!-- Popup for vocab quiz -->
<div id="vocabPopup" class="popup-overlay">
  <div class="popup-content">
    <h3 class="text-2xl font-bold text-maroon mb-4">Vocabulary Challenge</h3>
    <div id="vocabQuizContent"></div>
    <button class="btn maroon mt-4" onclick="closeVocabQuiz()">Close</button>
  </div>
</div>

<script>
/* ======================= Core Navigation & Utilities ======================= */
(function(){
  const slides=[...document.querySelectorAll('.slide')];
  const prev=document.getElementById('prev'), next=document.getElementById('next'), 
        counter=document.getElementById('counter'), progress=document.getElementById('progress'), 
        fsBtn=document.getElementById('fs');
  const deckTitle='G7_Qatar_Rationals_Enhanced';
  let slideIndex=0;

  function renderMath(root=document.body){ 
    if(window._rerenderMath) window._rerenderMath(root); 
  }

  function confetti(x=window.innerWidth/2,y=window.innerHeight/2){
    for(let k=0;k<25;k++){
      const d=document.createElement('div'); 
      d.className='confetti';
      d.style.left=x+'px'; 
      d.style.top=y+'px'; 
      d.style.width='10px'; 
      d.style.height='10px';
      d.style.background=['#6C1D45','#C7A34F','#E8D5B7','#8D1B3D','#22c55e'][k%5];
      document.body.appendChild(d);
      const dx=(Math.random()*2-1)*280, dy=(Math.random()*-1-0.4)*350, rot=Math.random()*720;
      d.animate([
        {transform:'translate(0,0) rotate(0deg)', opacity:1},
        {transform:`translate(${dx}px,${dy}px) rotate(${rot}deg)`, opacity:0}
      ],{duration:1000+Math.random()*800,easing:'cubic-bezier(.2,.8,.2,1)'}).onfinish=()=>d.remove();
    }
  }

  function showSlide(k){
    slideIndex=(k+slides.length)%slides.length;
    slides.forEach((s,idx)=>s.classList.toggle('active',idx===slideIndex));
    counter.textContent=(slideIndex+1)+' / '+slides.length;
    progress.style.width=((slideIndex+1)/slides.length*100)+'%';
    renderMath(slides[slideIndex]);
  }

  prev.addEventListener('click',()=>showSlide(slideIndex-1));
  next.addEventListener('click',()=>showSlide(slideIndex+1));
  document.addEventListener('keydown',e=>{
    if(e.key==='ArrowRight') showSlide(slideIndex+1);
    if(e.key==='ArrowLeft') showSlide(slideIndex-1);
    if(e.key.toLowerCase()==='f') toggleFS();
  });

  function toggleFS(){
    const el=document.getElementById('slides');
    if(!document.fullscreenElement){
      (el.requestFullscreen||el.webkitRequestFullscreen||el.msRequestFullscreen).call(el);
    } else {
      (document.exitFullscreen||document.webkitExitFullscreen||document.msExitFullscreen).call(document);
    }
  }
  fsBtn.addEventListener('click',toggleFS);

  /* Glossary */
  const POP=document.getElementById('pop'), POP_BODY=document.getElementById('popBody');
  const GLOSSARY={
    rat:'<strong>Rational Number:</strong> Any number that can be written as \\(\\tfrac{a}{b}\\) where a and b are integers and b\\(\\ne\\)0. Examples: \\(\\tfrac{3}{4}\\), 0.5, -2, \\(2\\tfrac{1}{3}\\)',
    eqv:'<strong>Equivalent Fractions:</strong> Fractions that represent the same value. Example: \\(\\tfrac{2}{3}=\\tfrac{4}{6}=\\tfrac{8}{12}\\)',
    simp:'<strong>Simplest Form:</strong> A fraction where the numerator and denominator have no common factors other than 1. Example: \\(\\tfrac{6}{8}\\) simplifies to \\(\\tfrac{3}{4}\\)',
    gcf:'<strong>Greatest Common Factor (GCF):</strong> The largest positive integer that divides both numbers. Example: GCF of 12 and 18 is 6.',
    lcd:'<strong>Least Common Denominator (LCD):</strong> The smallest common multiple of denominators, useful for comparing and adding fractions.',
    cross:'<strong>Cross-Multiplication:</strong> For \\(\\tfrac{a}{b}\\) vs \\(\\tfrac{c}{d}\\) (with b,d>0), compare ad and bc. The larger product corresponds to the larger fraction.',
    mixed:'<strong>Mixed Number:</strong> A whole number plus a proper fraction. Example: \\(2\\tfrac{1}{3}=\\tfrac{7}{3}\\)'
  };

  POP.querySelector('.close').addEventListener('click',()=>POP.style.display='none');
  document.addEventListener('click',e=>{
    const chip=e.target.closest('.chip[data-key]');
    if(!chip) return;
    const key=chip.dataset.key;
    if(!GLOSSARY[key]) return;
    POP_BODY.innerHTML=GLOSSARY[key];
    POP.style.display='block';
    const r=chip.getBoundingClientRect();
    POP.style.left=Math.min(r.left, window.innerWidth-POP.offsetWidth-20)+'px';
    POP.style.bottom=(window.innerHeight-r.top+10)+'px';
    renderMath(POP_BODY);
  });

  /* Math utilities */
  window.gcd=(a,b)=>{
    a=Math.abs(Math.trunc(a));
    b=Math.abs(Math.trunc(b));
    while(b){[a,b]=[b,a%b]}
    return a||1
  };
  window.simplify=(n,d)=>{
    let g=gcd(n,d); 
    if(d<0) g=-g; 
    return [n/g,d/g]
  };
  window.toLatex=(n,d)=> d===1? String(n):`\\dfrac{${n}}{${d}}`;
  window.randomInt=(a,b)=> Math.floor(Math.random()*(b-a+1))+a;
  window.randFrom=(arr)=> arr[Math.floor(Math.random()*arr.length)];
  window.nonzeroRand=(a,b)=>{
    let x=0; 
    while(x===0){x=randomInt(a,b)} 
    return x
  };

  showSlide(0);
  window.confetti = confetti;
  window.renderMath = renderMath;
})();

/* ======================= Warm-Up Functions ======================= */
function checkWarmup(){
  const areas = document.querySelectorAll('.student-work');
  let score = 0;
  areas.forEach((area,idx)=>{
    const answer = area.dataset.answer;
    const userAnswer = area.textContent.trim().toLowerCase();
    // Simple checking
    if(userAnswer.includes(answer.toLowerCase())) score++;
  });
  const fb = document.getElementById('warmupFb');
  if(score === areas.length){
    fb.textContent = 'üéâ Excellent start, class!';
    fb.className = 'mt-2 font-semibold text-green-600';
    confetti();
  } else {
    fb.textContent = `Good effort! ${score}/${areas.length} correct. Let's discuss.`;
    fb.className = 'mt-2 font-semibold text-yellow-600';
  }
}

function discussWarmup(){
  alert('Teacher: Lead class discussion. Ask students to explain their reasoning. Highlight different approaches.');
}

/* ======================= Methods Demonstration ======================= */
function showMethod(methodNum){
  // Hide all methods first
  document.getElementById('method1Container').style.display = 'none';
  document.getElementById('method2Container').style.display = 'none';
  document.getElementById('method3Container').style.display = 'none';
  document.getElementById('methodDiscussion').style.display = 'none';
  
  // Show the requested method
  if(methodNum === 1){
    document.getElementById('method1Container').style.display = 'block';
  } else if(methodNum === 2){
    document.getElementById('method2Container').style.display = 'block';
  } else if(methodNum === 3){
    document.getElementById('method3Container').style.display = 'block';
    // After method 3, show discussion questions
    document.getElementById('methodDiscussion').style.display = 'block';
  }
  
  // Re-render math
  renderMath(document.getElementById('methodsSlide'));
  
  // Smooth scroll to top of slide
  document.getElementById('methodsSlide').scrollTop = 0;
}

/* ======================= Board Work Functions ======================= */
function revealAnswer(num, answer){
  const box = document.getElementById('answer'+num);
  box.classList.add('show');
  const studentName = document.getElementById('student'+num+'Name').value || 'Student';
  
  const explanations = {
    1: `<strong>Solution:</strong> GCF of 84 and 126 is 42. Divide both by 42: \\(\\frac{84√∑42}{126√∑42} = \\frac{2}{3}\\)`,
    2: `<strong>Solution:</strong> Cross multiply: 7√ó18=126, 11√ó12=132. Since 126<132, we have \\(\\frac{7}{12} < \\frac{11}{18}\\)`,
    3: `<strong>Solution:</strong> Simplify both: \\(\\frac{12}{20}=\\frac{3}{5}\\) and \\(\\frac{9}{15}=\\frac{3}{5}\\). They're the SAME!`,
    4: `<strong>Solution:</strong> Convert to decimals or common denominator. Order: \\(\\frac{3}{5}=0.6, \\frac{5}{8}=0.625, \\frac{7}{10}=0.7\\)`
  };
  
  box.innerHTML = `‚úÖ <strong>${studentName}'s solution:</strong> ${answer}<br>${explanations[num]}`;
  renderMath(box);
  confetti();
}

function celebrateStudents(){
  const names = [];
  for(let i=1; i<=4; i++){
    const name = document.getElementById('student'+i+'Name').value;
    if(name) names.push(name);
  }
  if(names.length > 0){
    alert(`üéâ Outstanding work by: ${names.join(', ')}! Keep up the excellent mathematical thinking!`);
    confetti();
  } else {
    alert('Add student names to celebrate their work!');
  }
}

/* ======================= Differentiated Stations ======================= */
function selectStation(level){
  const content = document.getElementById('stationContent');
  const stations = {
    emerging: {
      title: 'üå± Emerging: Building Foundations',
      desc: 'Focus on basic concepts with visual support',
      tasks: [
        {q:'Simplify: \\(\\frac{6}{8}\\)', hint:'Both divisible by 2'},
        {q:'Compare: \\(\\frac{2}{5}\\) vs \\(\\frac{3}{5}\\)', hint:'Same denominator!'},
        {q:'Which is bigger: \\(\\frac{1}{2}\\) or \\(\\frac{1}{3}\\)?', hint:'Draw a picture'},
        {q:'Simplify: \\(\\frac{10}{15}\\)', hint:'Both divisible by 5'}
      ]
    },
    developing: {
      title: 'üìö Developing: Building Skills',
      desc: 'Practice with guidance available',
      tasks: [
        {q:'Simplify: \\(\\frac{24}{36}\\)', hint:'Find GCF of 24 and 36'},
        {q:'Compare: \\(\\frac{3}{4}\\) vs \\(\\frac{5}{6}\\)', hint:'Use cross-multiplication'},
        {q:'Order: \\(\\frac{1}{2}, \\frac{2}{3}, \\frac{3}{5}\\)', hint:'Convert to decimals or LCD'},
        {q:'Qatar: \\(\\frac{18}{24}\\) of students walk to school. Simplify.', hint:'GCF = 6'}
      ]
    },
    proficient: {
      title: '‚≠ê Proficient: Applying Skills',
      desc: 'Independent work with complex problems',
      tasks: [
        {q:'Simplify: \\(\\frac{-45}{75}\\)', hint:'Don\'t forget the negative sign'},
        {q:'Compare: \\(\\frac{7}{12}\\) vs \\(\\frac{11}{18}\\)', hint:'LCD=36'},
        {q:'Order: \\(\\frac{5}{8}, -\\frac{1}{4}, 0.6, \\frac{3}{5}\\)', hint:'Mix of forms'},
        {q:'If \\(\\frac{x}{20}=\\frac{3}{4}\\), find x', hint:'Cross multiply'}
      ]
    },
    advanced: {
      title: 'üöÄ Advanced: Extended Thinking',
      desc: 'Challenge problems requiring deep understanding',
      tasks: [
        {q:'Find three fractions between \\(\\frac{1}{3}\\) and \\(\\frac{1}{2}\\)', hint:'Use larger denominators'},
        {q:'Prove: \\(\\frac{a}{b}<\\frac{c}{d}\\) iff ad<bc (when b,d>0)', hint:'Use algebra'},
        {q:'Qatar: Design a recipe scaling project using fractions', hint:'Real application'},
        {q:'Investigate: Are all terminating decimals rational?', hint:'Convert to fractions'}
      ]
    }
  };

  const station = stations[level];
  let html = `<div class="card p-5">
    <h3 class="text-2xl font-bold text-maroon mb-2">${station.title}</h3>
    <p class="text-gray-600 mb-4">${station.desc}</p>
    <div class="space-y-4">`;
  
  station.tasks.forEach((task,idx)=>{
    html += `<div class="border p-3 rounded">
      <div class="font-bold">Task ${idx+1}:</div>
      <div class="text-lg mt-1">${task.q}</div>
      <textarea class="w-full border rounded p-2 mt-2" rows="2" placeholder="Show your work here..."></textarea>
      <button class="btn btn-sm mt-2" onclick="showHint('${task.hint}')">üí° Hint</button>
    </div>`;
  });
  
  html += `</div></div>`;
  content.innerHTML = html;
  renderMath(content);
}

function showHint(hint){
  alert('Hint: ' + hint);
}

/* ======================= Qatar Real-World Challenges ======================= */
const qatarProblems = [
  {
    scenario: 'üè™ At Lulu Hypermarket',
    problem: 'Dates are on sale: \\(\\frac{2}{5}\\) off regular price vs \\(\\frac{3}{8}\\) off premium dates. Which discount is better?',
    answer: '2/5',
    explain: 'Convert to LCD=40: \\(\\frac{2}{5}=\\frac{16}{40}\\), \\(\\frac{3}{8}=\\frac{15}{40}\\). First is better!'
  },
  {
    scenario: 'üèóÔ∏è Lusail Stadium Construction',
    problem: 'Phase 1 completed \\(\\frac{15}{25}\\) of work. Phase 2 completed \\(\\frac{18}{30}\\). Which phase did more?',
    answer: 'same',
    explain: 'Both simplify to \\(\\frac{3}{5}\\)!'
  },
  {
    scenario: '‚õΩ Fuel Efficiency',
    problem: 'Car A: \\(\\frac{7}{8}\\) tank remains. Car B: 0.85 tank remains. Which has more fuel?',
    answer: 'B',
    explain: '\\(\\frac{7}{8}=0.875\\) but 0.875 < 0.85 is wrong! 0.875 > 0.85, so A has more!'
  },
  {
    scenario: 'üìö Class Survey',
    problem: '\\(\\frac{12}{30}\\) students prefer Arabic literature, \\(\\frac{2}{5}\\) prefer English. Same or different?',
    answer: 'same',
    explain: '\\(\\frac{12}{30}=\\frac{2}{5}\\) after simplifying by 6'
  },
  {
    scenario: 'üå°Ô∏è Temperature Change',
    problem: 'Temperature dropped \\(\\frac{9}{12}\\) degrees in morning, \\(\\frac{5}{8}\\) in evening. When was drop bigger?',
    answer: 'morning',
    explain: '\\(\\frac{9}{12}=\\frac{3}{4}=0.75\\), \\(\\frac{5}{8}=0.625\\). Morning bigger!'
  },
  {
    scenario: 'üé® Art Project',
    problem: 'Mixing paint: \\(\\frac{24}{36}\\) red in Mix A, \\(\\frac{18}{27}\\) in Mix B. Same shade?',
    answer: 'same',
    explain: 'Both equal \\(\\frac{2}{3}\\) when simplified'
  }
];

function newQatarChallenges(){
  const box = document.getElementById('qatarChallenges');
  box.innerHTML = '';
  const selected = [];
  while(selected.length < 4){
    const prob = randFrom(qatarProblems);
    if(!selected.includes(prob)) selected.push(prob);
  }
  
  selected.forEach((p,idx)=>{
    const card = document.createElement('div');
    card.className = 'card p-4 qatar-context';
    card.innerHTML = `
      <h4 class="font-bold text-qatar mb-2">${p.scenario}</h4>
      <div class="text-md mb-2">${p.problem}</div>
      <input type="text" class="qAnswer border rounded px-3 py-2 w-full" placeholder="Your answer..." data-correct="${p.answer}" data-explain="${p.explain}"/>
      <div class="qFeedback mt-2 text-sm"></div>
    `;
    box.appendChild(card);
  });
  renderMath(box);
}

function checkQatarAnswers(){
  const inputs = document.querySelectorAll('.qAnswer');
  let correct = 0;
  inputs.forEach(input=>{
    const ans = input.value.trim().toLowerCase();
    const correctAns = input.dataset.correct.toLowerCase();
    const feedback = input.nextElementSibling;
    if(ans === correctAns || ans.includes(correctAns)){
      feedback.innerHTML = `‚úÖ Correct! ${input.dataset.explain}`;
      feedback.className = 'qFeedback mt-2 text-sm text-green-600';
      correct++;
    } else {
      feedback.innerHTML = `‚ùå Try again. Hint: ${input.dataset.explain}`;
      feedback.className = 'qFeedback mt-2 text-sm text-red-600';
    }
    renderMath(feedback);
  });
  
  const fb = document.getElementById('qatarFb');
  if(correct === inputs.length){
    fb.textContent = 'üéâ All groups mastered Qatar applications!';
    fb.className = 'mt-2 font-semibold text-green-600';
    confetti();
  } else {
    fb.textContent = `${correct}/${inputs.length} correct. Keep working!`;
    fb.className = 'mt-2 font-semibold text-yellow-600';
  }
}

/* ======================= Ordering Challenge ======================= */
let orderState = {items:[], correct:[]};

function newOrderSet(){
  const level = document.getElementById('orLevel').value;
  const items = [];
  
  if(level==='easy'){
    const den = randFrom([6,8,10,12]);
    for(let i=0; i<5; i++){
      items.push({n:randomInt(1,den-1), d:den});
    }
  } else if(level==='medium'){
    for(let i=0; i<5; i++){
      const type = Math.random();
      if(type<0.4){ // fraction
        items.push({n:randomInt(1,15), d:randFrom([6,8,10,12])});
      } else { // decimal as fraction
        const dec = randomInt(10,95)/100;
        items.push({n:Math.round(dec*100), d:100});
      }
    }
  } else { // hard
    for(let i=0; i<6; i++){
      const sign = Math.random()<0.3 ? -1 : 1;
      items.push({n:sign*randomInt(1,20), d:randFrom([6,8,10,12,15])});
    }
  }
  
  orderState.items = [...items];
  // Calculate correct order
  orderState.correct = items.slice().sort((a,b)=> a.n*b.d - b.n*a.d);
  
  const ul = document.getElementById('orList');
  ul.innerHTML = '';
  items.forEach((fr,idx)=>{
    const li = document.createElement('li');
    li.draggable = true;
    li.dataset.idx = idx;
    li.innerHTML = `<span class="handle mr-2" style="cursor:grab">‚Üï</span> \\(${toLatex(fr.n,fr.d)}\\)`;
    ul.appendChild(li);
  });
  
  renderMath(ul);
  makeSortable(ul);
  document.getElementById('orFb').textContent = '';
  document.getElementById('orHintBox').style.display = 'none';
}

function makeSortable(ul){
  let dragging=null;
  ul.querySelectorAll('li').forEach(li=>{
    li.addEventListener('dragstart',()=>{ dragging=li; li.classList.add('dragging'); });
    li.addEventListener('dragend',()=>{ dragging=null; li.classList.remove('dragging'); });
  });
  ul.addEventListener('dragover',e=>{
    e.preventDefault();
    const after=[...ul.querySelectorAll('li:not(.dragging)')].find(li=>
      e.clientY < li.getBoundingClientRect().top+li.offsetHeight/2
    );
    if(after) ul.insertBefore(dragging, after);
    else ul.appendChild(dragging);
  });
}

document.getElementById('orNew').addEventListener('click', newOrderSet);
document.getElementById('orCheck').addEventListener('click', ()=>{
  const lis = [...document.getElementById('orList').children];
  const current = lis.map(li=>orderState.items[Number(li.dataset.idx)]);
  const correct = current.every((fr,i,arr)=>
    i===0 || arr[i-1].n*fr.d <= fr.n*arr[i-1].d
  );
  
  const fb = document.getElementById('orFb');
  if(correct){
    fb.textContent = 'üéØ Perfect order!';
    fb.className = 'mt-2 h-6 font-semibold text-green-600';
    confetti();
  } else {
    fb.textContent = '‚ùå Not quite. Try again or use hint.';
    fb.className = 'mt-2 h-6 font-semibold text-red-600';
  }
});

document.getElementById('orHint').addEventListener('click', ()=>{
  const box = document.getElementById('orHintBox');
  box.style.display = 'block';
  box.textContent = 'üí° Hint: Convert all to decimals or find a common denominator to compare.';
});

document.getElementById('orReveal').addEventListener('click', ()=>{
  const correct = orderState.correct.map(fr=>toLatex(fr.n,fr.d)).join(' < ');
  alert('Correct order: ' + correct);
});

/* ======================= Simplification Station ======================= */
let simpState = {items:[]};

function newSimpSet(){
  const level = document.getElementById('simpLevel').value;
  const items = [];
  
  for(let i=0; i<6; i++){
    let a,b;
    if(level==='easy'){
      a = randomInt(2,20);
      b = randomInt(2,20);
    } else if(level==='medium'){
      a = randomInt(20,100);
      b = randomInt(20,100);
    } else {
      a = nonzeroRand(-200,200);
      b = randomInt(20,200);
    }
    // Make half reducible
    if(Math.random()<0.5){
      const k = randFrom([2,3,4,5,6]);
      a *= k;
      b *= k;
    }
    items.push([a,b]);
  }
  
  simpState.items = items;
  const box = document.getElementById('simpList');
  box.innerHTML = '';
  
  items.forEach((fr,idx)=>{
    const card = document.createElement('div');
    card.className = 'card p-3';
    const [a,b] = fr;
    card.innerHTML = `
      <div class="font-bold text-sm mb-1">Problem ${idx+1}</div>
      <div class="text-lg">\\(${toLatex(a,b)} = \\)</div>
      <div class="flex gap-1 mt-2">
        <input type="number" class="simpN border rounded px-2 py-1 w-20" placeholder="num"/>
        <span class="self-center">/</span>
        <input type="number" class="simpD border rounded px-2 py-1 w-20" placeholder="den"/>
      </div>
    `;
    box.appendChild(card);
  });
  renderMath(box);
}

document.getElementById('simpNew').addEventListener('click', newSimpSet);
document.getElementById('simpCheck').addEventListener('click', ()=>{
  const cards = document.querySelectorAll('#simpList .card');
  let correct = 0;
  
  cards.forEach((card,idx)=>{
    const [a,b] = simpState.items[idx];
    const want = simplify(a,b);
    const n = Number(card.querySelector('.simpN').value);
    const d = Number(card.querySelector('.simpD').value);
    const got = simplify(n,d);
    
    const isCorrect = (got[0]===want[0] && got[1]===want[1]);
    card.querySelector('.simpN').style.borderColor = isCorrect ? '#22c55e' : '#ef4444';
    card.querySelector('.simpD').style.borderColor = isCorrect ? '#22c55e' : '#ef4444';
    if(isCorrect) correct++;
  });
  
  const fb = document.getElementById('simpFb');
  if(correct === cards.length){
    fb.textContent = 'üåü All simplified perfectly!';
    fb.className = 'mt-2 h-6 font-semibold text-green-600';
    confetti();
  } else {
    fb.textContent = `Score: ${correct}/${cards.length}`;
    fb.className = 'mt-2 h-6 font-semibold text-yellow-600';
  }
});

document.getElementById('simpHint').addEventListener('click', ()=>{
  alert('Hint: Find the GCF of numerator and denominator, then divide both by it. Use the GCF Helper tool if needed!');
});

function showGCFHelper(){
  const helper = document.getElementById('gcfHelper');
  helper.style.display = helper.style.display==='none' ? 'block' : 'none';
}

function calculateGCF(){
  const a = Number(document.getElementById('gcfA').value);
  const b = Number(document.getElementById('gcfB').value);
  if(!a || !b){
    document.getElementById('gcfResult').textContent = 'Enter both numbers!';
    return;
  }
  const result = gcd(a,b);
  document.getElementById('gcfResult').textContent = `GCF = ${result}`;
}

/* ======================= Tournament ======================= */
let tournState = {current:null, team1:0, team2:0};

function newTournamentQ(){
  const level = document.getElementById('tournLevel').value;
  let a,b,c,d;
  
  if(level==='easy'){
    b = d = randFrom([4,5,6,8,10]);
    a = randomInt(1,b-1);
    c = randomInt(1,d-1);
  } else if(level==='medium'){
    b = randFrom([6,8,10,12]);
    d = randFrom([6,8,10,12,15]);
    a = randomInt(1,2*b-1);
    c = randomInt(1,2*d-1);
  } else {
    b = randFrom([7,11,13]);
    d = randFrom([6,9,12]);
    a = nonzeroRand(-15,15);
    c = nonzeroRand(-15,15);
  }
  
  tournState.current = {a,b,c,d};
  const box = document.getElementById('tournamentQuestion');
  box.innerHTML = `Compare: \\(${toLatex(a,b)}\\) __ \\(${toLatex(c,d)}\\)`;
  renderMath(box);
  
  document.getElementById('team1Answer').value = '';
  document.getElementById('team2Answer').value = '';
  document.getElementById('tournFb').textContent = '';
}

function checkTournament(){
  const {a,b,c,d} = tournState.current;
  const ad = a*d, bc = b*c;
  const correct = ad<bc ? '<' : ad>bc ? '>' : '=';
  
  const t1 = document.getElementById('team1Answer').value;
  const t2 = document.getElementById('team2Answer').value;
  
  let msg = '';
  if(t1 === correct){
    tournState.team1++;
    msg += 'Team 1 correct! ';
  }
  if(t2 === correct){
    tournState.team2++;
    msg += 'Team 2 correct! ';
  }
  if(t1!==correct && t2!==correct){
    msg = 'Both teams incorrect. The answer is: ' + correct;
  }
  
  document.getElementById('team1Score').textContent = tournState.team1;
  document.getElementById('team2Score').textContent = tournState.team2;
  document.getElementById('tournFb').textContent = msg;
  
  if(tournState.team1>=5 || tournState.team2>=5){
    const winner = tournState.team1>=5 ? 'Team 1' : 'Team 2';
    setTimeout(()=>{
      alert(`üèÜ ${winner} WINS the tournament!`);
      confetti();
    }, 500);
  }
}

function resetTournament(){
  tournState = {current:null, team1:0, team2:0};
  document.getElementById('team1Score').textContent = '0';
  document.getElementById('team2Score').textContent = '0';
  newTournamentQ();
}

/* ======================= Vocabulary Quiz ======================= */
function openVocabQuiz(){
  const popup = document.getElementById('vocabPopup');
  const content = document.getElementById('vocabQuizContent');
  
  const questions = [
    {q: 'What is a rational number?', opts: ['Any fraction', 'A number that can be written as a/b', 'Only positive numbers'], ans:1},
    {q: 'What is simplest form?', opts: ['Any equivalent fraction', 'When GCF=1', 'The smallest fraction'], ans:1},
    {q: 'What is GCF?', opts: ['Greatest Common Factor', 'Greatest Common Fraction', 'General Common Factor'], ans:0}
  ];
  
  let html = '<div class="space-y-4">';
  questions.forEach((q,idx)=>{
    html += `<div class="border p-3 rounded">
      <div class="font-bold mb-2">${q.q}</div>`;
    q.opts.forEach((opt,i)=>{
      html += `<label class="block"><input type="radio" name="vocab${idx}" value="${i}"> ${opt}</label>`;
    });
    html += '</div>';
  });
  html += '<button class="btn maroon mt-3" onclick="checkVocab()">Check Answers</button>';
  html += '<div id="vocabScore" class="mt-2 font-bold"></div></div>';
  
  content.innerHTML = html;
  popup.classList.add('active');
}

function closeVocabQuiz(){
  document.getElementById('vocabPopup').classList.remove('active');
}

function checkVocab(){
  const answers = [1,1,0];
  let score = 0;
  answers.forEach((ans,idx)=>{
    const selected = document.querySelector(`input[name="vocab${idx}"]:checked`);
    if(selected && Number(selected.value)===ans) score++;
  });
  document.getElementById('vocabScore').textContent = `Score: ${score}/${answers.length}`;
  if(score===answers.length) confetti();
}

/* ======================= Reflection Functions ======================= */
function updateConfidence(val){
  document.getElementById('confidenceVal').textContent = val;
}

function saveReflection(){
  alert('‚úÖ Reflection saved! Great job reflecting on your learning.');
  confetti();
}

/* ======================= Initialize ======================= */
window.addEventListener('load', ()=>{
  newOrderSet();
  newSimpSet();
  newTournamentQ();
  newQatarChallenges();
  selectStation('developing'); // Default station
});
</script>

</body>
</html>
