<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>G7 ‚Ä¢ Unit 1 ‚Ä¢ Addition & Subtraction of Rational Numbers</title>

<!-- Fonts & Tailwind -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<!-- KaTeX (auto-render) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>

<style>
  :root{
    --maroon:#6C1D45;--gold:#C7A34F;--ink:#1f2937;--paper:#ffffff;--soft:#f7f7f8;
  }
  html,body{height:100%;background:#2d3748;color:#111;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  /* Stage */
  #stage{position:relative;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;padding:10px}
  #deck{position:relative;width:100%;max-width:1280px;aspect-ratio:16/9;background:var(--paper);box-shadow:0 14px 36px rgba(0,0,0,.35);overflow:hidden;border-radius:18px}
  .slide{position:absolute;inset:0;padding:3.5%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;opacity:0;transform:translateY(14px) scale(.985);transition:.45s ease;pointer-events:none}
  .slide.active{opacity:1;transform:none;pointer-events:auto}
  .banner{width:100%;height:110px;background:#fff center/cover no-repeat;border-bottom:3px solid var(--gold);border-radius:10px}
  .card{border:1px solid #e5e7eb;border-radius:16px;background:#fafafa}
  .chip{display:inline-flex;align-items:center;gap:.5rem;background:#f1f5f9;border-radius:9999px;padding:.45rem .85rem;cursor:pointer}
  .chip[data-key]:hover{outline:2px solid var(--gold)}
  .btn{padding:.55rem 1rem;border-radius:999px;border:1px solid #e5e7eb;background:#fff;font-weight:700}
  .btn.maroon{background:var(--maroon);color:#fff;border-color:var(--maroon)}
  .btn.ghost{background:transparent;border-color:#cbd5e1}
  .btn:hover{filter:brightness(0.98)}
  .hint{background:#fff3cd;border:1px solid #ffe69c;border-radius:10px;padding:.5rem .75rem}
  .note{background:#e0f2fe;border:1px solid #bae6fd;border-radius:10px;padding:.5rem .75rem}
  .text-maroon{color:var(--maroon)} .text-gold{color:var(--gold)}
  .bg-maroon{background-color:var(--maroon)} .bg-soft{background:var(--soft)}

  /* Board mode (bigger UI for projection) */
  .board *{font-size:1.06em}
  .board h1{font-size:3rem}
  .board h2{font-size:2.2rem}
  .board .text-xl{font-size:1.5rem}

  /* Top bars */
  #partNav{position:absolute;top:10px;left:12px;display:flex;gap:.4rem;z-index:20}
  #teacherBar{position:absolute;top:10px;right:12px;display:flex;gap:.4rem;z-index:20}
  #controls{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:.5rem;background:rgba(0,0,0,.55);padding:.4rem .6rem;border-radius:999px;z-index:20;backdrop-filter:blur(6px)}
  #controls button{width:42px;height:42px;border-radius:999px;border:none;background:#fff;cursor:pointer;font-weight:700}
  #controls button:hover{transform:scale(1.06)}
  #counter{color:#fff;font-weight:700;min-width:100px;text-align:center}
  #progress{position:absolute;left:0;bottom:0;height:5px;width:0;background:var(--gold);z-index:10;transition:width .35s ease}

  /* Teacher panel modal */
  #panel{position:absolute;right:12px;top:62px;z-index:30;background:#fff;border:2px solid var(--gold);border-radius:14px;padding:12px;display:none;max-width:360px}
  #panel h4{font-weight:800;color:var(--maroon);margin:.2rem 0 .4rem}
  #panel input, #panel textarea{border:1px solid #cbd5e1;border-radius:8px;padding:.4rem .6rem;width:100%}
  #panel .row{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}

  /* Number line canvases */
  .nl-wrap{width:100%;max-width:920px}
  canvas.nline{width:100%;height:170px;border-radius:12px;background:linear-gradient(180deg,#fff,#fafafa);border:2px solid #ececec}

  /* Drag-sort */
  .sortable li{user-select:none;cursor:move}
  .sortable .dragging{opacity:.55}

  /* Draw overlay */
  #ink{position:absolute;inset:0;pointer-events:none}
  #ink.active{pointer-events:auto}
  #ink canvas{width:100%;height:100%;}

  /* Confetti */
  .confetti{position:fixed;pointer-events:none;z-index:50}
</style>
</head>
<body>

<div id="stage">
  <div id="deck" class="relative">

    <!-- Part nav -->
    <div id="partNav" aria-label="Jump to part">
      <button class="btn ghost" data-jump="A">Part A</button>
      <button class="btn ghost" data-jump="B">Part B</button>
      <button class="btn ghost" data-jump="C">Part C</button>
      <button class="btn ghost" data-jump="D">Part D</button>
      <button class="btn ghost" data-jump="E">Part E</button>
    </div>

    <!-- Teacher bar -->
    <div id="teacherBar" aria-label="Teacher tools">
      <button id="btnFS" title="Fullscreen (F)" class="btn">‚§¢</button>
      <button id="btnBoard" title="Board Mode (B)" class="btn">üñ•Ô∏è</button>
      <button id="btnDraw" title="Draw (D)" class="btn">‚úèÔ∏è</button>
      <button id="btnPanel" title="Teacher Panel (T)" class="btn">üß∞</button>
    </div>

    <!-- Teacher panel -->
    <div id="panel" role="dialog" aria-modal="true">
      <div class="row">
        <h4 class="grow">Teacher Panel</h4>
        <button class="btn" id="closePanel">‚úï</button>
      </div>

      <h4>Timer</h4>
      <div class="row">
        <input type="number" id="min" value="2" min="0" style="width:84px"> min
        <input type="number" id="sec" value="0" min="0" max="59" style="width:84px"> sec
        <button class="btn maroon" id="startTimer">Start</button>
        <button class="btn" id="stopTimer">Stop</button>
        <span id="clock" class="font-bold ml-2">‚Äì:‚Äì</span>
      </div>

      <h4 class="mt-2">Random Name</h4>
      <div class="row">
        <textarea id="roster" rows="3" placeholder="Paste names, one per line"></textarea>
        <button class="btn" id="pickName">Pick</button>
        <span id="nameOut" class="font-bold"></span>
      </div>

      <h4 class="mt-2">Options</h4>
      <div class="row">
        <label class="chip"><input type="checkbox" id="snapTenths" class="mr-2">Snap number line to tenths</label>
        <label class="chip"><input type="checkbox" id="showNotes" class="mr-2">Show teacher notes</label>
      </div>
    </div>

    <!-- Draw/ink overlay -->
    <div id="ink"><canvas></canvas></div>

    <!-- Slides -->

    <!-- A0 Title -->
    <section class="slide active bg-maroon text-white" data-part="A">
      <div class="w-full h-16 banner mb-6 rounded-md" style="background-image:url('qla_banner.png')" aria-label="Banner"></div>
      <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight">Unit 1 ‚Äî The Number System</h1>
      <p class="text-gold text-2xl md:text-3xl mt-2 font-semibold">Addition &amp; Subtraction of Rational Numbers</p>
      <p class="mt-2 text-lg">Qatar Leadership Academy ‚Äî Grade 7</p>
      <div class="text-sm mt-4">Aligned to AERO 7.NS.1b‚Äì1c</div>
    </section>

    <!-- A1 Learning goals + norms -->
    <section class="slide" data-part="A">
      <h2 class="text-4xl font-extrabold text-maroon mb-2">Today‚Äôs Goals</h2>
      <div class="grid md:grid-cols-2 gap-6 text-left max-w-5xl">
        <div class="card p-5">
          <h3 class="text-2xl font-bold text-maroon mb-1">Learning Objectives</h3>
          <ul class="list-disc list-inside space-y-1 text-lg">
            <li>Interpret \(p+q\) on a number line: move \(q\) units from \(p\) (right if \(q&gt;0\), left if \(q&lt;0\)).</li>
            <li>See subtraction as adding the inverse: \(p-q=p+(-q)\).</li>
            <li>Add/subtract rational numbers and justify via number line & arithmetic.</li>
            <li>Use prime factorization to find LCM for fraction denominators.</li>
          </ul>
          <div class="note mt-3 hidden teacher-note">Emphasize ‚Äúwhy‚Äù with multiple reps: number line ‚Üí symbolic ‚Üí explanation.</div>
        </div>
        <div class="card p-5">
          <h3 class="text-2xl font-bold text-maroon mb-1">We Learn By‚Ä¶</h3>
          <ul class="list-disc list-inside space-y-1 text-lg">
            <li>Predict ‚Üí Try ‚Üí Check ‚Üí Explain cycles</li>
            <li>Think‚ÄìPair‚ÄìShare using on‚Äëscreen timer</li>
            <li>Quick checks & error analysis</li>
            <li>Whole‚Äëclass board work with annotation</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- A2 Warm-up -->
    <section class="slide" data-part="A">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Warm‚ÄëUp: What do you notice?</h2>
      <div class="grid md:grid-cols-3 gap-4 w-full max-w-5xl">
        <div class="card p-4">
          <div class="font-bold text-maroon mb-1">Integers</div>
          <div class="text-2xl">\( -3 + 7 = \) <b>4</b></div>
          <div class="text-sm mt-1">We moved 7 right from ‚àí3.</div>
        </div>
        <div class="card p-4">
          <div class="font-bold text-maroon mb-1">Fractions</div>
          <div class="text-2xl">\( \frac{5}{8}-\frac{3}{8}=\frac{1}{4} \)</div>
          <div class="text-sm mt-1">Subtract numerators; keep denominator; simplify.</div>
        </div>
        <div class="card p-4">
          <div class="font-bold text-maroon mb-1">Decimals</div>
          <div class="text-2xl">\( 2.6 + (-1.25) = 1.35 \)</div>
          <div class="text-sm mt-1">Add signed numbers by place value.</div>
        </div>
      </div>
    </section>

    <!-- B1 Primes -->
    <section class="slide" data-part="B" id="primeSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Part B ‚Ä¢ Prime or Composite?</h2>
      <div class="card p-5 w-full max-w-5xl text-left">
        <p class="mb-2">A <b>prime</b> is an integer \( \ge 2 \) with exactly two positive factors. A <b>composite</b> has more than two. 1 is neither.</p>
        <div id="primeList" class="grid md:grid-cols-4 gap-2"></div>
        <div class="mt-3 flex flex-wrap gap-2">
          <button id="primeNew" class="btn">New set</button>
          <button id="primeCheck" class="btn maroon">Check</button>
        </div>
        <div id="primeFb" class="mt-2 h-6 font-semibold"></div>
        <div class="note mt-3 hidden teacher-note">Ask: ‚ÄúHow do you know?‚Äù Students justify with factor pairs.</div>
      </div>
    </section>

    <!-- B2 Prime factorization -->
    <section class="slide" data-part="B" id="pfSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Prime Factorization (Exponent Form)</h2>
      <div class="card p-5 w-full max-w-5xl text-left">
        <p class="mb-2">Write each as a product of primes, e.g., \(60 = 2^{2}\cdot 3^{1}\cdot 5^{1}\).</p>
        <div id="pfList" class="grid md:grid-cols-2 gap-3"></div>
        <div class="mt-3 flex flex-wrap gap-2">
          <button id="pfNew" class="btn">New set</button>
          <button id="pfCheck" class="btn maroon">Check</button>
        </div>
        <div id="pfFb" class="mt-2 h-6 font-semibold"></div>
      </div>
    </section>

    <!-- B3 LCM by multiples & by primes -->
    <section class="slide" data-part="B" id="lcmExSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">LCM ‚Äî Two Methods</h2>
      <div class="grid lg:grid-cols-2 gap-6 w-full max-w-5xl text-left">
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon mb-2">List Multiples</h3>
          <div id="lcmListArea" class="text-lg"></div>
        </div>
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon mb-2">Prime Exponents</h3>
          <div id="lcmPrimeArea" class="text-lg"></div>
        </div>
      </div>
      <div class="mt-3 flex flex-wrap gap-2">
        <button id="lcmNew" class="btn">New example</button>
      </div>
      <div class="hint mt-3 text-left text-sm">For \(a\) and \(b\): \( \mathrm{LCM}(a,b)=\prod p^{\max(\alpha,\beta)} \).</div>
    </section>

    <!-- C1 Number line: p+q -->
    <section class="slide" data-part="C" id="addSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Explorer: \(p+q\) on a Number Line</h2>
      <p class="text-gray-600 mb-2">Drag maroon point for \(p\). Drag gold point for \(p+q\) (this sets \(q\)).</p>
      <div class="nl-wrap"><canvas id="lineAdd" class="nline" aria-label="Interactive number line (addition)"></canvas></div>
      <div class="mt-3 flex flex-wrap items-center gap-3 text-sm">
        <label class="chip">p = <input id="pInput" class="border rounded px-2 py-1 w-24" value="-2"/></label>
        <label class="chip">q = <input id="qInput" class="border rounded px-2 py-1 w-24" value="3.5"/></label>
        <span class="chip">p+q = <b id="sumOut">1.5</b></span>
        <button id="randAdd" class="btn">Random</button>
        <button id="resetAdd" class="btn">Reset</button>
      </div>
      <div class="hint mt-3 text-left text-sm">Rule (AERO 7.NS.1b): start at \(p\), move \(q\) units ‚Äî right if \(q&gt;0\), left if \(q&lt;0\).</div>
    </section>

    <!-- C2 Subtraction = adding the inverse -->
    <section class="slide" data-part="C" id="subSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Subtraction: \(p-q = p + (-q)\)</h2>
      <div class="grid lg:grid-cols-2 gap-6 w-full max-w-5xl text-left">
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon mb-2">Visualize</h3>
          <div class="nl-wrap"><canvas id="lineSub" class="nline" aria-label="Interactive number line (subtraction)"></canvas></div>
          <div class="mt-3 flex flex-wrap items-center gap-3 text-sm">
            <label class="chip">p = <input id="p2Input" class="border rounded px-2 py-1 w-24" value="1"/></label>
            <label class="chip">q = <input id="q2Input" class="border rounded px-2 py-1 w-24" value="-4"/></label>
            <span class="chip">p‚àíq = <b id="diffOut">5</b></span>
            <button id="randSub" class="btn">Random</button>
          </div>
        </div>
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon mb-2">Quick Check</h3>
          <div class="grid gap-2">
            <div>1) \( 6 - 9 =\) <input class="qc border rounded px-2 py-1 w-24" data-prob="6-9" data-ans="-3"></div>
            <div>2) \( -4 - (-7) =\) <input class="qc border rounded px-2 py-1 w-24" data-prob="-4 - (-7)" data-ans="3"></div>
            <div>3) \( -2.5 - 1.5 =\) <input class="qc border rounded px-2 py-1 w-24" data-prob="-2.5 - 1.5" data-ans="-4"></div>
          </div>
          <div class="mt-3 flex gap-2">
            <button id="checkQC" class="btn maroon">Check</button>
            <button id="resetQC" class="btn">Reset</button>
          </div>
          <div id="qcFb" class="mt-2 h-6 font-semibold"></div>
        </div>
      </div>
      <div class="note mt-3 hidden teacher-note">Invite multiple strategies: number line; integer‚Äëchips language; algebraic rewrite.</div>
    </section>

    <!-- C3 Fractions like denominators -->
    <section class="slide" data-part="C" id="likeSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Fractions: Like Denominators</h2>
      <p class="text-gray-600 mb-2">Add/subtract numerators; keep denominator; simplify.</p>
      <div id="likeList" class="w-full max-w-4xl grid md:grid-cols-2 gap-3"></div>
      <div class="mt-3 flex gap-2">
        <button id="likeCheck" class="btn maroon">Check</button>
        <button id="likeNew" class="btn">New set</button>
      </div>
      <div id="likeFb" class="mt-2 h-6 font-semibold"></div>
    </section>

    <!-- C4 Fractions unlike denominators (guided) -->
    <section class="slide" data-part="C" id="unlikeSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Fractions: Unlike Denominators (Guided)</h2>
      <div class="card p-5 w-full max-w-5xl text-left">
        <div class="mb-2">Find the LCM, build equivalent fractions, operate, then simplify.</div>
        <div id="unlikeBox" class="grid md:grid-cols-2 gap-4"></div>
        <div class="mt-3 flex gap-2">
          <button id="unlikeCheck" class="btn maroon">Check</button>
          <button id="unlikeNew" class="btn">New pair</button>
        </div>
        <div id="unlikeFb" class="mt-2 h-6 font-semibold"></div>
      </div>
      <div class="note mt-2 hidden teacher-note">Have students justify their LCM choice with prime exponents or multiple lists.</div>
    </section>

    <!-- C5 Decimals -->
    <section class="slide" data-part="C" id="decSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Decimals (Align Place Value)</h2>
      <div id="decList" class="w-full max-w-4xl grid md:grid-cols-2 gap-3"></div>
      <div class="mt-3 flex gap-2">
        <button id="decCheck" class="btn maroon">Check</button>
        <button id="decNew" class="btn">New set</button>
      </div>
      <div id="decFb" class="mt-2 h-6 font-semibold"></div>
    </section>

    <!-- D1 Order rationals -->
    <section class="slide" data-part="D" id="sortSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Order Rational Numbers (Low ‚Üí High)</h2>
      <div class="card p-5 w-full max-w-3xl text-left">
        <ul id="sortList" class="sortable border rounded-md bg-white p-3 space-y-2"></ul>
        <div class="mt-3 flex gap-2">
          <button id="sortNew" class="btn">New set</button>
          <button id="sortCheck" class="btn maroon">Check</button>
        </div>
        <div id="sortFb" class="mt-2 h-6 font-semibold"></div>
      </div>
    </section>

    <!-- D2 Mixed generator + hints -->
    <section class="slide" data-part="D" id="mixedSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Practice Generator (Mixed)</h2>
      <div class="card p-5 w-full max-w-3xl text-left">
        <div class="flex items-center gap-3">
          <span>Difficulty:</span>
          <select id="level" class="border rounded px-2 py-1">
            <option value="easy">easy (integers)</option>
            <option value="med" selected>medium (like‚Äëdenominator fractions &amp; decimals)</option>
            <option value="hard">hard (unlike denominators; signed)</option>
          </select>
          <button id="newQ" class="btn">New question</button>
        </div>
        <div class="mt-3 text-2xl">Compute: <span id="qText" class="font-extrabold"></span></div>
        <div class="mt-2">
          <input id="ans" class="border rounded px-3 py-2 w-60" placeholder="e.g., -7/6 or  -1.166..." />
          <button id="checkQ" class="btn maroon">Check</button>
          <button id="hintQ" class="btn">Hint</button>
        </div>
        <div id="qHint" class="mt-3 text-sm"></div>
        <div id="qFb" class="mt-2 h-6 font-semibold"></div>
      </div>
    </section>

    <!-- D3 Error analysis + missing addend -->
    <section class="slide" data-part="D" id="challengeSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Challenge: Missing Addend & Error Analysis</h2>
      <div class="grid md:grid-cols-2 gap-6 w-full max-w-5xl text-left">
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon mb-1">Missing number</h3>
          <div class="grid gap-2">
            <div>\( p + q = r \).  If \(p=-4.5\) and \(r=1.25\), then \(q=\) <input class="ch1 border rounded px-2 py-1 w-28" data-ans="5.75"></div>
            <div>\( p - q = r \).  If \(p=\frac{3}{4}\) and \(r=-\frac{5}{4}\), then \(q=\) <input class="ch1 border rounded px-2 py-1 w-28" data-ans="2"></div>
          </div>
          <div class="mt-3">
            <button id="chCheck" class="btn maroon">Check</button>
            <button id="chReset" class="btn">Reset</button>
          </div>
          <div id="chFb" class="mt-2 h-6 font-semibold"></div>
        </div>
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon mb-1">Error Analysis</h3>
          <div id="errBox" class="text-lg"></div>
          <div class="mt-2">
            <label class="mr-2"><input type="radio" name="errChoice" value="A"> Added/subtracted denominators directly</label><br/>
            <label class="mr-2"><input type="radio" name="errChoice" value="B"> Failed to use common denominator</label><br/>
            <label class="mr-2"><input type="radio" name="errChoice" value="C"> Sign error</label><br/>
            <label class="mr-2"><input type="radio" name="errChoice" value="D"> Decimal place-value misalignment</label>
          </div>
          <div class="mt-2 flex gap-2">
            <button id="errCheck" class="btn maroon">Check</button>
            <button id="errReveal" class="btn">Reveal correct work</button>
            <button id="errNew" class="btn">New example</button>
          </div>
          <div id="errFb" class="mt-2 h-6 font-semibold"></div>
          <div id="errRevealBox" class="mt-2 text-sm"></div>
        </div>
      </div>
    </section>

    <!-- E Exit -->
    <section class="slide" data-part="E">
      <h2 class="text-4xl font-extrabold text-maroon mb-2">Exit Ticket</h2>
      <div class="grid md:grid-cols-2 gap-6 text-left max-w-5xl">
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon">3‚Äì2‚Äì1 Reflect</h3>
          <ul class="list-disc list-inside">
            <li>3 ideas about adding/subtracting rationals</li>
            <li>2 strategies you can use (visual &amp; arithmetic)</li>
            <li>1 question you still have</li>
          </ul>
        </div>
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon">Up Next</h3>
          <p>Multi‚Äëstep problems with rational numbers and estimation for reasonableness (AERO 7.EE.3).</p>
        </div>
      </div>
      <div class="absolute bottom-4 left-1/2 -translate-x-1/2 w-[88%] h-[100px] banner rounded-md" style="background-image:url('qla_banner.png')"></div>
    </section>

    <!-- Glossary popover (tap chips) -->
    <div id="pop" class="hidden absolute left-4 bottom-4 z-30 max-w-[560px] bg-white border-2 border-[var(--gold)] rounded-md p-3 text-left"></div>

    <!-- Controls -->
    <div id="controls" role="group" aria-label="Slideshow controls">
      <button id="prev" title="Previous (‚Üê)">&laquo;</button>
      <button id="fs" title="Toggle Fullscreen (F)">‚§¢</button>
      <div id="counter">1 / 1</div>
      <button id="next" title="Next (‚Üí)">&raquo;</button>
    </div>
    <div id="progress"></div>

  </div>
</div>

<script>
/* =========================================================
   BOOT + KATEX
   ========================================================= */
window.addEventListener('DOMContentLoaded', () => {
  const renderMath = (root = document.body) => {
    if (!window.renderMathInElement) return;
    window.renderMathInElement(root, {
      delimiters: [
        { left: '$$', right: '$$', display: true },
        { left: '\\[', right: '\\]', display: true },
        { left: '\\(', right: '\\)', display: false }
      ],
      throwOnError: false
    });
  };
  if (window.renderMathInElement) renderMath();
  else {
    const t = setInterval(() => {
      if (window.renderMathInElement) { clearInterval(t); renderMath(); }
    }, 25);
    setTimeout(() => clearInterval(t), 6000);
  }
  window._renderMath = renderMath;
});

/* =========================================================
   SLIDE ENGINE + NAV + PARTS
   ========================================================= */
(function(){
  const slides=[...document.querySelectorAll('.slide')];
  const prev=byId('prev'), next=byId('next'), counter=byId('counter'), progress=byId('progress');
  const partButtons=[...byId('partNav').querySelectorAll('button[data-jump]')];
  const fsBtn=byId('fs'), btnFS=byId('btnFS'), btnBoard=byId('btnBoard'), btnDraw=byId('btnDraw'), btnPanel=byId('btnPanel');
  const deck=byId('deck'); const stage=byId('stage');

  let i=0; // slide index
  function show(k){
    i=(k+slides.length)%slides.length;
    slides.forEach((s,idx)=>s.classList.toggle('active',idx===i));
    counter.textContent=(i+1)+' / '+slides.length;
    progress.style.width=((i+1)/slides.length*100)+'%';
    // lazy render when needed
    const sid=slides[i].id||'';
    if(sid==='addSlide') drawAdd();
    if(sid==='subSlide') drawSub();
    if(sid==='lcmExSlide') newLCMEx(false);
    if(sid==='primeSlide') primeNew();
    if(sid==='pfSlide') pfNew();
    if(sid==='likeSlide') renderLike();
    if(sid==='unlikeSlide') newUnlike();
    if(sid==='decSlide') newDecSet();
    if(sid==='sortSlide') sortNew();
    if(sid==='mixedSlide') newQuestion();
    if(sid==='challengeSlide') errNew();
    if(window._renderMath) window._renderMath(slides[i]);
  }
  function byId(x){return document.getElementById(x)}
  function toggleFS(){
    const el=byId('deck');
    if(!document.fullscreenElement){(el.requestFullscreen||el.webkitRequestFullscreen||el.msRequestFullscreen).call(el);}
    else{(document.exitFullscreen||document.webkitExitFullscreen||document.msExitFullscreen).call(document);}
  }
  prev.addEventListener('click',()=>show(i-1));
  next.addEventListener('click',()=>show(i+1));
  fsBtn.addEventListener('click',toggleFS);
  btnFS.addEventListener('click',toggleFS);

  document.addEventListener('keydown',e=>{
    if(e.key==='ArrowRight') show(i+1);
    if(e.key==='ArrowLeft') show(i-1);
    if(e.key.toLowerCase()==='f') toggleFS();
    if(e.key.toLowerCase()==='b') toggleBoard();
    if(e.key.toLowerCase()==='d') toggleInk();
    if(e.key.toLowerCase()==='t') togglePanel();
    if('12345'.includes(e.key)){ // jump to part A..E
      const part='ABCDE'[Number(e.key)-1];
      jumpToPart(part);
    }
  });
  partButtons.forEach(btn=>btn.addEventListener('click',()=>jumpToPart(btn.dataset.jump)));
  function jumpToPart(letter){
    const idx = slides.findIndex(s=>s.dataset.part===letter);
    if(idx>=0) show(idx);
  }

  function toggleBoard(){ deck.classList.toggle('board'); }
  btnBoard.addEventListener('click',toggleBoard);

  // Board ink overlay
  const ink=byId('ink'), inkCanvas=ink.querySelector('canvas'), ictx=inkCanvas.getContext('2d');
  let drawing=false, last=null;
  function fitInk(){ inkCanvas.width=ink.clientWidth*devicePixelRatio; inkCanvas.height=ink.clientHeight*devicePixelRatio; ictx.scale(devicePixelRatio,devicePixelRatio); ictx.lineWidth=3; ictx.lineCap='round'; ictx.strokeStyle='#111'; }
  function toggleInk(){ ink.classList.toggle('active'); }
  function clearInk(){ ictx.clearRect(0,0,inkCanvas.width,inkCanvas.height); }
  btnDraw.addEventListener('click',toggleInk);
  ink.addEventListener('mousedown',e=>{drawing=true; last=[e.offsetX,e.offsetY]});
  ink.addEventListener('mousemove',e=>{
    if(!drawing) return; ictx.beginPath(); ictx.moveTo(last[0],last[1]); ictx.lineTo(e.offsetX,e.offsetY); ictx.stroke(); last=[e.offsetX,e.offsetY];
  });
  window.addEventListener('mouseup',()=>drawing=false);
  window.addEventListener('resize',fitInk); fitInk();
  // Double‚Äëclick clears ink
  ink.addEventListener('dblclick',clearInk);

  // Teacher panel
  const panel=byId('panel'); const btnClose=byId('closePanel');
  function togglePanel(){ panel.style.display = (panel.style.display==='block')? 'none' : 'block'; }
  btnPanel.addEventListener('click',togglePanel);
  btnClose.addEventListener('click',togglePanel);

  show(0);

  /* =========================================================
     CONFETTI
     ========================================================= */
  function confetti(x=window.innerWidth/2,y=window.innerHeight/2){
    for(let k=0;k<16;k++){
      const d=document.createElement('div'); d.className='confetti';
      d.style.left=x+'px'; d.style.top=y+'px'; d.style.width='8px'; d.style.height='8px';
      d.style.background=['#6C1D45','#C7A34F','#E8D5B7','#8a3d64'][k%4];
      document.body.appendChild(d);
      const dx=(Math.random()*2-1)*240, dy=(Math.random()*-1-0.3)*300, rot=Math.random()*720;
      d.animate([{transform:'translate(0,0) rotate(0deg)'},{transform:`translate(${dx}px,${dy}px) rotate(${rot}deg)`,opacity:0}],
                {duration:900+Math.random()*700,easing:'cubic-bezier(.2,.8,.2,1)'}).onfinish=()=>d.remove();
    }
  }
  window._confetti=confetti;

  /* =========================================================
     TIMER + ROSTER (Teacher Panel)
     ========================================================= */
  const min=byId('min'), sec=byId('sec'), clock=byId('clock'), startTimer=byId('startTimer'), stopTimer=byId('stopTimer');
  let tHandle=null, tEnd=0;
  startTimer.addEventListener('click',()=>{
    const total = (Number(min.value)||0)*60 + (Number(sec.value)||0);
    if(total<=0) return;
    tEnd = Date.now() + total*1000;
    if(tHandle) clearInterval(tHandle);
    tHandle=setInterval(()=>{
      const left = Math.max(0, Math.round((tEnd-Date.now())/1000));
      const mm = String(Math.floor(left/60)).padStart(2,'0');
      const ss = String(left%60).padStart(2,'0');
      clock.textContent = `${mm}:${ss}`;
      if(left===0){ clearInterval(tHandle); tHandle=null; window._confetti(); }
    },200);
  });
  stopTimer.addEventListener('click',()=>{ if(tHandle) clearInterval(tHandle); tHandle=null; clock.textContent='‚Äì:‚Äì'; });

  const roster=byId('roster'), pickName=byId('pickName'), nameOut=byId('nameOut');
  pickName.addEventListener('click',()=>{
    const names = roster.value.split('\n').map(s=>s.trim()).filter(Boolean);
    if(!names.length){ nameOut.textContent='(no names)'; return; }
    const idx = Math.floor(Math.random()*names.length);
    nameOut.textContent = names[idx];
  });

  /* =========================================================
     TOGGLES: teacher notes; snap tenths (number line)
     ========================================================= */
  const showNotes=byId('showNotes'), snapTenths=byId('snapTenths');
  showNotes.addEventListener('change',()=>{ document.querySelectorAll('.teacher-note').forEach(n=>n.classList.toggle('hidden', !showNotes.checked)); });
  snapTenths.addEventListener('change',()=>{ addState.snap = !!snapTenths.checked; });

  /* =========================================================
     GLOSSARY POPOVER (demo - editable text)
     ========================================================= */
  const POP=document.getElementById('pop');
  const GLOS={
    rational:'<b>Rational number</b>: any number that can be written as a fraction of integers (terminating or repeating decimal).',
    integer:'<b>Integer</b>: {..., ‚àí3, ‚àí2, ‚àí1, 0, 1, 2, 3, ...}',
    lcm:'<b>LCM</b>: least common multiple.',
    numberline:'<b>Number line</b>: points laid out in order; left is less, right is greater.'
  };
  document.addEventListener('click',e=>{
    const el=e.target.closest('.chip[data-key]');
    if(el){ POP.innerHTML=GLOS[el.dataset.key]||'(define me)'; POP.classList.remove('hidden'); return; }
    if(!e.target.closest('#pop')) POP.classList.add('hidden');
  });

  /* =========================================================
     MATH HELPERS
     ========================================================= */
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const gcd=(a,b)=>{a=Math.trunc(Math.abs(a));b=Math.trunc(Math.abs(b));while(b){[a,b]=[b,a%b]}return a||1};
  const lcm=(a,b)=>Math.abs(a*b)/gcd(a,b);
  function isPrime(n){ if(n<2 || n%1) return false; for(let k=2;k*k<=n;k++) if(n%k===0) return false; return true; }
  function primeFactorMap(n){
    const m=new Map(); let x=Math.abs(n); let p=2;
    while(p*p<=x){
      while(x%p===0){ m.set(p,(m.get(p)||0)+1); x/=p; }
      p=(p===2)?3:p+2;
    }
    if(x>1) m.set(x,(m.get(x)||0)+1);
    return m;
  }
  function parseRational(s){
    if(typeof s==='number') return [Math.trunc(s*1000),1000]; // fallback
    if(!s) return null;
    s=s.toString().trim().replace('‚àí','-');
    const mix=s.match(/^(-?\d+)\s+(\d+)\/(\d+)$/);
    if(mix){const A=+mix[1],B=+mix[2],C=+mix[3];const sign=A<0?-1:1;return [A*C+sign*B, C];}
    const f=s.match(/^(-?\d+)\/(-?\d+)$/);
    if(f){let n=+f[1],d=+f[2]; if(d===0) return null; let g=gcd(n,d); d<0&&(g=-g); return [n/g,d/g];}
    if(!isNaN(Number(s))){
      const parts=s.split('.');
      if(parts.length===1) return [Number(s),1];
      const k=parts[1].length; const n=Math.round(Number(s)*10**k); const d=10**k; let g=gcd(n,d); return [n/g,d/g];
    }
    return null;
  }
  function toFrac(n,d){let g=gcd(n,d); d<0&&(g=-g); return [n/g,d/g]}
  const addFrac=(a,b)=>toFrac(a[0]*b[1]+b[0]*a[1], a[1]*b[1]);
  const subFrac=(a,b)=>toFrac(a[0]*b[1]-b[0]*a[1], a[1]*b[1]);
  const fracEq=(a,b)=>a[0]*b[1]===b[0]*a[1];
  const sFrac=([n,d])=> d===1? String(n) : `${n}/${d}`;
  const asNumber=([n,d])=> n/d;

  /* =========================================================
     PART B: PRIMES / PF / LCM
     ========================================================= */
  // PRIMES classify
  const primeState={set:[]};
  function primeNew(){
    const nums=new Set();
    while(nums.size<8){ nums.add(Math.floor(Math.random()*98)+2); }
    primeState.set=[...nums].sort((a,b)=>a-b).map(n=>({n,prime:isPrime(n)}));
    const box=byId('primeList'); box.innerHTML='';
    primeState.set.forEach((o,idx)=>{
      const row=document.createElement('div'); row.className='card p-3 flex items-center justify-between';
      row.innerHTML=`
        <div class="text-xl">\\( ${o.n} \\)</div>
        <select class="border rounded px-2 py-1" id="pc_${idx}">
          <option value="">‚Äî classify ‚Äî</option>
          <option value="P">Prime</option>
          <option value="C">Composite</option>
        </select>`;
      box.appendChild(row);
    });
    if(window._renderMath) window._renderMath(byId('primeSlide'));
  }
  function primeCheck(){
    let ok=0; primeState.set.forEach((o,idx)=>{
      const sel=byId('pc_'+idx); const got=sel.value; const want=o.prime?'P':'C';
      sel.style.borderColor= (got===want && got!=='') ? '#22c55e' : '#ef4444';
      if(got===want && got!=='') ok++;
    });
    byId('primeFb').textContent= (ok===primeState.set.length)?'‚úÖ All correct!':'Score: '+ok+'/'+primeState.set.length;
    if(ok===primeState.set.length) window._confetti();
  }
  byId('primeNew').addEventListener('click',primeNew);
  byId('primeCheck').addEventListener('click',primeCheck);

  // PF
  const pfState={set:[], primes:[2,3,5,7,11,13]};
  function buildN(exps){ return pfState.primes.reduce((acc,p)=>acc*Math.pow(p,exps[p]||0),1) }
  function pfNew(){
    const list=[];
    while(list.length<4){
      const exps={}; pfState.primes.forEach(p=>{
        let e=0;
        if(p<=5){ e=Math.floor(Math.random()*3); }
        else if(p===7){ e=Math.random()<0.7?0:1; }
        else { e=Math.random()<0.8?0:1; }
        exps[p]=e;
      });
      if(Object.values(exps).every(e=>e===0)) exps[2]=1;
      const n=buildN(exps);
      if(n>=60 && n<=5000) list.push({n,exps});
    }
    pfState.set=list;
    const box=byId('pfList'); box.innerHTML='';
    pfState.set.forEach((o,idx)=>{
      const row=document.createElement('div'); row.className='card p-4';
      row.innerHTML=`
        <div class="text-xl mb-1">\\( ${o.n} = 2^{\\square}\\cdot 3^{\\square}\\cdot 5^{\\square}\\cdot 7^{\\square}\\cdot 11^{\\square}\\cdot 13^{\\square} \\)</div>
        <div class="flex flex-wrap gap-2 text-sm">
          ${pfState.primes.map(p=>`<label class="chip">${p}: <input class="pfexp border rounded px-2 py-1 w-16" id="pf_${idx}_${p}" placeholder="exp"></label>`).join('')}
        </div>`;
      box.appendChild(row);
    });
    if(window._renderMath) window._renderMath(byId('pfSlide'));
  }
  function pfCheck(){
    let total=0,ok=0;
    pfState.set.forEach((o,idx)=>{
      total++; let good=true;
      pfState.primes.forEach(p=>{
        const inp=byId(`pf_${idx}_${p}`); const g=Number(inp.value||0); const want=o.exps[p]||0;
        inp.style.borderColor=(g===want)? '#22c55e':'#ef4444'; if(g!==want) good=false;
      });
      if(good) ok++;
    });
    byId('pfFb').textContent= ok===total ? '‚úÖ All correct!' : 'Score: '+ok+'/'+total;
    if(ok===total) window._confetti();
  }
  byId('pfNew').addEventListener('click',pfNew);
  byId('pfCheck').addEventListener('click',pfCheck);

  // LCM examples
  const lcmState={};
  function mults(a, count=10){ return Array.from({length:count},(_,i)=>a*(i+1)); }
  function newLCMEx(conf=true){
    let a=0,b=0; while(a===b || a<4 || b<4){ a=Math.floor(Math.random()*15)+4; b=Math.floor(Math.random()*15)+4; }
    const listA=mults(a,10), listB=mults(b,10);
    const common=listA.find(x=>listB.includes(x)) || lcm(a,b);
    const fa=primeFactorMap(a), fb=primeFactorMap(b);
    const primes=[...new Set([...fa.keys(), ...fb.keys()])].sort((x,y)=>x-y);
    const expLCM={}; primes.forEach(p=>expLCM[p]=Math.max(fa.get(p)||0, fb.get(p)||0));
    const L=primes.reduce((acc,p)=>acc*Math.pow(p,expLCM[p]),1);
    lcmState.a=a; lcmState.b=b; lcmState.l=L; lcmState.listA=listA; lcmState.listB=listB; lcmState.expLCM=expLCM; lcmState.common=common;

    byId('lcmListArea').innerHTML=`
      <div class="mb-2">\\( a=${a},\\; b=${b} \\)</div>
      <div>Multiples of \\(a\\): ${listA.map(x=> x===common? '<b>'+x+'</b>' : x).join(', ')}</div>
      <div>Multiples of \\(b\\): ${listB.map(x=> x===common? '<b>'+x+'</b>' : x).join(', ')}</div>
      <div class="mt-2">First common multiple: <b>${common}</b></div>`;
    const fmt=(obj)=>Object.keys(obj).sort((x,y)=>+x-+y).map(p=>` ${p}^{${obj[p]}}`).join('\\cdot')||'1';
    byId('lcmPrimeArea').innerHTML=`
      <div>\\( \\mathrm{LCM}(a,b) = ${ fmt(lcmState.expLCM) } = ${L} \\)</div>`;
    if(window._renderMath) window._renderMath(byId('lcmExSlide'));
    if(conf) window._confetti();
  }
  byId('lcmNew').addEventListener('click',()=>newLCMEx(true));

  /* =========================================================
     PART C: NUMBER LINES / FRACTIONS / DECIMALS
     ========================================================= */
  // Number line: Addition with two draggable handles (p and p+q)
  const cA=byId('lineAdd'); const pIn=byId('pInput'), qIn=byId('qInput'), sumOut=byId('sumOut');
  const addState={min:-12,max:12,snap:false,p:-2,q:3.5, dragging:null}; // dragging: 'p' or 'r'
  function mapA(x){const m=28,W=cA.clientWidth;return m+(x-addState.min)*(W-2*m)/(addState.max-addState.min)}
  function unmapA(px){const m=28,W=cA.clientWidth;return addState.min+(px-m)*(addState.max-addState.min)/(W-2*m)}
  function drawAdd(){
    if(!cA) return; const ctx=cA.getContext('2d');
    cA.width=cA.clientWidth*devicePixelRatio; cA.height=cA.clientHeight*devicePixelRatio; ctx.scale(devicePixelRatio,devicePixelRatio);
    const y=cA.clientHeight/2, m=28; ctx.clearRect(0,0,cA.clientWidth,cA.clientHeight);
    // axis
    ctx.lineWidth=2; ctx.strokeStyle='#6C1D45'; ctx.beginPath(); ctx.moveTo(m,y); ctx.lineTo(cA.clientWidth-m,y); ctx.stroke();
    for(let t=addState.min;t<=addState.max;t++){
      const x=mapA(t); ctx.beginPath(); ctx.moveTo(x,y-8); ctx.lineTo(x,y+8); ctx.stroke();
      if(t%2==0){ctx.fillStyle='#555'; ctx.font='12px Inter'; ctx.fillText(String(t),x-6,y+24);}
    }
    const px=mapA(addState.p), rx=mapA(addState.p+addState.q);
    // arrows
    ctx.strokeStyle='#C7A34F'; ctx.lineWidth=4; ctx.beginPath(); ctx.moveTo(px,y); ctx.lineTo(rx,y); ctx.stroke();
    // points
    ctx.fillStyle='#6C1D45'; ctx.beginPath(); ctx.arc(px,y,9,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#C7A34F'; ctx.beginPath(); ctx.arc(rx,y,9,0,Math.PI*2); ctx.fill();

    sumOut.textContent=(addState.p+addState.q).toFixed(2).replace(/\.00$/,'');
  }
  function setFromInputs(){ addState.p=Number(pIn.value||0); addState.q=Number(qIn.value||0); drawAdd(); }
  pIn.addEventListener('input', setFromInputs); qIn.addEventListener('input', setFromInputs);
  function handleAddDrag(e){
    const r=cA.getBoundingClientRect(); const x=(e.clientX||e.touches?.[0].clientX)-r.left; let val=unmapA(x); if(addState.snap) val=Math.round(val*10)/10;
    if(addState.dragging==='p'){ addState.p=clamp(val,addState.min,addState.max); pIn.value=addState.p; }
    if(addState.dragging==='r'){ const rVal=clamp(val,addState.min,addState.max); addState.q = rVal - addState.p; qIn.value=+addState.q.toFixed(2); }
    drawAdd();
  }
  cA.addEventListener('mousedown',e=>{
    const px=mapA(addState.p), rx=mapA(addState.p+addState.q);
    const x=e.offsetX;
    addState.dragging = (Math.abs(x-px) < Math.abs(x-rx)) ? 'p' : 'r';
    handleAddDrag(e);
  });
  window.addEventListener('mousemove',e=>{ if(addState.dragging) handleAddDrag(e) });
  window.addEventListener('mouseup',()=>addState.dragging=null);
  byId('randAdd').addEventListener('click',()=>{addState.p=+(Math.random()*12-6).toFixed(1); addState.q=+(Math.random()*8-4).toFixed(1); pIn.value=addState.p; qIn.value=addState.q; drawAdd();});
  byId('resetAdd').addEventListener('click',()=>{addState.p=-2;addState.q=3.5;pIn.value=-2;qIn.value=3.5;drawAdd()});
  window.addEventListener('resize',()=>{ if(slides[i].id==='addSlide') drawAdd(); });

  // Number line: Subtraction
  const cS=byId('lineSub'); const p2=byId('p2Input'), q2=byId('q2Input'), diffOut=byId('diffOut');
  const subState={min:-12,max:12,p:1,q:-4};
  function mapS(x){const m=28,W=cS.clientWidth;return m+(x-subState.min)*(W-2*m)/(subState.max-subState.min)}
  function drawSub(){
    const ctx=cS.getContext('2d'); cS.width=cS.clientWidth*devicePixelRatio; cS.height=cS.clientHeight*devicePixelRatio; ctx.scale(devicePixelRatio,devicePixelRatio);
    const y=cS.clientHeight/2, m=28; ctx.clearRect(0,0,cS.clientWidth,cS.clientHeight);
    ctx.lineWidth=2; ctx.strokeStyle='#6C1D45'; ctx.beginPath(); ctx.moveTo(m,y); ctx.lineTo(cS.clientWidth-m,y); ctx.stroke();
    for(let t=subState.min;t<=subState.max;t++){
      const x=mapS(t); ctx.beginPath(); ctx.moveTo(x,y-8); ctx.lineTo(x,y+8); ctx.stroke();
      if(t%2==0){ctx.fillStyle='#555'; ctx.font='12px Inter'; ctx.fillText(String(t),x-6,y+24);}
    }
    const px=mapS(subState.p), qx=mapS(subState.p - subState.q); // move by -q
    ctx.fillStyle='#6C1D45'; ctx.beginPath(); ctx.arc(px,y,9,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle='#C7A34F'; ctx.lineWidth=4; ctx.beginPath(); ctx.moveTo(px,y); ctx.lineTo(qx,y); ctx.stroke();
    ctx.fillStyle='#C7A34F'; ctx.beginPath(); ctx.arc(qx,y,9,0,Math.PI*2); ctx.fill();
    diffOut.textContent=(subState.p - subState.q).toFixed(2).replace(/\.00$/,'');
  }
  function setSub(){subState.p=Number(p2.value||0); subState.q=Number(q2.value||0); drawSub()}
  p2.addEventListener('input', setSub); q2.addEventListener('input', setSub);
  byId('randSub').addEventListener('click',()=>{subState.p=+(Math.random()*8-4).toFixed(1); subState.q=+(Math.random()*8-4).toFixed(1); p2.value=subState.p; q2.value=subState.q; drawSub()});
  window.addEventListener('resize',()=>{ if(slides[i].id==='subSlide') drawSub(); });

  // Quick check
  byId('checkQC').addEventListener('click',()=>{
    let total=0,ok=0; [...document.querySelectorAll('.qc')].forEach(inp=>{
      total++; const want=Number(inp.dataset.ans); const got=Number(inp.value);
      if(got===want){inp.style.borderColor='#22c55e'; ok++;} else {inp.style.borderColor='#ef4444';}
    });
    const fb=byId('qcFb'); fb.textContent= ok===total?'‚úÖ Great!':'Score: '+ok+'/'+total; if(ok===total) window._confetti();
  });
  byId('resetQC').addEventListener('click',()=>{document.querySelectorAll('.qc').forEach(i=>{i.value='';i.style.borderColor='#e5e7eb'}); byId('qcFb').textContent='';});

  // Like denominators
  const likePairs=[['5/8','-1/8','+'],['7/9','2/9','-'],['-3/10','4/10','+'],['-5/6','-1/6','+'],['11/12','1/12','-'],['-7/15','2/15','+']];
  const likeState={set:[]};
  function renderLike(){
    const box=byId('likeList'); box.innerHTML=''; likeState.set=[];
    likePairs.sort(()=>Math.random()-0.5).slice(0,4).forEach((t,idx)=>{
      const [a,b,op]=t; const row=document.createElement('div'); row.className='card p-4';
      row.innerHTML=`<div class="text-left font-semibold text-maroon">Item ${idx+1}</div>
        <div class="text-xl mt-1">\\( ${a} ${op} ${b} \\) = <input class="lin border rounded px-2 py-1 w-32" placeholder="e.g., 1/4"></div>`;
      row.dataset.a=a; row.dataset.b=b; row.dataset.op=op; box.appendChild(row);
      likeState.set.push({a,b,op});
    });
    if(window._renderMath) window._renderMath(byId('likeSlide'));
  }
  byId('likeNew').addEventListener('click',renderLike);
  byId('likeCheck').addEventListener('click',()=>{
    let total=0,ok=0; byId('likeList').querySelectorAll('.card').forEach(row=>{
      total++; const A=parseRational(row.dataset.a), B=parseRational(row.dataset.b); const op=row.dataset.op;
      const ans=(op==='+')? addFrac(A,B): subFrac(A,B);
      const inp=row.querySelector('.lin'); const got=parseRational(inp.value);
      if(got && fracEq(toFrac(got[0],got[1]), ans)){inp.style.borderColor='#22c55e'; ok++;} else {inp.style.borderColor='#ef4444';}
    });
    const fb=byId('likeFb'); fb.textContent= ok===total?'‚úÖ All correct!':'Score: '+ok+'/'+total; if(ok===total) window._confetti();
  });

  // Unlike denominators (guided)
  const unlikeState={a:null,b:null,op:null};
  function newUnlike(){
    const den1=[3,4,5,6,8,9][Math.floor(Math.random()*6)];
    const den2=[4,5,6,7,8,9,10][Math.floor(Math.random()*7)];
    const n1=Math.floor(Math.random()*den1), n2=Math.floor(Math.random()*den2);
    const op=Math.random()<0.5?'+':'-';
    const box=byId('unlikeBox'); 
    box.innerHTML = `
      <div class="card p-4">
        <div class="text-xl">\\( \\frac{${n1}}{${den1}} ${op} \\frac{${n2}}{${den2}} \\)</div>
        <ol class="list-decimal ml-5 mt-2">
          <li class="mt-1">LCM = <input id="lcmIn" class="border rounded px-2 py-1 w-28" placeholder="LCM"></li>
          <li class="mt-1">Build equivalents: 
            \\( \\frac{${n1}}{${den1}} = \\)
            <input id="eq1" class="border rounded px-2 py-1 w-24" placeholder="?"> /
            <input id="d1"  class="border rounded px-2 py-1 w-24" placeholder="?"> and
            \\( \\frac{${n2}}{${den2}} = \\)
            <input id="eq2" class="border rounded px-2 py-1 w-24" placeholder="?"> /
            <input id="d2"  class="border rounded px-2 py-1 w-24" placeholder="?">
          </li>
          <li class="mt-1">Operate & simplify: <input id="unAns" class="border rounded px-2 py-1 w-32" placeholder="e.g., 7/12"></li>
        </ol>
      </div>`;
    if(window._renderMath) window._renderMath(byId('unlikeSlide'));
    unlikeState.a=`${n1}/${den1}`; unlikeState.b=`${n2}/${den2}`; unlikeState.op=op;
  }
  byId('unlikeNew').addEventListener('click',newUnlike);
  byId('unlikeCheck').addEventListener('click',()=>{
    const a=parseRational(unlikeState.a), b=parseRational(unlikeState.b); const op=unlikeState.op;
    const L=lcm(a[1],b[1]);
    const A=[a[0]*(L/a[1]), L], B=[b[0]*(L/b[1]), L];
    const ans = (op==='+')? addFrac(A,B) : subFrac(A,B);
    let ok=true;
    function okField(id,val){ const el=byId(id); const good=(String(el.value).trim()==String(val)); el.style.borderColor=good?'#22c55e':'#ef4444'; if(!good) ok=false; }
    okField('lcmIn',L); okField('eq1',A[0]); okField('d1',A[1]); okField('eq2',B[0]); okField('d2',B[1]);
    const got=parseRational(byId('unAns').value);
    if(!(got && fracEq(got, ans))){ok=false; byId('unAns').style.borderColor='#ef4444'} else byId('unAns').style.borderColor='#22c55e';
    byId('unlikeFb').textContent= ok?'‚úÖ Nice work!':'‚ùå Check highlights'; if(ok) window._confetti();
  });

  // Decimals
  const decState={set:[]};
  function newDecSet(){
    const bank=[['2.75','-3.4'],['-1.2','-0.8'],['5.06','-2.31'],['-4.5','1.75'],['3.2','0.45'],['-6.75','-1.25']];
    const box=byId('decList'); box.innerHTML=''; decState.set=[];
    bank.sort(()=>Math.random()-0.5).slice(0,4).forEach((p,idx)=>{
      const [a,b]=p; const op=Math.random()<0.5?'+':'-';
      const row=document.createElement('div'); row.className='card p-4';
      row.innerHTML=`<div class="text-left font-semibold text-maroon">Item ${idx+1}</div>
        <div class="text-xl mt-1">${a} ${op} ${b} = <input class="din border rounded px-2 py-1 w-32" placeholder="e.g., 0.44"></div>`;
      row.dataset.a=a; row.dataset.b=b; row.dataset.op=op; box.appendChild(row);
      decState.set.push({a,b,op});
    });
  }
  byId('decNew').addEventListener('click',newDecSet);
  byId('decCheck').addEventListener('click',()=>{
    let total=0,ok=0; byId('decList').querySelectorAll('.card').forEach(row=>{
      total++;
      const a=parseFloat(row.dataset.a), b=parseFloat(row.dataset.b), op=row.dataset.op;
      const ans = op==='+' ? a + b : a - b;
      const got = Number(row.querySelector('.din').value);
      if(Math.abs(got-ans)<1e-10){row.querySelector('.din').style.borderColor='#22c55e'; ok++;} else {row.querySelector('.din').style.borderColor='#ef4444'}
    });
    const fb=byId('decFb'); fb.textContent= ok===total?'‚úÖ All correct!':'Score: '+ok+'/'+total; if(ok===total) window._confetti();
  });

  /* =========================================================
     PART D: ORDER / MIXED / CHALLENGE
     ========================================================= */
  // Order rationals
  const sortState={items:[]};
  function genRationalString(){
    const t=Math.random();
    if(t<0.33){ // integer
      const v=Math.floor(Math.random()*21)-10; return {disp:String(v), val:v};
    } else if(t<0.66){ // fraction
      const den=[4,5,6,8,10,12][Math.floor(Math.random()*6)];
      const num=Math.floor(Math.random()* (den*2+1)) - den; // -den..den
      return {disp:`\\( \\frac{${num}}{${den}} \\)`, val:num/den};
    } else { // decimal
      const v=Math.round((Math.random()*20-10)*10)/10; return {disp:String(v.toFixed(1).replace(/\\.0$/,'')), val:v};
    }
  }
  function sortNew(){
    const set=[]; while(set.length<5){ set.push(genRationalString()); }
    sortState.items=set;
    const ul=byId('sortList'); ul.innerHTML='';
    set.forEach((o,idx)=>{
      const li=document.createElement('li'); li.className='border rounded px-3 py-2 flex items-center justify-between';
      li.setAttribute('draggable','true'); li.dataset.val=o.val; li.innerHTML=`<span class="text-xl">${o.disp}</span><span class="text-gray-400 text-sm">drag</span>`;
      ul.appendChild(li);
    });
    if(window._renderMath) window._renderMath(byId('sortSlide'));
    enableDrag(ul);
  }
  function enableDrag(ul){
    let dragEl=null;
    ul.querySelectorAll('li').forEach(li=>{
      li.addEventListener('dragstart',()=>{dragEl=li; li.classList.add('dragging')});
      li.addEventListener('dragend',()=>{dragEl=null; li.classList.remove('dragging')});
    });
    ul.addEventListener('dragover',e=>{
      e.preventDefault();
      const after=getDragAfterElement(ul,e.clientY);
      if(after==null) ul.appendChild(dragEl); else ul.insertBefore(dragEl,after);
    });
    function getDragAfterElement(container, y){
      const els=[...container.querySelectorAll('li:not(.dragging)')];
      return els.reduce((closest,child)=>{
        const box=child.getBoundingClientRect();
        const offset=y - box.top - box.height/2;
        if(offset<0 && offset>closest.offset){ return {offset,element:child}; } else { return closest; }
      }, {offset:Number.NEGATIVE_INFINITY}).element;
    }
  }
  byId('sortNew').addEventListener('click',sortNew);
  byId('sortCheck').addEventListener('click',()=>{
    const now=[...byId('sortList').children].map(li=>({val:Number(li.dataset.val), el:li}));
    const sorted=[...now].sort((a,b)=>a.val-b.val);
    let ok=true;
    now.forEach((o,idx)=>{ if(o!==sorted[idx]) ok=false; });
    now.forEach((o,idx)=>o.el.style.borderColor = (o===sorted[idx])? '#22c55e' : '#ef4444');
    byId('sortFb').textContent= ok? '‚úÖ Correct order!' : 'Some items are out of order.';
    if(ok) window._confetti();
  });

  // Mixed generator
  const qText=byId('qText'), ansIn=byId('ans'), qFb=byId('qFb'), qHint=byId('qHint'), level=byId('level');
  let current=null;
  function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}
  function newQuestion(){
    qFb.textContent=''; qHint.textContent=''; ansIn.value='';
    const lvl=level.value; let A,B,op;
    if(lvl==='easy'){ A=[randInt(-9,9),1]; B=[randInt(-9,9),1]; op=Math.random()<0.5?'+':'-'; }
    else if(lvl==='med'){
      if(Math.random()<0.5){
        const d=[4,5,6,8,10][randInt(0,4)]; A=[randInt(-d+1,d-1),d]; B=[randInt(-d+1,d-1),d];
      } else {
        const a=(randInt(-30,30)/10), b=(randInt(-30,30)/10); A=parseRational(String(a)); B=parseRational(String(b));
      }
      op=Math.random()<0.5?'+':'-';
    } else {
      const d1=[3,4,5,6,8,9][randInt(0,5)], d2=[4,5,6,7,8,10][randInt(0,5)];
      A=[randInt(-d1+1,d1-1),d1]; B=[randInt(-d2+1,d2-1),d2]; op=Math.random()<0.5?'+':'-';
    }
    current={A,B,op};
    qText.innerHTML = `\\( ${sFrac(A)} \\ ${op}\\ ${sFrac(B)} \\)`;
    if(window._renderMath) window._renderMath(byId('mixedSlide'));
  }
  byId('newQ').addEventListener('click',newQuestion);
  byId('hintQ').addEventListener('click',()=>{
    if(!current) return;
    const {A,B,op}=current;
    if(A[1]===B[1]) qHint.innerHTML=`<div class="hint">Like denominators: \\( ${sFrac(A)} ${op} ${sFrac(B)} \\Rightarrow ${(op==='+')? (A[0]+'+'+B[0]): (A[0]+'-'+B[0])} \\) over \\( ${A[1]} \\).</div>`;
    else {const L=lcm(A[1],B[1]); qHint.innerHTML=`<div class="hint">Unlike denominators: \\(\\mathrm{LCM}(${A[1]}, ${B[1]}) = ${L}\\). Equivalents: \\( ${sFrac([A[0]*(L/A[1]),L])} ${op} ${sFrac([B[0]*(L/B[1]),L])} \\).</div>`}
    if(window._renderMath) window._renderMath(byId('mixedSlide'));
  });
  byId('checkQ').addEventListener('click',()=>{
    if(!current) return;
    const got=parseRational(ansIn.value); if(!got){qFb.textContent='Enter a valid number/fraction.'; qFb.className='mt-2 h-6 font-semibold text-red-700'; return;}
    const {A,B,op}=current; const ans = op==='+'? addFrac(A,B): subFrac(A,B);
    if(fracEq(got, ans)){qFb.textContent='‚úÖ Correct! '+sFrac(ans); qFb.className='mt-2 h-6 font-semibold text-green-700'; window._confetti();}
    else {qFb.textContent='‚ùå Not quite. Expected '+sFrac(ans); qFb.className='mt-2 h-6 font-semibold text-red-700';}
  });

  // Challenge + Error analysis
  function errorBank(){
    return [
      {work:'\\( (-\\tfrac{3}{4}) + (\\tfrac{1}{2}) = -\\tfrac{4}{6} = -\\tfrac{2}{3} \\)', correct:'Use a common denominator 4: \\( -\\tfrac{3}{4} + \\tfrac{1}{2} = -\\tfrac{3}{4} + \\tfrac{2}{4} = -\\tfrac{1}{4} \\).', key:'A'},
      {work:'\\( 6 - 9 = 3 \\)', correct:'Subtracting a larger number yields a negative: \\( 6-9=-3 \\).', key:'C'},
      {work:'\\( -2.5 - 1.5 = -1.0 \\)', correct:'Both negative: difference is \\( -4.0 \\).', key:'C'},
      {work:'\\( \\tfrac{3}{5} + \\tfrac{1}{2} = \\tfrac{4}{7} \\)', correct:'LCD 10: \\( \\tfrac{3}{5}+\\tfrac{1}{2}=\\tfrac{6}{10}+\\tfrac{5}{10}=\\tfrac{11}{10}=1\\tfrac{1}{10} \\).', key:'A'},
      {work:'\\( 2.6 + (-1.25) = 0.75 \\) (misaligned)', correct:'Align decimals: \\( 2.60 + (-1.25)=1.35 \\).', key:'D'}
    ];
  }
  const errState={item:null};
  function errNew(){
    const bank=errorBank(); errState.item=bank[Math.floor(Math.random()*bank.length)];
    byId('errBox').innerHTML=`Incorrect work:<br/> <div class="mt-1 text-maroon"> ${errState.item.work} </div>`;
    byId('errFb').textContent=''; byId('errRevealBox').textContent='';
    if(window._renderMath) window._renderMath(byId('challengeSlide'));
  }
  byId('errNew').addEventListener('click',errNew);
  byId('errCheck').addEventListener('click',()=>{
    const sel=[...document.querySelectorAll('input[name="errChoice"]')].find(x=>x.checked);
    if(!sel){ byId('errFb').textContent='Choose an option.'; return; }
    if(sel.value===errState.item.key){ byId('errFb').textContent='‚úÖ Correct diagnosis.'; window._confetti(); }
    else { byId('errFb').textContent='‚ùå Not quite. Try again or reveal the correct work.'; }
  });
  byId('errReveal').addEventListener('click',()=>{
    byId('errRevealBox').innerHTML = `<div class="hint">${errState.item.correct}</div>`;
    if(window._renderMath) window._renderMath(byId('challengeSlide'));
  });

})(); // end IIFE
</script>
</body>
</html>
