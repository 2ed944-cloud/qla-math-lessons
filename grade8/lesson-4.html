<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>G8 • Unit 1 • Lesson 4 • Rounding Numbers (QLA) — Enhanced</title>

<!-- Fonts & Tailwind -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<!-- KaTeX: CSS + JS (robust auto-render bootstrap) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>
<script>
  // Boot KaTeX and expose a global re-typeset helper
  window.addEventListener('DOMContentLoaded', () => {
    const run = (root = document.body) => {
      if (!window.renderMathInElement) return;
      window.renderMathInElement(root, {
        delimiters: [
          { left: '$$', right: '$$', display: true },
          { left: '\\[', right: '\\]', display: true },
          { left: '\\(', right: '\\)', display: false }
        ],
        throwOnError: false
      });
    };
    if (window.renderMathInElement) run();
    else {
      const t = setInterval(()=>{ if(window.renderMathInElement){ clearInterval(t); run();}}, 25);
      setTimeout(()=>clearInterval(t), 6000);
    }
    window._rerenderMath = run;
  });
</script>

<style>
  :root{--maroon:#6C1D45;--gold:#C7A34F;--dark:#2C2C2E;--light:#F5F5F5;--accent:#E8D5B7}
  html,body{height:100%;background:#2d3748;color:#111;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  /* Stage */
  #deck{position:relative;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;padding:10px}
  #slides{position:relative;width:100%;max-width:1280px;aspect-ratio:16/9;background:#fff;box-shadow:0 14px 36px rgba(0,0,0,.35);overflow:hidden;border-radius:18px}
  .slide{position:absolute;inset:0;padding:3.5%;display:flex;flex-direction:column;justify-content:flex-start;align-items:center;text-align:left;opacity:0;transform:translateY(14px) scale(.985);transition:.55s ease;pointer-events:none;overflow:auto}
  .slide.active{opacity:1;transform:none;pointer-events:auto}
  .bg-maroon{background-color:var(--maroon)} .text-maroon{color:var(--maroon)} .text-gold{color:var(--gold)}
  .banner{width:100%;height:110px;background:#fff center/contain no-repeat;border-bottom:3px solid var(--gold);border-radius:10px}
  .card{border:1px solid #e5e7eb;border-radius:14px;background:#fafafa}
  .chip{display:inline-flex;align-items:center;gap:.5rem;background:rgba(0,0,0,.05);border-radius:9999px;padding:.35rem .75rem;cursor:pointer}
  .chip:hover{outline:2px solid var(--gold)}
  .btn{padding:.55rem 1rem;border-radius:999px;border:1px solid #e5e7eb;background:#fff;font-weight:700}
  .btn.maroon{background:var(--maroon);color:#fff;border-color:var(--maroon)}
  .btn:hover{filter:brightness(0.98)}
  #controls{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:.5rem;background:rgba(0,0,0,.55);padding:.4rem .6rem;border-radius:999px;z-index:20;backdrop-filter:blur(6px)}
  #controls button{width:42px;height:42px;border-radius:999px;border:none;background:#fff;cursor:pointer;font-weight:700}
  #controls button:hover{transform:scale(1.06)}
  #counter{color:#fff;font-weight:700;min-width:84px;text-align:center}
  #progress{position:fixed;left:0;bottom:0;height:5px;width:0;background:var(--gold);z-index:30;transition:width .35s ease}
  #fsHint{position:absolute;top:10px;right:12px;color:#fff;background:rgba(0,0,0,.35);padding:.25rem .5rem;border-radius:8px;font-size:.8rem}

  .hint{background:#fff3cd;border:1px solid #ffe69c;border-radius:10px;padding:.6rem .75rem}
  .note{background:#e7f5ff;border:1px solid #a5d8ff;border-radius:10px;padding:.6rem .75rem}
  .success{background:#ecfdf5;border:1px solid #34d399}
  .tok{display:inline-block;padding:.05rem .25rem;border-radius:6px}

  /* Number line */
  .nl-wrap{width:100%;max-width:920px}
  canvas.nline{width:100%;height:170px;border-radius:12px;background:linear-gradient(180deg,#fff,#fafafa);border:2px solid #ececec}

  /* Popover */
  #pop{position:fixed;inset:auto auto 20px 20px;max-width:min(520px,92vw);background:#fff;border:2px solid var(--gold);border-radius:12px;box-shadow:0 12px 28px rgba(0,0,0,.25);padding:14px 16px;z-index:40;display:none;text-align:left}
  #pop strong{color:var(--maroon)} #pop .close{float:right;color:#666;cursor:pointer;font-weight:800}

  /* Notebook */
  #notebook{position:fixed;right:18px;bottom:74px;z-index:35;width:340px;max-width:90vw;background:#fff;border:2px solid var(--gold);border-radius:12px;box-shadow:0 12px 28px rgba(0,0,0,.25);display:none}
  #nbHead{display:flex;align-items:center;justify-content:space-between;background:var(--maroon);color:#fff;padding:.5rem .75rem;border-radius:10px 10px 0 0}
  #nbBody{padding:.6rem}
  #nbToggle{position:fixed;right:18px;bottom:18px;z-index:36}
  #nbToggle button{border-radius:999px;background:var(--gold);border:2px solid var(--gold);padding:.55rem 1rem;font-weight:800}

  /* Teacher notes */
  .teach{display:none}
  .teach.on{display:block}

  .confetti{position:fixed;pointer-events:none;z-index:50}
</style>
</head>
<body>

<div id="deck" aria-live="polite">
  <div id="slides" class="relative">
    <div id="fsHint">Press <strong>F</strong> for fullscreen</div>

    <!-- 0 • Title -->
    <section class="slide active bg-maroon text-white" id="titleSlide">
      <div class="w-full h-16 banner mb-6 rounded-md" style="background-image:url('qla_banner.png')" aria-label="QLA Partner Banner"></div>
      <div class="flex items-center gap-8">
        <img src="qla_logo.png" alt="QLA Logo" class="h-20 w-auto" onerror="this.style.display='none'"/>
        <div class="text-left">
          <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight">Unit 1 — Lesson 4: Rounding Numbers</h1>
          <p class="text-gold text-2xl md:text-3xl mt-2 font-semibold">Grade 8 • Whole numbers • Decimals • Significant Figures • Bounds</p>
          <p class="mt-2 text-lg">Qatar Leadership Academy — Mathematics</p>
        </div>
      </div>
      <div class="mt-6 grid md:grid-cols-3 gap-4 w-full max-w-5xl text-left">
        <div class="card p-4"><div class="text-lg font-bold">Lesson Flow</div><div>Clarify → Explore → Apply → Reflect</div></div>
        <div class="card p-4"><div class="text-lg font-bold">Tools</div><div>Number‑line explorer • Place‑value lens • Generators • Qatar labs</div></div>
        <div class="card p-4"><div class="text-lg font-bold">Standards</div><div>Aligned to AERO 8.NS &amp; 8.EE readiness.</div></div>
      </div>
      <div class="absolute bottom-6 text-sm text-gray-100">Student‑centred • Predict → Check → Explain • Local applications</div>
    </section>

    <!-- 1 • Learning Objectives & Keywords (w/ Success Criteria + search) -->
    <section class="slide" id="loSlide">
      <h2 class="text-4xl font-extrabold text-maroon mb-2">Learning Objectives, Success Criteria &amp; Keywords</h2>
      <div class="grid lg:grid-cols-3 gap-6 text-left w-full max-w-6xl">
        <!-- LOs -->
        <div class="card p-5 lg:col-span-2">
          <h3 class="text-2xl font-bold text-maroon mb-1">Learning Objectives</h3>
          <ul class="list-disc list-inside space-y-2 text-lg">
            <li>Explain <strong>why</strong> we round and how the <em>half‑up rule</em> works for positive and negative numbers.</li>
            <li>Round to a specified <strong>place value</strong> or <strong>decimal places</strong>, and to a desired number of <strong>significant figures</strong>.</li>
            <li>Use <strong>scientific notation</strong> and round the mantissa correctly.</li>
            <li>Interpret and write <strong>bounds</strong> for rounded values; relate to <em>absolute error</em> and <em>precision</em>.</li>
            <li>Choose appropriate rounding in <strong>Qatar‑based contexts</strong> (QAR prices, Metro times, distances) and justify reasonableness.</li>
          </ul>
          <div class="mt-3 note">
            <div class="font-semibold">Success Criteria (tick as you go)</div>
            <div class="grid md:grid-cols-2 gap-2 mt-2" id="scList">
              <label class="flex items-center gap-2"><input type="checkbox" class="sc"/> I can identify the rounding digit and the “next digit”.</label>
              <label class="flex items-center gap-2"><input type="checkbox" class="sc"/> I can apply half‑up consistently (including negatives).</label>
              <label class="flex items-center gap-2"><input type="checkbox" class="sc"/> I can state correct bounds for a rounded value.</label>
              <label class="flex items-center gap-2"><input type="checkbox" class="sc"/> I can explain <em>why</em> my rounding choice is suitable for a context.</label>
            </div>
            <div class="mt-2 text-sm">Progress: <span id="scProgress" class="font-bold">0/4</span></div>
          </div>
        </div>
        <!-- Keywords -->
        <div class="card p-5">
          <h3 class="text-2xl font-bold text-maroon mb-1">Keywords</h3>
          <input id="glossSearch" class="border rounded px-2 py-1 w-full mb-2" placeholder="Search keywords (e.g., bounds, mantissa)…"/>
          <div class="flex flex-wrap gap-2 text-sm" id="glossTags">
            <!-- chips injected by JS -->
          </div>
          <p class="text-xs text-gray-500 mt-3">Tap any keyword to view a crisp definition &amp; example. Uses the **school standard** half‑up rule (ties away from 0).</p>
        </div>
      </div>
      <div class="teach card p-3 mt-3" id="teachLO"><strong>Teacher note:</strong> Invite students to co‑create “success criteria” language; keep them visible and update the progress counter during transitions.</div>
    </section>

    <!-- 2 • Why Rounding? (Pre‑activity clarity) -->
    <section class="slide" id="whySlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Why do we round? What changes — and what doesn’t?</h2>
      <div class="grid lg:grid-cols-2 gap-5 w-full max-w-6xl">
        <div class="card p-5">
          <div class="text-lg">
            <p><strong>Purpose.</strong> Rounding makes numbers easier to communicate and compute with, while keeping them close enough for decisions.</p>
            <p class="mt-2"><strong>Key idea.</strong> Choose a <em>unit of precision</em> (e.g., 1, 0.1, 10, 0.25 QAR). Rounding maps a value to the nearest multiple of that unit using the <em>half‑up</em> rule.</p>
            <p class="mt-2"><strong>What stays the same?</strong> The rounded number represents an <em>interval</em> of possible true values (the <em>bounds</em>).</p>
          </div>
          <div class="mt-3 hint text-sm">Tie‑break rule: if the next digit is 5 (or the fractional part equals half the unit), round <em>away from 0</em>.</div>
          <div class="mt-3 text-sm">Before we dive in: decide what unit would be reasonable in each: prices (QAR), time (minutes), distance (km), population (thousands).</div>
        </div>
        <div class="card p-5">
          <div class="font-bold text-maroon mb-2">Clarify first — then explore</div>
          <ol class="list-decimal list-inside space-y-2 text-lg">
            <li><strong>Predict</strong> what happens when you change the rounding unit.</li>
            <li><strong>Check</strong> using the interactive tools.</li>
            <li><strong>Explain</strong> your decision using bounds and context.</li>
          </ol>
          <div class="mt-3">
            <label class="chip">Notebook prompt</label>
            <textarea id="nbPromptWhy" class="border rounded w-full p-2 mt-1" rows="3" placeholder="Where would rounding be helpful in your day (Doha Metro, Souq Waqif, sports timings)? Why?"></textarea>
            <button class="btn mt-2" id="nbSaveWhy">Save to Notebook</button>
          </div>
        </div>
      </div>
      <div class="teach card p-3 mt-3"><strong>Teacher note:</strong> Quick pair share: “Which unit makes sense for QAR cash payments?” (Allow students to suggest 0.50 or 0.25 QAR and use it later.)</div>
    </section>

    <!-- 3 • Warm‑up Quick Check (clarified) -->
    <section class="slide" id="warmSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Warm‑Up: Decide Fast!</h2>
      <p class="text-gray-700 mb-2">Identify the <em>rounding digit</em> and use the <em>next digit</em> to decide. Ties (5) go away from 0.</p>
      <div class="grid md:grid-cols-3 gap-4 w-full max-w-5xl">
        <div class="card p-4">
          <div class="font-bold text-maroon mb-1">Nearest hundred</div>
          <div class="text-xl">\( 12{,}649 \) → <input id="w1" class="border rounded px-2 py-1 w-32" placeholder="e.g., 12,600"></div>
        </div>
        <div class="card p-4">
          <div class="font-bold text-maroon mb-1">1 decimal place</div>
          <div class="text-xl">\( 7.45 \) → <input id="w2" class="border rounded px-2 py-1 w-24" placeholder="7.5"></div>
        </div>
        <div class="card p-4">
          <div class="font-bold text-maroon mb-1">Nearest integer (negative)</div>
          <div class="text-xl">\( -2.5 \) → <input id="w3" class="border rounded px-2 py-1 w-24" placeholder="-3"></div>
        </div>
      </div>
      <div class="mt-3 flex gap-2">
        <button id="warmCheck" class="btn maroon">Check</button>
        <button id="warmReset" class="btn">Reset</button>
      </div>
      <div id="warmFb" class="mt-2 h-6 font-semibold"></div>
      <div class="teach card p-3 mt-3"><strong>Teacher note:</strong> Ask “Which digit decided the rounding each time?” to surface the rule in student language.</div>
    </section>

    <!-- 4 • Place Value & Rule (guided discovery) -->
    <section class="slide" id="placeSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Guided Discovery: Place Value &amp; The Rounding Rule</h2>
      <div class="grid lg:grid-cols-2 gap-6 w-full max-w-5xl">
        <div class="card p-5">
          <p class="mb-2"><strong>Predict → Check → Explain.</strong> Highlight the rounding digit and the next digit, then decide.</p>
          <div class="text-2xl" id="pvNumber"></div>
          <div class="mt-2 flex items-center gap-3">
            <label>Round to:</label>
            <select id="pvPlace" class="border rounded px-2 py-1">
              <option value="1">ones</option>
              <option value="10">tens</option>
              <option value="100">hundreds</option>
              <option value="1000">thousands</option>
              <option value="0.1">tenths (1 dp)</option>
              <option value="0.01" selected>hundredths (2 dp)</option>
              <option value="0.001">thousandths (3 dp)</option>
            </select>
            <button id="pvNew" class="btn">New number</button>
          </div>
          <div class="mt-2">Your prediction: <input id="pvPred" class="border rounded px-2 py-1 w-40" placeholder="type your rounded value"></div>
          <div class="mt-2">Result: <span id="pvResult" class="font-bold"></span>
            <button class="btn ml-2" id="pvCheck">Check</button>
          </div>
          <div id="pvFb" class="mt-2 h-6 font-semibold"></div>
          <div class="hint mt-3 text-sm">Rule: look at the digit <em>to the right</em>. If it’s 5–9, increase the rounding digit by 1; if 0–4, keep it the same. For negatives, “away from 0” at 5.</div>
        </div>
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon mb-2">Explain (in your own words)</h3>
          <textarea id="pvExplain" class="border rounded w-full p-2" rows="6" placeholder="Explain how you knew whether to round up or down. Mention the rounding digit and the next digit."></textarea>
          <div class="mt-2 flex gap-2">
            <button class="btn" id="pvSave">Save to Notebook</button>
            <button id="pvExportCSV" class="btn">Export CSV</button>
            <button id="pvExportJSON" class="btn">Export JSON</button>
          </div>
          <h3 class="text-xl font-bold text-maroon mt-4 mb-2">Examples</h3>
          <div class="space-y-1 text-lg">
            <div>\( 246.38 \) to 1 dp → \( 246.4 \)</div>
            <div>\( 7{,}950 \) to nearest thousand → \( 8{,}000 \)</div>
            <div>\( -12.5 \) to integer → \( -13 \)</div>
          </div>
        </div>
      </div>
    </section>

    <!-- 5 • Rounding Explorer (Number Line) -->
    <section class="slide" id="lineSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Explore: Number Line &amp; Boundaries</h2>
      <p class="text-gray-700 mb-2">Choose a unit. The dashed lines show the midpoints; the rounded value stays constant until you cross one.</p>
      <div class="nl-wrap"><canvas id="roundLine" class="nline" aria-label="Rounding number line"></canvas></div>
      <div class="mt-3 flex flex-wrap items-center gap-3 text-sm">
        <label class="chip">x = <input id="lineX" class="border rounded px-2 py-1 w-28" value="23.47"></label>
        <label class="chip">unit = 
          <select id="lineUnit" class="border rounded px-2 py-1">
            <option value="1">1 (nearest integer)</option>
            <option value="0.1" selected>0.1 (1 dp)</option>
            <option value="0.01">0.01 (2 dp)</option>
            <option value="10">10 (nearest 10)</option>
            <option value="100">100 (nearest 100)</option>
          </select>
        </label>
        <span class="chip">rounded = <b id="lineOut">23.5</b></span>
        <button id="lineRand" class="btn">Randomize</button>
        <button id="lineExportCSV" class="btn">Export CSV</button>
        <button id="lineExportJSON" class="btn">Export JSON</button>
      </div>
      <div class="mt-3 note text-sm">
        <strong>Predict → Check → Explain.</strong> Predict where the midpoints fall, then drag \(x\) across a midpoint: what happens to the rounded value? Record one observation in your notebook.
      </div>
    </section>

    <!-- 6 • Practice Generator (multi-set) -->
    <section class="slide" id="pracSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Practice Generator (Multi‑Set)</h2>
      <div class="card p-5 w-full max-w-6xl">
        <div class="flex flex-wrap items-center gap-3">
          <span>Level:</span>
          <select id="prLevel" class="border rounded px-2 py-1">
            <option value="easy">easy (nearest 10/100, 1 dp)</option>
            <option value="med" selected>medium (−numbers, 2–3 dp)</option>
            <option value="hard">hard (mixed places)</option>
            <option value="expert">expert (incl. s.f.)</option>
          </select>
          <span>Sets:</span>
          <select id="prSets" class="border rounded px-2 py-1">
            <option>1</option><option selected>2</option><option>3</option>
          </select>
          <span>Questions per set:</span>
          <select id="prCount" class="border rounded px-2 py-1">
            <option>4</option><option selected>6</option><option>8</option>
          </select>
          <button id="prNew" class="btn">Generate</button>
          <button id="prCheck" class="btn maroon">Check All</button>
          <button id="prExportCSV" class="btn">Export CSV</button>
          <button id="prExportJSON" class="btn">Export JSON</button>
          <span class="chip">Score: <b id="prFb">0</b></span>
        </div>
        <div id="prList" class="grid md:grid-cols-2 gap-3 mt-3"></div>
      </div>
      <div class="hint mt-2 text-sm w-full max-w-6xl">Student‑centred: Work a question, then write one sentence justifying the unit choice (“nearest 10” vs “1 dp”). Swap with a partner to peer‑check the justification.</div>
    </section>

    <!-- 7 • Significant Figures (multi-set) -->
    <section class="slide" id="sigSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Significant Figures</h2>
      <div class="grid lg:grid-cols-2 gap-6 w-full max-w-6xl">
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon mb-2">Count s.f.</h3>
          <div class="flex flex-wrap items-center gap-3 mb-2">
            <span>Sets:</span>
            <select id="sigCountSets" class="border rounded px-2 py-1"><option>1</option><option selected>2</option><option>3</option></select>
            <button id="sigCountNew" class="btn">Generate</button>
            <button id="sigCountCheck" class="btn maroon">Check</button>
            <button id="sigCountCSV" class="btn">CSV</button>
            <button id="sigCountJSON" class="btn">JSON</button>
            <span class="chip">Score: <b id="sigCountFb">0</b></span>
          </div>
          <div id="sigCountList" class="grid gap-2"></div>
        </div>
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon mb-2">Round to n s.f.</h3>
          <div class="flex flex-wrap items-center gap-3 mb-2">
            <span>Sets:</span>
            <select id="sigRoundSets" class="border rounded px-2 py-1"><option>1</option><option selected>2</option><option>3</option></select>
            <button id="sigRoundNew" class="btn">Generate</button>
            <button id="sigRoundCheck" class="btn maroon">Check</button>
            <button id="sigRoundCSV" class="btn">CSV</button>
            <button id="sigRoundJSON" class="btn">JSON</button>
            <span class="chip">Score: <b id="sigRoundFb">0</b></span>
          </div>
          <div id="sigRoundList" class="grid gap-2"></div>
        </div>
      </div>
      <div class="hint mt-3 text-sm">Rules: ignore **leading zeros**; zeros **between** non‑zeros count; **trailing zeros** count <em>only</em> if there’s a decimal point (e.g., \(1200\) has 2 s.f.; \(1200.\) has 4 s.f.).</div>
      <div class="teach card p-3 mt-3"><strong>Teacher note:</strong> Ask groups to invent a counterexample that looks like 3 s.f. but is actually 2 s.f., and explain why.</div>
    </section>

    <!-- 8 • Scientific Notation (multi-set) -->
    <section class="slide" id="sciSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Scientific Notation (Round the Mantissa)</h2>
      <div class="card p-5 w-full max-w-6xl">
        <div class="flex flex-wrap items-center gap-3">
          <span>Sets:</span>
          <select id="sciSets" class="border rounded px-2 py-1"><option>1</option><option selected>2</option><option>3</option></select>
          <button id="sciNew" class="btn">Generate</button>
          <button id="sciCheck" class="btn maroon">Check</button>
          <button id="sciCSV" class="btn">CSV</button>
          <button id="sciJSON" class="btn">JSON</button>
          <span class="chip">Score: <b id="sciFb">0</b></span>
        </div>
        <div id="sciList" class="grid md:grid-cols-2 gap-3 mt-3"></div>
      </div>
      <div class="note mt-2 text-sm">Exploration: When does rounding push the mantissa to \(10\) and increase the exponent? Record one example.</div>
    </section>

    <!-- 9 • Bounds / Error Intervals (multi-set) -->
    <section class="slide" id="boundSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Bounds &amp; Error Intervals</h2>
      <div class="card p-5 w-full max-w-6xl">
        <p class="mb-2">If \( x \) rounds to \( r \) to unit \(u\), then \( x\in [\,r-\tfrac{u}{2},\; r+\tfrac{u}{2}\,) \). Left‑closed, right‑open.</p>
        <div class="flex flex-wrap items-center gap-3 mb-2">
          <span>Sets:</span>
          <select id="bdSets" class="border rounded px-2 py-1"><option>1</option><option selected>2</option><option>3</option></select>
          <button id="bdNew" class="btn">Generate</button>
          <button id="bdCheck" class="btn maroon">Check</button>
          <button id="bdCSV" class="btn">CSV</button>
          <button id="bdJSON" class="btn">JSON</button>
          <span class="chip">Score: <b id="bdFb">0</b></span>
        </div>
        <div id="bdList" class="grid md:grid-cols-2 gap-3"></div>
      </div>
      <div class="hint mt-2 text-sm">Student‑centred prompt: “Which interval endpoint is included and why? Show with a number line sketch.”</div>
    </section>

    <!-- 10 • Qatar Applications Lab -->
    <section class="slide" id="qatarSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Qatar Applications Lab</h2>
      <div class="card p-5 w-full max-w-6xl">
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <div class="font-bold text-maroon">A) Cash Rounding — QAR</div>
            <p class="text-sm text-gray-600 mb-1">Choose a coin unit and estimate a shopping total.</p>
            <div class="flex flex-wrap items-center gap-2 text-sm mb-2">
              <label>Coin unit:
                <select id="qarUnit" class="border rounded px-2 py-1">
                  <option value="0.05">0.05 QAR</option>
                  <option value="0.25" selected>0.25 QAR</option>
                  <option value="0.5">0.50 QAR</option>
                  <option value="1">1.00 QAR</option>
                </select>
              </label>
              <button id="qarNew" class="btn">New basket</button>
              <button id="qarCheck" class="btn maroon">Check</button>
            </div>
            <div id="qarList" class="space-y-1"></div>
            <div class="mt-2">Estimated total (rounded to coin): <input id="qarAns" class="border rounded px-2 py-1 w-32" placeholder="QAR ..."></div>
            <div id="qarFb" class="mt-2 h-6 font-semibold"></div>
          </div>
          <div>
            <div class="font-bold text-maroon">B) Doha Metro Timing</div>
            <p class="text-sm text-gray-600 mb-1">Round journey time to the nearest minute; compare to schedule margins.</p>
            <div class="flex flex-wrap items-center gap-2 text-sm mb-2">
              <button id="metroNew" class="btn">New trips</button>
              <button id="metroCheck" class="btn maroon">Check</button>
            </div>
            <div id="metroList" class="space-y-1"></div>
            <div id="metroFb" class="mt-2 h-6 font-semibold"></div>
          </div>
        </div>
        <div class="mt-4">
          <div class="font-bold text-maroon">C) Local Distances / Event Crowds</div>
          <p class="text-sm text-gray-600 mb-1">Round distances to 1 dp and crowds to the nearest thousand; discuss reasonableness.</p>
          <div class="flex flex-wrap items-center gap-2 text-sm mb-2">
            <button id="qatCtxNew" class="btn">New set</button>
            <button id="qatCtxCheck" class="btn maroon">Check</button>
          </div>
          <div id="qatCtxList" class="grid md:grid-cols-2 gap-3"></div>
          <div id="qatCtxFb" class="mt-2 h-6 font-semibold"></div>
        </div>
      </div>
      <div class="note mt-2 text-sm">Explain your rounding choices: Why is 0.25 QAR sensible (or not) for your basket? When would 1 dp for distance be too crude?</div>
    </section>

    <!-- 11 • Challenge Mode -->
    <section class="slide" id="challengeSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Challenge Mode</h2>
      <div class="card p-5 w-full max-w-6xl">
        <div class="flex flex-wrap items-center gap-3">
          <span>Level:</span>
          <select id="chLevel" class="border rounded px-2 py-1">
            <option value="easy">easy</option>
            <option value="med" selected>medium</option>
            <option value="hard">hard</option>
            <option value="expert">expert</option>
          </select>
          <button id="chNew" class="btn">New question</button>
          <span class="chip">Streak: <b id="streakOut">0</b></span>
          <button id="chCSV" class="btn">Export CSV</button>
          <button id="chJSON" class="btn">Export JSON</button>
        </div>
        <div class="mt-3 text-2xl">Task: <span id="chText" class="font-extrabold"></span></div>
        <div class="mt-2">
          <input id="chAns" class="border rounded px-3 py-2 w-60" placeholder="answer"/>
          <button id="chCheck" class="btn maroon">Check</button>
          <button id="chHint" class="btn">Hint</button>
        </div>
        <div id="chHintBox" class="mt-3 text-sm"></div>
        <div id="chFb" class="mt-2 h-6 font-semibold"></div>
      </div>
    </section>

    <!-- 12 • Exit ticket -->
    <section class="slide" id="exitSlide">
      <h2 class="text-4xl font-extrabold text-maroon mb-2">Exit Ticket</h2>
      <div class="grid md:grid-cols-2 gap-6 text-left max-w-6xl">
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon">3–2–1 Reflect</h3>
          <ul class="list-disc list-inside">
            <li>3 rounding skills you used (place, s.f., bounds)</li>
            <li>2 contexts where rounding was helpful</li>
            <li>1 mistake you will avoid next time</li>
          </ul>
          <textarea id="exitText" class="border rounded w-full p-2 mt-2" rows="5" placeholder="Write your reflection…"></textarea>
          <button id="exitSave" class="btn mt-2">Save to Notebook</button>
        </div>
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon">Up Next</h3>
          <p>Estimation in multi‑step calculations and percent error comparisons.</p>
          <div class="mt-3">
            <div class="font-bold">Self‑check</div>
            <label class="flex items-center gap-2"><input type="checkbox" class="sc"/> I can compute and interpret percent error for a rounded value.</label>
          </div>
        </div>
      </div>
      <div class="absolute bottom-4 left-1/2 -translate-x-1/2 w-[88%] h-[100px] banner rounded-md" style="background-image:url('qla_banner.png')"></div>
    </section>

  </div>
</div>

<!-- Controls -->
<div id="controls" role="group" aria-label="Slideshow controls">
  <button id="prev" title="Previous (←)">&laquo;</button>
  <button id="fs" title="Toggle Fullscreen (F)">⤢</button>
  <div id="counter">1 / 13</div>
  <button id="next" title="Next (→)">&raquo;</button>
</div>
<div id="progress"></div>

<!-- Glossary popover -->
<div id="pop" role="dialog" aria-modal="true" aria-live="polite">
  <span class="close" title="Close">✕</span>
  <div id="popBody"></div>
</div>

<!-- Notebook -->
<div id="notebook">
  <div id="nbHead">
    <div class="font-bold">Student Notebook</div>
    <div class="flex items-center gap-2">
      <button id="nbExport" class="bg-white text-maroon px-2 py-1 rounded">Export</button>
      <button id="nbClear" class="bg-white text-maroon px-2 py-1 rounded">Clear</button>
      <button id="nbClose" class="bg-white text-maroon px-2 py-1 rounded">✕</button>
    </div>
  </div>
  <div id="nbBody">
    <textarea id="nbText" rows="10" class="w-full border rounded p-2" placeholder="Your saved reflections and explanations appear here…"></textarea>
    <div class="text-right mt-2 text-xs text-gray-600">Autosaves locally</div>
  </div>
</div>
<div id="nbToggle"><button title="Open Notebook">Notebook</button></div>

<script>
/* ------------------------- Core Helpers ------------------------- */
(function(){
  const slides=[...document.querySelectorAll('.slide')];
  const prev=id('prev'), next=id('next'), counter=id('counter'), progress=id('progress'), fsBtn=id('fs');
  const deckTitle='G8_Unit1_L4_Rounding_QLA_ENH';
  let i=0;

  function id(x){return document.getElementById(x)}
  function renderMath(root=document){ if(window._rerenderMath) window._rerenderMath(root); }
  function confetti(x=window.innerWidth/2,y=window.innerHeight/2){
    for(let k=0;k<24;k++){
      const d=document.createElement('div'); d.className='confetti';
      d.style.left=x+'px'; d.style.top=y+'px'; d.style.width='8px'; d.style.height='8px';
      d.style.background=['#6C1D45','#C7A34F','#E8D5B7','#8a3d64'][k%4];
      document.body.appendChild(d);
      const dx=(Math.random()*2-1)*240, dy=(Math.random()*-1-0.3)*300, rot=Math.random()*720;
      d.animate([{transform:'translate(0,0) rotate(0deg)'},{transform:`translate(${dx}px,${dy}px) rotate(${rot}deg)`,opacity:0}],
                {duration:900+Math.random()*700,easing:'cubic-bezier(.2,.8,.2,1)'}).onfinish=()=>d.remove();
    }
  }
  // Export helpers
  function downloadJSON(filename, data){
    const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download=filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }
  function downloadCSV(filename, rows){
    const csv=rows.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
    const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download=filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }
  function fmtThousands(x){ return String(x).replace(/\B(?=(\d{3})+(?!\d))/g, ','); }

  /* ---------- Navigation ---------- */
  function show(k){
    i=(k+slides.length)%slides.length;
    slides.forEach((s,idx)=>s.classList.toggle('active',idx===i));
    counter.textContent=(i+1)+' / '+slides.length;
    progress.style.width=((i+1)/slides.length*100)+'%';
    const sid=slides[i].id||'';
    if(sid==='lineSlide') drawRoundLine();
    if(sid==='placeSlide') renderPV();
    if(sid==='qatarSlide'){ if(!qarState.items.length) qarNew(); if(!metroState.items.length) metroNew(); if(!qatCtxState.items.length) qatCtxNew(); }
    renderMath(slides[i]);
  }
  prev.addEventListener('click',()=>show(i-1));
  next.addEventListener('click',()=>show(i+1));
  document.addEventListener('keydown',e=>{
    if(e.key==='ArrowRight') show(i+1);
    if(e.key==='ArrowLeft') show(i-1);
    if(e.key.toLowerCase()==='f') toggleFS();
    if(e.key.toLowerCase()==='t') toggleTeach();
  });
  function toggleFS(){
    const el=id('slides');
    if(!document.fullscreenElement){(el.requestFullscreen||el.webkitRequestFullscreen||el.msRequestFullscreen).call(el);}
    else{(document.exitFullscreen||document.webkitExitFullscreen||document.msExitFullscreen).call(document);}
  }
  fsBtn.addEventListener('click',toggleFS);

  /* ------------------------- Notebook ------------------------- */
  const nb = id('notebook'), nbToggle = id('nbToggle');
  const nbText = id('nbText');
  const NB_KEY='QLA_Rounding_Notebook';
  function nbOpen(){ nb.style.display='block'; nbText.value=localStorage.getItem(NB_KEY)||''; }
  function nbClose(){ nb.style.display='none'; localStorage.setItem(NB_KEY, nbText.value||''); }
  nbToggle.addEventListener('click', nbOpen);
  id('nbClose').addEventListener('click', nbClose);
  id('nbExport').addEventListener('click', ()=>downloadJSON(`${deckTitle}_notebook.json`, {text: nbText.value||''}));
  id('nbClear').addEventListener('click', ()=>{ if(confirm('Clear notebook?')){ nbText.value=''; localStorage.removeItem(NB_KEY);} });
  nbText.addEventListener('input', ()=>localStorage.setItem(NB_KEY, nbText.value||''));

  // Helpers to save text to notebook
  function saveToNB(text){ const cur = localStorage.getItem(NB_KEY)||''; const next=(cur?(cur+'\n\n'):'')+text; localStorage.setItem(NB_KEY,next); }

  /* ------------------------- Success Criteria ------------------------- */
  const scBoxes=[...document.querySelectorAll('.sc')];
  const scProgress=id('scProgress');
  function updateSC(){
    const checked=scBoxes.filter(x=>x.checked).length;
    const total=scBoxes.length>=4?4:scBoxes.length; // count the main 4
    scProgress.textContent=`${Math.min(checked,4)}/${total}`;
  }
  scBoxes.forEach(b=>b.addEventListener('change',updateSC));
  updateSC();

  /* ------------------------- Rounding Logic ------------------------- */
  // Symmetric half-up rounding to nearest multiple of unit u
  function roundHalfUpToUnit(x,u){
    const q=x/u;
    const s=q>=0?1:-1, a=Math.abs(q);
    const k = Math.floor(a + 0.5);
    return s*k*u;
  }
  function decPlacesFromUnit(u){ if(u>=1) return 0; const p = Math.round(Math.log10(1/u)); return Math.max(0,p); }
  function fmtToUnit(x,u){ const dp = decPlacesFromUnit(u); return (Math.round((x+0)*10**dp)/10**dp).toFixed(dp); }
  function roundToDP(x,dp){ const u=10**(-dp); return roundHalfUpToUnit(x,u); }
  // Significant figures
  function roundToSig(x,n){
    if(x===0) return 0;
    const s = x<0? -1: 1;
    const ax = Math.abs(x);
    const k = Math.floor(Math.log10(ax));
    const scale = 10**(k-n+1);
    return s*roundHalfUpToUnit(ax, scale);
  }
  function countSigStr(s){
    s = s.trim();
    if(/^0*\.?0*$/.test(s)) return 1; // zero has 1 s.f.
    const hasDot = s.includes('.');
    s = s.replace(/^[-+]/,'');
    let t = s;
    if(!hasDot) t = t.replace(/0+$/,'');
    t = t.replace(/^0+/,'').replace('.','');
    return t.replace(/[^0-9]/g,'').length;
  }
  // Scientific notation rounding (mantissa in [1,10))
  function sciRound(m,e,n){
    let r = roundToSig(m, n);
    if(Math.abs(r)>=10){ r = r/10; e += 1; }
    return {m:r,e};
  }

  /* ------------------------- Glossary ------------------------- */
  const POP=id('pop'), POP_BODY=id('popBody');
  const GLOS={
    'half‑up rounding':'<strong>Half‑up rounding</strong>: if the next digit is 5–9, round away from 0; if 0–4, round toward 0.',
    'place value':'<strong>Place value</strong>: position of a digit (ones, tens, hundreds, tenths, hundredths, …).',
    'decimal places (dp)':'<strong>Decimal places</strong>: number of digits to the right of the decimal point.',
    'significant figures (s.f.)':'<strong>Significant figures</strong>: digits that convey precision (ignore leading zeros; trailing zeros count if a decimal point is present).',
    'scientific notation':'<strong>Scientific notation</strong>: \(a\\times10^n\) with \(1\\le |a|<10\).',
    'bounds / error interval':'<strong>Bounds</strong>: the interval of true values represented by a rounded number; typically \([r-\\frac{u}{2},\, r+\\frac{u}{2})\).',
    'estimation':'<strong>Estimation</strong>: using rounded numbers to quickly approximate a result.',
    'rounding digit':'<strong>Rounding digit</strong>: the digit at the place you are rounding to.',
    'next digit':'<strong>Next digit</strong>: the digit immediately to the right of the rounding digit; it decides up/down.',
    'unit of precision':'<strong>Unit of precision</strong>: the rounding unit \(u\) (e.g., 1, 0.1, 10, 0.25 QAR).',
    'tie':'<strong>Tie</strong>: when the fractional part equals half the unit (e.g., 2.5 for unit 1). In half‑up, ties go away from 0.',
    'absolute error':'<strong>Absolute error</strong>: \( |\\text{true} - \\text{rounded}|\\), at most \(\\tfrac{u}{2}\).',
    'percent error':'<strong>Percent error</strong>: \( \\dfrac{|\\text{true}-\\text{rounded}|}{|\\text{true}|}\\times 100\\%\\).',
    'precision':'<strong>Precision</strong>: the granularity of measurement (smaller unit → greater precision).',
    'interval notation':'<strong>Interval notation</strong>: e.g., \([a,b)\\) includes \(a\) but not \(b\).',
    'mantissa':'<strong>Mantissa</strong>: the \(a\) in \(a\\times10^n\) (with \(1\\le |a|<10\)).',
    'exponent':'<strong>Exponent</strong>: the \(n\) in \(a\\times10^n\).'
  };
  const KEYWORDS=Object.keys(GLOS);
  function injectGlossaryChips(){
    const box=id('glossTags'); box.innerHTML='';
    KEYWORDS.forEach(k=>{
      const sp=document.createElement('span');
      sp.className='chip'; sp.dataset.key=k; sp.textContent=k;
      box.appendChild(sp);
    });
  }
  injectGlossaryChips();
  POP.querySelector('.close').addEventListener('click',()=>POP.style.display='none');
  document.addEventListener('click',e=>{
    const el=e.target.closest('.chip'); if(el && el.dataset.key && GLOS[el.dataset.key]){
      POP_BODY.innerHTML=GLOS[el.dataset.key]; POP.style.display='block';
      const r=el.getBoundingClientRect(); POP.style.left=Math.min(r.left, window.innerWidth-POP.offsetWidth-20)+'px'; POP.style.bottom=(window.innerHeight-r.top+10)+'px';
      renderMath(POP);
    }
  });
  id('glossSearch').addEventListener('input',e=>{
    const q=e.target.value.toLowerCase();
    const chips=[...id('glossTags').children];
    chips.forEach(c=>c.style.display = c.textContent.toLowerCase().includes(q)?'inline-flex':'none');
  });

  /* ------------------------- Warm-up ------------------------- */
  id('warmCheck').addEventListener('click',()=>{
    const v1=id('w1').value.replace(/,/g,''); const ok1 = (Number(v1)===12600);
    const ok2 = Math.abs(Number(id('w2').value)-7.5)<1e-10;
    const ok3 = (Number(id('w3').value)===-3);
    const score=(ok1?1:0)+(ok2?1:0)+(ok3?1:0);
    id('warmFb').textContent = score===3 ? '✅ Great start!' : `Score: ${score}/3`;
    id('w1').style.borderColor=ok1?'#22c55e':'#ef4444';
    id('w2').style.borderColor=ok2?'#22c55e':'#ef4444';
    id('w3').style.borderColor=ok3?'#22c55e':'#ef4444';
    if(score===3) confetti();
  });
  id('warmReset').addEventListener('click',()=>{['w1','w2','w3'].forEach(x=>{id(x).value=''; id(x).style.borderColor='#e5e7eb'}); id('warmFb').textContent='';});

  /* ------------------------- Place Value Lens ------------------------- */
  const pvState={x:246.38,u:0.01};
  function newPV(){
    const sign=Math.random()<0.2?-1:1;
    const int = Math.floor(Math.random()*900)+100; // 100..999
    const dp = Math.floor(Math.random()*3)+1;      // 1..3
    const frac = Math.floor(Math.random()*(10**dp));
    pvState.x = sign*(int + frac/10**dp);
    renderPV();
  }
  function decPlacesFromUnit(u){ if(u>=1) return 0; const p = Math.round(Math.log10(1/u)); return Math.max(0,p); }
  function renderPV(){
    const [whole, frac=''] = Math.abs(pvState.x).toString().split('.');
    const sign = pvState.x<0 ? '−' : '';
    const u = Number(id('pvPlace').value);
    pvState.u = u;
    let display='';
    if(u>=1){
      const idx = whole.length - Math.log10(u) - 1;
      const ridx = Math.round(idx);
      for(let j=0;j<whole.length;j++){
        const cls = (j===ridx)?'bg-yellow-200 tok':'tok';
        display += `<span class="${cls}">${whole[j]}</span>`;
      }
      if(frac.length) display += `<span class="tok">.</span>${[...frac].map(c=>`<span class="tok">${c}</span>`).join('')}`;
    }else{
      const need = decPlacesFromUnit(u);
      for(let j=0;j<whole.length;j++){ display += `<span class="tok">${whole[j]}</span>`}
      display += `<span class="tok">.</span>`;
      for(let j=0;j<Math.max(frac.length,need+1);j++){
        const d = frac[j] || '0';
        const cls = (j===need-1)?'bg-yellow-200 tok':'tok';
        display += `<span class="${cls}">${d}</span>`;
      }
    }
    id('pvNumber').innerHTML = `${sign}${display}`;
    const y = roundHalfUpToUnit(pvState.x, u);
    id('pvResult').textContent = fmtToUnit(y,u).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    renderMath(id('placeSlide'));
  }
  id('pvPlace').addEventListener('change',renderPV);
  id('pvNew').addEventListener('click',newPV);
  id('pvCheck').addEventListener('click',()=>{
    const pred=Number((id('pvPred').value||'').replace(/,/g,''));
    const want = roundHalfUpToUnit(pvState.x,pvState.u);
    const ok = Math.abs(pred-want)<1e-10;
    id('pvFb').textContent = ok? '✅ Matched! Explain why in the box.' : `❌ Not yet. Expected ${fmtToUnit(want,pvState.u)}`;
    id('pvFb').className='mt-2 h-6 font-semibold ' + (ok?'text-green-700':'text-red-700');
    if(ok) confetti();
  });
  id('pvSave').addEventListener('click',()=>{
    const text = `PV Explain: ${id('pvExplain').value||''}`;
    saveToNB(text); alert('Saved to notebook.');
  });
  id('pvExportCSV').addEventListener('click',()=>downloadCSV(`${deckTitle}_placevalue.csv`, [['x','unit','result'], [pvState.x, pvState.u, fmtToUnit(roundHalfUpToUnit(pvState.x,pvState.u),pvState.u)]]));
  id('pvExportJSON').addEventListener('click',()=>downloadJSON(`${deckTitle}_placevalue.json`, pvState));
  newPV();

  /* ------------------------- Number Line ------------------------- */
  const cL=id('roundLine'); const lineX=id('lineX'), lineUnit=id('lineUnit'), lineOut=id('lineOut');
  const lineState={x:23.47,u:0.1};
  function drawRoundLine(){
    const ctx=cL.getContext('2d'); cL.width=cL.clientWidth*devicePixelRatio; cL.height=cL.clientHeight*devicePixelRatio; ctx.scale(devicePixelRatio,devicePixelRatio);
    const y=cL.clientHeight/2, m=28; ctx.clearRect(0,0,cL.clientWidth,cL.clientHeight);
    ctx.lineWidth=2; ctx.strokeStyle='#6C1D45'; ctx.beginPath(); ctx.moveTo(m,y); ctx.lineTo(cL.clientWidth-m,y); ctx.stroke();
    const u=lineState.u, x=lineState.x;
    const r=roundHalfUpToUnit(x,u);
    const left = Math.floor((x-4*u)/u)*u;
    ctx.font='12px Inter'; ctx.fillStyle='#555';
    for(let k=0;k<=10;k++){
      const val = left + k*u;
      const px = map(val);
      ctx.beginPath(); ctx.moveTo(px,y-10); ctx.lineTo(px,y+10); ctx.stroke();
      if(k%2===0){ ctx.fillText(fmtToUnit(val,u), px-12, y+26); }
    }
    const low = r - u/2, high = r + u/2;
    ctx.strokeStyle='#C7A34F'; ctx.setLineDash([6,4]); ctx.beginPath(); ctx.moveTo(map(low),y-30); ctx.lineTo(map(low),y+30); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(map(high),y-30); ctx.lineTo(map(high),y+30); ctx.stroke(); ctx.setLineDash([]);
    ctx.fillStyle='#6C1D45'; ctx.beginPath(); ctx.arc(map(x),y,8,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#C7A34F'; ctx.beginPath(); ctx.arc(map(r),y,9,0,Math.PI*2); ctx.fill();
    lineOut.textContent = fmtToUnit(r,u);
    function map(val){const W=cL.clientWidth;return m+(val-(left))*((W-2*m)/(10*u));}
  }
  lineX.addEventListener('input',()=>{ lineState.x=Number(lineX.value); drawRoundLine(); });
  lineUnit.addEventListener('change',()=>{ lineState.u=Number(lineUnit.value); drawRoundLine(); });
  id('lineRand').addEventListener('click',()=>{ lineState.x = +(Math.random()*200-100).toFixed(3); lineX.value=lineState.x; drawRoundLine(); });
  function downloadLine(){ return {x:lineState.x,unit:lineState.u,rounded:roundHalfUpToUnit(lineState.x,lineState.u)}}
  id('lineExportCSV').addEventListener('click',()=>downloadCSV(`${deckTitle}_line.csv`, [['x','unit','rounded'], [lineState.x,lineState.u,fmtToUnit(roundHalfUpToUnit(lineState.x,lineState.u),lineState.u)]]));
  id('lineExportJSON').addEventListener('click',()=>downloadJSON(`${deckTitle}_line.json`, downloadLine()));
  drawRoundLine();
  window.addEventListener('resize',()=>{ if(slides[i].id==='lineSlide') drawRoundLine(); });

  /* ------------------------- Practice Generator (multi-set) ------------------------- */
  const prState={sets:[]};
  function taskUnit(x,unit,label){ return {type:'unit', prompt:`Round ${x} to ${label}`, x, unit, label, ans: roundHalfUpToUnit(x,unit), fmt:fmtToUnit(roundHalfUpToUnit(x,unit),unit)};}
  function taskSig(x,n){const ans=roundToSig(x,n); return {type:'sig', prompt:`Round ${x} to ${n} s.f.`, x, n, ans, fmt:ans.toPrecision(n)};}
  function prMakeItem(lv){
    if(lv==='easy'){
      const a = Math.floor(Math.random()*900)+100;
      const unit = Math.random()<0.5?10:100;
      return taskUnit(a,unit, unit===10?'nearest 10':'nearest 100');
    }else if(lv==='med'){
      const x = +( (Math.random()*200-100).toFixed(Math.random()<0.5?1:2) );
      const unit = Math.random()<0.5?0.1:0.01;
      return taskUnit(x,unit, unit===0.1?'1 dp':'2 dp');
    }else if(lv==='hard'){
      const mix = Math.random();
      if(mix<0.5){
        const unit = [0.001,0.01,0.1,1,10,100][Math.floor(Math.random()*6)];
        const x = +( (Math.random()*200-100).toFixed(unit<1?3:0) );
        const lab = unit>=1? `nearest ${unit}` : `${decPlacesFromUnit(unit)} dp`;
        return taskUnit(x,unit,lab);
      }else{
        const x = +( (Math.random()*9000-4500).toFixed(3) );
        const n = [2,3,4][Math.floor(Math.random()*3)];
        return taskSig(x,n);
      }
    }else{ // expert
      if(Math.random()<0.5){
        const x = +( (Math.random()*9000-4500).toFixed(4) );
        const n = [2,3,4][Math.floor(Math.random()*3)];
        return taskSig(x,n);
      }else{
        const unit = [0.001,0.01,0.1,1,10,100,1000][Math.floor(Math.random()*7)];
        const x = +( (Math.random()*50000-25000).toFixed(unit<1?3:0) );
        const lab = unit>=1? `nearest ${unit}` : `${decPlacesFromUnit(unit)} dp`;
        return taskUnit(x,unit,lab);
      }
    }
  }
  function prBuild(){
    const lv=id('prLevel').value;
    const nSets=Number(id('prSets').value);
    const nEach=Number(id('prCount').value);
    prState.sets=[];
    for(let s=0;s<nSets;s++){
      const items=[];
      for(let k=0;k<nEach;k++) items.push(prMakeItem(lv));
      prState.sets.push(items);
    }
    const box=id('prList'); box.innerHTML='';
    prState.sets.forEach((set,si)=>{
      const sect=document.createElement('div'); sect.className='card p-4';
      sect.innerHTML=`<div class="text-left font-semibold text-maroon">Set ${String.fromCharCode(65+si)}</div>`;
      set.forEach((o,idx)=>{
        const row=document.createElement('div'); row.className='mt-1';
        row.innerHTML=`<div class="text-xl">${o.prompt} = <input class="prin border rounded px-2 py-1 w-40" placeholder="answer" data-set="${si}" data-idx="${idx}"></div>`;
        sect.appendChild(row);
      });
      box.appendChild(sect);
    });
    id('prFb').textContent='0';
  }
  id('prNew').addEventListener('click',prBuild); prBuild();
  id('prCheck').addEventListener('click',()=>{
    let ok=0, total=0;
    id('prList').querySelectorAll('.prin').forEach(inp=>{
      const si=+inp.dataset.set, idx=+inp.dataset.idx; const item=prState.sets[si][idx];
      const v = Number((inp.value||'').replace(/,/g,''));
      const good = Math.abs(v-item.ans)<1e-10;
      inp.style.borderColor = good? '#22c55e':'#ef4444';
      ok += good?1:0; total++;
    });
    id('prFb').textContent = `${ok}/${total}`;
    if(ok===total && total>0) confetti();
  });
  id('prExportCSV').addEventListener('click',()=>{
    const rows=[['set','prompt','answer']]; prState.sets.forEach((set,si)=>set.forEach(o=>rows.push([String.fromCharCode(65+si),o.prompt,o.fmt||o.ans]))); downloadCSV(`${deckTitle}_practice.csv`, rows);
  });
  id('prExportJSON').addEventListener('click',()=>downloadJSON(`${deckTitle}_practice.json`, prState.sets));

  /* ------------------------- Significant Figures ------------------------- */
  const sigCState={sets:[]}, sigRState={sets:[]};
  function genSigCount(){
    const nSets=Number(id('sigCountSets').value);
    const pool=['0.00340','1200','1200.','5.060','0.0702','30007','2.90','0.0005','40','40.0','1.0020','2500.0'];
    sigCState.sets=[]; const box=id('sigCountList'); box.innerHTML='';
    for(let s=0;s<nSets;s++){
      const items = pool.sort(()=>Math.random()-0.5).slice(0,4).map(s=>({s,ans:countSigStr(s)}));
      sigCState.sets.push(items);
      const sect=document.createElement('div'); sect.className='card p-3';
      sect.innerHTML=`<div class="text-left font-semibold text-maroon">Set ${String.fromCharCode(65+s)}</div>`;
      items.forEach((o,idx)=>{
        const row=document.createElement('div'); row.className='text-xl mt-1';
        row.innerHTML=`\\( ${o.s} \\) has <input class="scin border rounded px-2 py-1 w-20" placeholder="s.f." data-set="${s}" data-idx="${idx}"> s.f.`;
        sect.appendChild(row);
      });
      box.appendChild(sect);
    }
    renderMath(id('sigSlide'));
    id('sigCountFb').textContent='0';
  }
  function genSigRound(){
    const nSets=Number(id('sigRoundSets').value);
    sigRState.sets=[]; const box=id('sigRoundList'); box.innerHTML='';
    for(let s=0;s<nSets;s++){
      const items=[];
      for(let k=0;k<4;k++){
        const x = +( (Math.random()*9000-1000).toFixed(4) );
        const n=[2,3,4][Math.floor(Math.random()*3)];
        const ans = roundToSig(x,n);
        items.push({x,n,ans,fmt:ans.toPrecision(n)});
      }
      sigRState.sets.push(items);
      const sect=document.createElement('div'); sect.className='card p-3';
      sect.innerHTML=`<div class="text-left font-semibold text-maroon">Set ${String.fromCharCode(65+s)}</div>`;
      items.forEach((o,idx)=>{
        const row=document.createElement('div'); row.className='text-xl mt-1';
        row.innerHTML=`Round \\( ${o.x} \\) to ${o.n} s.f. = <input class="srin border rounded px-2 py-1 w-40" placeholder="answer" data-set="${s}" data-idx="${idx}">`;
        sect.appendChild(row);
      });
      box.appendChild(sect);
    }
    renderMath(id('sigSlide'));
    id('sigRoundFb').textContent='0';
  }
  id('sigCountNew').addEventListener('click',genSigCount);
  id('sigRoundNew').addEventListener('click',genSigRound);
  genSigCount(); genSigRound();
  id('sigCountCheck').addEventListener('click',()=>{
    let ok=0,total=0; document.querySelectorAll('.scin').forEach(inp=>{
      const s=+inp.dataset.set, idx=+inp.dataset.idx; const want=sigCState.sets[s][idx].ans; const got=Number(inp.value);
      const good = got===want; inp.style.borderColor=good?'#22c55e':'#ef4444'; ok+=good?1:0; total++;
    });
    id('sigCountFb').textContent = `${ok}/${total}`; if(ok===total && total>0) confetti();
  });
  id('sigRoundCheck').addEventListener('click',()=>{
    let ok=0,total=0; document.querySelectorAll('.srin').forEach(inp=>{
      const s=+inp.dataset.set, idx=+inp.dataset.idx; const want=sigRState.sets[s][idx].ans; const got=Number(inp.value);
      const good=Math.abs(got-want)<1e-10; inp.style.borderColor=good?'#22c55e':'#ef4444'; ok+=good?1:0; total++;
    });
    id('sigRoundFb').textContent = `${ok}/${total}`; if(ok===total && total>0) confetti();
  });
  id('sigCountCSV').addEventListener('click',()=>{
    const rows=[['set','number','sig_figs']]; sigCState.sets.forEach((set,si)=>set.forEach(o=>rows.push([String.fromCharCode(65+si),o.s,o.ans]))); downloadCSV(`${deckTitle}_sig_count.csv`, rows);
  });
  id('sigCountJSON').addEventListener('click',()=>downloadJSON(`${deckTitle}_sig_count.json`, sigCState.sets));
  id('sigRoundCSV').addEventListener('click',()=>{
    const rows=[['set','x','n_sf','answer']]; sigRState.sets.forEach((set,si)=>set.forEach(o=>rows.push([String.fromCharCode(65+si),o.x,o.n,o.fmt]))); downloadCSV(`${deckTitle}_sig_round.csv`, rows);
  });
  id('sigRoundJSON').addEventListener('click',()=>downloadJSON(`${deckTitle}_sig_round.json`, sigRState.sets));

  /* ------------------------- Scientific Notation ------------------------- */
  const sciState={sets:[]};
  function sciNew(){
    const nSets=Number(id('sciSets').value); sciState.sets=[]; const box=id('sciList'); box.innerHTML='';
    for(let s=0;s<nSets;s++){
      const list=[];
      for(let k=0;k<4;k++){
        const e = Math.floor(Math.random()*7)-3; // -3..3
        const m = +( (Math.random()*9+1).toFixed(4) ); // 1..10
        const n=[2,3,4][Math.floor(Math.random()*3)];
        const r=sciRound(m,e,n);
        list.push({m,e,n,ans:r});
      }
      sciState.sets.push(list);
      const sect=document.createElement('div'); sect.className='card p-4';
      sect.innerHTML=`<div class="text-left font-semibold text-maroon">Set ${String.fromCharCode(65+s)}</div>`;
      list.forEach((o,idx)=>{
        const row=document.createElement('div'); row.className='text-xl mt-1';
        row.innerHTML=`Round \\( ${o.m}\\times 10^{${o.e}} \\) to ${o.n} s.f.: mantissa = <input class="sciin border rounded px-2 py-1 w-20" placeholder="m" data-set="${s}" data-idx="${idx}">, exponent = <input class="sciexp border rounded px-2 py-1 w-20" placeholder="e" data-set="${s}" data-idx="${idx}">`;
        sect.appendChild(row);
      });
      box.appendChild(sect);
    }
    renderMath(id('sciSlide'));
    id('sciFb').textContent='0';
  }
  id('sciNew').addEventListener('click',sciNew); sciNew();
  id('sciCheck').addEventListener('click',()=>{
    let ok=0,total=0; document.querySelectorAll('.sciin').forEach(mIn=>{
      const s=+mIn.dataset.set, idx=+mIn.dataset.idx;
      const eIn=document.querySelector(`.sciexp[data-set="${s}"][data-idx="${idx}"]`);
      const item=sciState.sets[s][idx];
      const m=Number(mIn.value), e=Number(eIn.value);
      const good= Math.abs(m-item.ans.m)<1e-10 && e===item.ans.e;
      mIn.style.borderColor=eIn.style.borderColor = good?'#22c55e':'#ef4444';
      ok+=good?1:0; total++;
    });
    id('sciFb').textContent = `${ok}/${total}`; if(ok===total && total>0) confetti();
  });
  id('sciCSV').addEventListener('click',()=>{
    const rows=[['set','m','e','n_sf','m_ans','e_ans']]; sciState.sets.forEach((set,si)=>set.forEach(o=>rows.push([String.fromCharCode(65+si),o.m,o.e,o.n,o.ans.m,o.ans.e]))); downloadCSV(`${deckTitle}_scientific.csv`, rows);
  });
  id('sciJSON').addEventListener('click',()=>downloadJSON(`${deckTitle}_scientific.json`, sciState.sets));

  /* ------------------------- Bounds ------------------------- */
  const bdState={sets:[]};
  function bdNew(){
    const nSets=Number(id('bdSets').value);
    bdState.sets=[]; const box=id('bdList'); box.innerHTML='';
    for(let s=0;s<nSets;s++){
      const list=[];
      for(let k=0;k<4;k++){
        const unit=[0.001,0.01,0.1,1,10,100][Math.floor(Math.random()*6)];
        const x = +( (Math.random()*1000-500).toFixed(unit<1?3:0) );
        const r = roundHalfUpToUnit(x,unit);
        const lb = r - unit/2, ub = r + unit/2;
        const label = unit>=1? `nearest ${unit}` : `${decPlacesFromUnit(unit)} dp`;
        list.push({r,unit,lb,ub,label});
      }
      bdState.sets.push(list);
      const sect=document.createElement('div'); sect.className='card p-4';
      sect.innerHTML=`<div class="text-left font-semibold text-maroon">Set ${String.fromCharCode(65+s)}</div>`;
      list.forEach((o,idx)=>{
        const dp=decPlacesFromUnit(o.unit);
        const row=document.createElement('div'); row.className='mt-1';
        row.innerHTML=`A measurement is reported as <b>${fmtToUnit(o.r,o.unit)}</b> (${o.label}). Give bounds for \(x\): Lower <input class="bdlb border rounded px-2 py-1 w-28" placeholder="${(o.lb).toFixed(dp)}" data-set="${s}" data-idx="${idx}">, Upper <input class="bdub border rounded px-2 py-1 w-28" placeholder="${(o.ub).toFixed(dp)}" data-set="${s}" data-idx="${idx}">`;
        sect.appendChild(row);
      });
      box.appendChild(sect);
    }
    renderMath(id('boundSlide'));
    id('bdFb').textContent='0';
  }
  id('bdNew').addEventListener('click',bdNew); bdNew();
  id('bdCheck').addEventListener('click',()=>{
    let ok=0,total=0; document.querySelectorAll('.bdlb').forEach(lb=>{
      const s=+lb.dataset.set, idx=+lb.dataset.idx;
      const ub=document.querySelector(`.bdub[data-set="${s}"][data-idx="${idx}"]`);
      const item=bdState.sets[s][idx];
      const gl=Math.abs(Number(lb.value)-item.lb)<1e-10, gu=Math.abs(Number(ub.value)-item.ub)<1e-10;
      lb.style.borderColor=gl?'#22c55e':'#ef4444'; ub.style.borderColor=gu?'#22c55e':'#ef4444';
      ok += (gl&&gu)?1:0; total++;
    });
    id('bdFb').textContent=`${ok}/${total}`; if(ok===total && total>0) confetti();
  });
  id('bdCSV').addEventListener('click',()=>{
    const rows=[['set','reported','unit','label','lower','upper']];
    bdState.sets.forEach((set,si)=>set.forEach(o=>rows.push([String.fromCharCode(65+si),fmtToUnit(o.r,o.unit),o.unit,o.label,o.lb,o.ub])));
    downloadCSV(`${deckTitle}_bounds.csv`, rows);
  });
  id('bdJSON').addEventListener('click',()=>downloadJSON(`${deckTitle}_bounds.json`, bdState.sets));

  /* ------------------------- Qatar Applications ------------------------- */
  // A) QAR cash rounding
  const qarState={items:[], unit:0.25};
  function qarNew(){
    qarState.unit=Number(id('qarUnit').value);
    // generate 5–7 random prices and quantities
    const n = Math.floor(Math.random()*3)+5;
    qarState.items=[];
    const box=id('qarList'); box.innerHTML='';
    for(let k=0;k<n;k++){
      const price=+( (Math.random()*40+5).toFixed(2) );
      const qty = Math.floor(Math.random()*3)+1;
      const row=document.createElement('div');
      row.innerHTML = `Item ${k+1}: QAR ${price.toFixed(2)} × ${qty}`;
      qarState.items.push({price,qty});
      box.appendChild(row);
    }
    id('qarFb').textContent='';
    id('qarAns').value='';
  }
  id('qarUnit').addEventListener('change',()=>{ qarState.unit=Number(id('qarUnit').value); });
  id('qarNew').addEventListener('click',qarNew);
  id('qarCheck').addEventListener('click',()=>{
    const unit=qarState.unit;
    const exact= qarState.items.reduce((s,it)=>s+it.price*it.qty,0);
    const rounded= roundHalfUpToUnit(exact, unit);
    const v= Number((id('qarAns').value||'').replace(/[^0-9.]/g,''));
    const ok=Math.abs(v-rounded)<1e-10;
    id('qarFb').textContent = ok? `✅ Correct. Exact = QAR ${exact.toFixed(2)}, Rounded (unit ${unit}) = QAR ${rounded.toFixed(2)}` : `❌ Try again. Hint: first find exact sum, then round to ${unit} QAR.`;
    id('qarFb').className='mt-2 h-6 font-semibold ' + (ok?'text-green-700':'text-red-700');
    if(ok) confetti();
  });
  if(!qarState.items.length) qarNew();

  // B) Doha Metro timing
  const metroState={items:[]};
  function metroNew(){
    const n=4; metroState.items=[]; const box=id('metroList'); box.innerHTML='';
    for(let k=0;k<n;k++){
      // generate a decimal minute like 12.3, 19.8, etc.
      const t=+( (Math.random()*28+6).toFixed(1) ); // 6.0..34.0
      const row=document.createElement('div'); row.innerHTML = `Trip ${k+1}: ${t} minutes → nearest minute: <input class="met border rounded px-2 py-1 w-20" data-idx="${k}" placeholder="min">`;
      metroState.items.push({t,ans:roundHalfUpToUnit(t,1)});
      box.appendChild(row);
    }
    id('metroFb').textContent='';
  }
  id('metroNew').addEventListener('click',metroNew);
  id('metroCheck').addEventListener('click',()=>{
    let ok=0,total=0; document.querySelectorAll('.met').forEach(inp=>{
      const idx=+inp.dataset.idx; const want=metroState.items[idx].ans; const got=Number(inp.value);
      const good=Math.abs(got-want)<1e-10; inp.style.borderColor=good?'#22c55e':'#ef4444'; ok+=good?1:0; total++;
    });
    id('metroFb').textContent = `${ok}/${total}`; if(ok===total && total>0) confetti();
  });

  // C) Distances & crowds
  const qatCtxState={items:[]};
  function qatCtxNew(){
    qatCtxState.items=[]; const box=id('qatCtxList'); box.innerHTML='';
    // Two distances (km to 1 dp)
    for(let k=0;k<2;k++){
      const d=+( (Math.random()*120+1).toFixed(2) ); // km
      const row=document.createElement('div'); row.className='card p-3';
      row.innerHTML=`Distance ${k+1}: ${d} km → 1 dp: <input class="qatd border rounded px-2 py-1 w-24" data-idx="${k}" placeholder="km">`;
      qatCtxState.items.push({type:'dist', val:d, ans: roundHalfUpToUnit(d,0.1)});
      box.appendChild(row);
    }
    // Two crowd counts (nearest thousand)
    for(let k=0;k<2;k++){
      const c = Math.floor(Math.random()*50000)+30000; // 30k..80k
      const row=document.createElement('div'); row.className='card p-3';
      row.innerHTML=`Crowd ${k+1}: ${fmtThousands(c)} → nearest thousand: <input class="qatc border rounded px-2 py-1 w-28" data-idx="${k}" placeholder="people">`;
      qatCtxState.items.push({type:'crowd', val:c, ans: roundHalfUpToUnit(c,1000)});
      box.appendChild(row);
    }
    id('qatCtxFb').textContent='';
  }
  id('qatCtxNew').addEventListener('click',qatCtxNew);
  id('qatCtxCheck').addEventListener('click',()=>{
    let ok=0,total=0;
    document.querySelectorAll('.qatd').forEach(inp=>{
      const idx=+inp.dataset.idx; const item=qatCtxState.items[idx];
      const good=Math.abs(Number(inp.value)-item.ans)<1e-10; inp.style.borderColor=good?'#22c55e':'#ef4444'; ok+=good?1:0; total++;
    });
    document.querySelectorAll('.qatc').forEach(inp=>{
      // index offset by 2
      const idx=+inp.dataset.idx + 2; const item=qatCtxState.items[idx];
      const good=Math.abs(Number(inp.value)-item.ans)<1e-10; inp.style.borderColor=good?'#22c55e':'#ef4444'; ok+=good?1:0; total++;
    });
    id('qatCtxFb').textContent=`${ok}/${total}`; if(ok===total && total>0) confetti();
  });

  /* ------------------------- Challenge Mode (unchanged core, but integrates bounds) ------------------------- */
  const chState={cur:null, streak:0, history:[]};
  function chNew(){
    const lv=id('chLevel').value;
    let prompt='', ans=null;
    const r = Math.random();
    if(lv==='easy'){
      const x = Math.floor(Math.random()*900)+100, unit=10;
      ans = roundHalfUpToUnit(x,unit);
      prompt = `Round ${x} to the nearest 10`;
    }else if(lv==='med'){
      const x = +( (Math.random()*200-100).toFixed(2) ); const dp=1;
      ans = roundToDP(x,dp); prompt=`Round ${x} to ${dp} dp`;
    }else if(lv==='hard'){
      if(r<0.5){ const x=+( (Math.random()*9000-3000).toFixed(3) ); const n=[2,3,4][Math.floor(Math.random()*3)]; ans=roundToSig(x,n); prompt=`Round ${x} to ${n} s.f.`; }
      else { const unit=[0.01,0.1,1,10,100][Math.floor(Math.random()*5)]; const x=+( (Math.random()*2000-1000).toFixed(unit<1?2:0) ); ans=roundHalfUpToUnit(x,unit); prompt=`Round ${x} to ${unit>=1? 'nearest '+unit : decPlacesFromUnit(unit)+' dp'}`; }
    }else{ // expert
      if(r<0.33){ const e=Math.floor(Math.random()*7)-3; const m=+( (Math.random()*9+1).toFixed(4) ); const n=[2,3,4][Math.floor(Math.random()*3)]; const rr=sciRound(m,e,n); ans=rr.m*10**rr.e; prompt=`Round ${m}×10^${e} to ${n} s.f. (enter numeric value)`; }
      else if(r<0.66){ const unit=[0.001,0.01,0.1,1,10,100][Math.floor(Math.random()*6)]; const r0=+( (Math.random()*1000-500).toFixed(unit<1?3:0) ); const rr=roundHalfUpToUnit(r0,unit); const lb=rr-unit/2; ans=lb; prompt=`Given value rounded to ${unit>=1?'nearest '+unit: decPlacesFromUnit(unit)+' dp'} is ${fmtToUnit(rr,unit)}. Enter the <lower bound>.`; }
      else { const x=+( (Math.random()*9000-1000).toFixed(4) ); const n=[2,3,4][Math.floor(Math.random()*3)]; ans=roundToSig(x,n); prompt=`Round ${x} to ${n} s.f.`; }
    }
    chState.cur={prompt,ans}; id('chText').textContent=prompt; id('chAns').value=''; id('chFb').textContent=''; id('chHintBox').textContent=''; renderMath(id('challengeSlide'));
  }
  id('chNew').addEventListener('click',chNew); chNew();
  id('chHint').addEventListener('click',()=>{ id('chHintBox').innerHTML=`<div class="hint">Use half‑up rounding. For bounds: interval is \\([r-\\tfrac{u}{2},\\; r+\\tfrac{u}{2})\\).</div>`; renderMath(id('challengeSlide')); });
  id('chCheck').addEventListener('click',()=>{
    const got=Number(id('chAns').value), want=chState.cur.ans;
    const ok = Math.abs(got-want)<1e-10;
    if(ok){ chState.streak++; id('chFb').textContent='✅ Correct!'; id('chFb').className='mt-2 h-6 font-semibold text-green-700'; confetti(); chState.history.push({prompt:chState.cur.prompt, answer:want, correct:true}); chNew(); }
    else { chState.streak=0; id('chFb').textContent='❌ Not quite. Expected '+want; id('chFb').className='mt-2 h-6 font-semibold text-red-700'; chState.history.push({prompt:chState.cur.prompt, answer:want, correct:false}); }
    id('streakOut').textContent=chState.streak;
  });
  id('chCSV').addEventListener('click',()=>{
    const rows=[['prompt','answer','correct']]; chState.history.forEach(h=>rows.push([h.prompt,h.answer,h.correct])); downloadCSV(`${deckTitle}_challenge.csv`, rows);
  });
  id('chJSON').addEventListener('click',()=>downloadJSON(`${deckTitle}_challenge.json`, chState.history));

  /* ------------------------- Exit ticket save ------------------------- */
  id('exitSave').addEventListener('click',()=>{
    const text = `Exit Ticket:\n${id('exitText').value||''}`;
    saveToNB(text); alert('Saved to notebook.');
  });

  /* ------------------------- Teacher Notes Toggle (press T) ------------------------- */
  function toggleTeach(){ document.querySelectorAll('.teach').forEach(x=>x.classList.toggle('on')); }
  // Add a small tip on LO slide for toggling
  const tn=document.createElement('div'); tn.className='text-xs text-gray-500 mt-1'; tn.textContent='(Press T to toggle Teacher Notes)';
  id('loSlide').appendChild(tn);

  /* ------------------------- Init ------------------------- */
  window.addEventListener('resize',()=>{ if(slides[i].id==='lineSlide') drawRoundLine(); });
  // Pre-activity quick save buttons
  id('nbSaveWhy')?.addEventListener('click',()=>{ const t=id('nbPromptWhy').value||''; if(t.trim()){ saveToNB(`Why rounding: ${t}`); alert('Saved to notebook.'); }});
  show(0);

})();
</script>
</body>
</html>
