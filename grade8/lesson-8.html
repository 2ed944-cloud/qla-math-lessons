<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>G8 • Unit 2 • Angle Facts — Complementary, Supplementary, Vertical & Adjacent</title>

<!-- Fonts & Tailwind -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<!-- KaTeX -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>
<script>
  // KaTeX auto-render
  window.addEventListener('DOMContentLoaded', () => {
    const run = (root = document.body) => {
      if (!window.renderMathInElement) return;
      window.renderMathInElement(root, {
        delimiters: [
          { left: '$$', right: '$$', display: true },
          { left: '\\[', right: '\\]', display: true },
          { left: '\\(', right: '\\)', display: false }
        ],
        throwOnError: false
      });
    };
    if (window.renderMathInElement) run();
    else {
      const t = setInterval(() => { if (window.renderMathInElement) { clearInterval(t); run(); } }, 25);
      setTimeout(() => clearInterval(t), 6000);
    }
    window._rerenderMath = run;
  });
</script>

<style>
  :root{--maroon:#6C1D45;--gold:#C7A34F;--dark:#2C2C2E;--light:#F5F5F5;--accent:#E8D5B7}
  html,body{height:100%;background:#2d3748;color:#111;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  #deck{position:relative;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;padding:10px}
  #slides{position:relative;width:100%;max-width:1280px;aspect-ratio:16/9;background:#fff;box-shadow:0 14px 36px rgba(0,0,0,.35);overflow:hidden;border-radius:18px}
  .slide{position:absolute;inset:0;padding:3.5%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;opacity:0;transform:translateY(14px) scale(.985);transition:.55s ease;pointer-events:none}
  .slide.active{opacity:1;transform:none;pointer-events:auto}
  .bg-maroon{background-color:var(--maroon)} .text-maroon{color:var(--maroon)} .text-gold{color:var(--gold)}
  .banner{width:100%;height:120px;background:#fff center/contain no-repeat;border-bottom:3px solid var(--gold);border-radius:10px}
  .card{border:1px solid #e5e7eb;border-radius:14px;background:#fafafa}
  .chip{display:inline-flex;align-items:center;gap:.5rem;background:rgba(0,0,0,.05);border-radius:9999px;padding:.35rem .75rem;cursor:pointer}
  .chip:hover{outline:2px solid var(--gold)}
  .pill{display:inline-flex;align-items:center;gap:.35rem;border:1px solid #e5e7eb;border-radius:999px;padding:.35rem .75rem;background:#fff;cursor:pointer}
  .pill.active{border-color:#22c55e;box-shadow:0 0 0 2px rgba(34,197,94,.15)}
  .btn{padding:.55rem 1rem;border-radius:999px;border:1px solid #e5e7eb;background:#fff;font-weight:700}
  .btn.maroon{background:var(--maroon);color:#fff;border-color:var(--maroon)}
  .btn:hover{filter:brightness(0.98)}
  #controls{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:.5rem;background:rgba(0,0,0,.55);padding:.4rem .6rem;border-radius:999px;z-index:20;backdrop-filter:blur(6px)}
  #controls button{width:42px;height:42px;border-radius:999px;border:none;background:#fff;cursor:pointer;font-weight:700}
  #controls button:hover{transform:scale(1.06)}
  #counter{color:#fff;font-weight:700;min-width:84px;text-align:center}
  #progress{position:fixed;left:0;bottom:0;height:5px;width:0;background:var(--gold);z-index:30;transition:width .35s ease}
  #fsHint{position:absolute;top:10px;right:12px;color:#fff;background:rgba(0,0,0,.35);padding:.25rem .5rem;border-radius:8px;font-size:.8rem}
  #pop{position:fixed;inset:auto auto 20px 20px;max-width:min(560px,90vw);background:#fff;border:2px solid var(--gold);border-radius:12px;box-shadow:0 12px 28px rgba(0,0,0,.25);padding:14px 16px;z-index:40;display:none;text-align:left}
  #pop strong{color:var(--maroon)} #pop .close{float:right;color:#666;cursor:pointer;font-weight:800}
  .hint{background:#fff3cd;border:1px solid #ffe69c;border-radius:10px;padding:.5rem .75rem}
  .workline{padding:.25rem .5rem;border-left:4px solid var(--gold);margin:.3rem 0;background:#fff}
  .confetti{position:fixed;pointer-events:none;z-index:50}
  #partNav{position:fixed;top:18px;left:18px;z-index:35;display:flex;gap:.4rem;background:rgba(255,255,255,.85);padding:.35rem;border-radius:999px;border:2px solid var(--gold);backdrop-filter:blur(4px)}
  #partNav button{font-weight:800}
  /* SVG label styles */
  .svg-dim{fill:#0f172a;font-weight:700}
  .svg-note{fill:#6b7280;font-size:12px}
  /* Polygon canvas */
  #polyCanvas{width:100%;max-width:820px;height:420px;border-radius:12px;background:linear-gradient(180deg,#fff,#fafafa);border:2px solid #ececec}
</style>
</head>
<body>

<div id="deck" aria-live="polite">
  <div id="slides" class="relative">
    <div id="fsHint">Press <strong>F</strong> for fullscreen</div>

    <!-- 0 • Title -->
    <section class="slide active bg-maroon text-white">
      <div class="w-full h-16 banner mb-6 rounded-md" style="background-image:url('qla_banner.png')" aria-label="QLA Partner Banner"></div>
      <div class="flex items-center gap-8">
        <img src="qla_logo.png" alt="QLA Logo" class="h-24 w-auto" onerror="this.style.display='none'"/>
        <div class="text-left">
          <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight">Unit 2 — Geometry of Polygons</h1>
          <p class="text-gold text-2xl md:text-3xl mt-2 font-semibold">Angle Facts: Complementary, Supplementary, Vertical & Adjacent</p>
          <p class="mt-2 text-lg">Qatar Leadership Academy — Grade 8</p>
        </div>
      </div>
      <div class="absolute bottom-6 text-sm text-gray-100">Aligned to AERO 8.G foundations &amp; 8.EE connections.</div>
    </section>

    <!-- ──────────────────────────────── PART 1 ──────────────────────────────── -->
    <!-- 1 • Part 1: LO & Keywords -->
    <section class="slide" id="p1Intro">
      <h2 class="text-4xl font-extrabold text-maroon mb-2">Part 1 — Angle Vocabulary & Relationships</h2>
      <div class="grid md:grid-cols-2 gap-6 text-left max-w-5xl">
        <div class="card p-5">
          <h3 class="text-2xl font-bold text-maroon mb-1">Learning Outcomes (P1)</h3>
          <ul class="list-disc list-inside space-y-1 text-lg">
            <li>Define and identify <strong>adjacent</strong>, <strong>vertical</strong>, <strong>complementary</strong>, <strong>supplementary</strong> angles and <strong>linear pairs</strong>.</li>
            <li>Use angle‑sum facts: \(90^\circ\), \(180^\circ\), and angles around a point \(360^\circ\).</li>
            <li>Classify angle pairs and find missing measures.</li>
          </ul>
        </div>
        <div class="card p-5">
          <h3 class="text-2xl font-bold text-maroon mb-1">Keywords (tap for definitions)</h3>
          <div class="flex flex-wrap gap-2 text-lg">
            <span class="chip" data-key="adj">adjacent</span>
            <span class="chip" data-key="vert">vertical</span>
            <span class="chip" data-key="comp">complementary</span>
            <span class="chip" data-key="supp">supplementary</span>
            <span class="chip" data-key="lp">linear pair</span>
            <span class="chip" data-key="around">angles around a point</span>
          </div>
          <p class="text-xs text-gray-500 mt-3">Click a keyword to view a quick definition.</p>
        </div>
      </div>
    </section>

    <!-- 2 • Angle Builder -->
    <section class="slide" id="builderSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Angle Builder</h2>
      <div class="card p-5 w-full max-w-5xl text-left">
        <div class="flex flex-wrap items-center gap-3 mb-3 text-sm">
          <label class="chip">Angle \(A\): <input id="angA" type="range" min="5" max="175" value="40" class="w-56"> <span id="angALabel" class="ml-1 font-bold">40°</span></label>
          <span class="pill">Complement \(=90^\circ-A\): <b id="compOut">50°</b></span>
          <span class="pill">Supplement \(=180^\circ-A\): <b id="suppOut">140°</b></span>
          <span class="pill">Linear‑pair partner: <b id="lpOut">140°</b></span>
          <span class="pill">Vertical to \(A\): <b id="vertOut">40°</b></span>
        </div>
        <svg id="angleSvg" viewBox="0 0 760 360" aria-label="Interactive angle canvas"></svg>
        <div class="hint mt-3 text-sm">Drag the slider. Complementary angles sum to \(90^\circ\), supplementary/linear‑pairs to \(180^\circ\), and vertical angles are equal.</div>
      </div>
    </section>

    <!-- 3 • Classify Angle Pairs (corrected; 2 big items) -->
    <section class="slide" id="classifySlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Classify Angle Pairs</h2>
      <div class="flex items-center gap-3 mb-2">
        <span>Level:</span>
        <select id="clfLevel" class="border rounded px-2 py-1">
          <option value="easy" selected>easy</option>
          <option value="med">medium</option>
          <option value="hard">hard</option>
        </select>
        <button id="clfNew" class="btn">New set</button>
        <button id="clfCheck" class="btn maroon">Check</button>
        <button id="clfExportCSV" class="btn">Export CSV</button>
        <button id="clfExportJSON" class="btn">Export JSON</button>
      </div>
      <div id="clfList" class="grid md:grid-cols-2 gap-4 w-full max-w-5xl"></div>
      <div id="clfFb" class="mt-2 h-6 font-semibold"></div>
    </section>

    <!-- 4 • Find the Missing Angle (4 items, with diagrams) -->
    <section class="slide" id="missSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Find the Missing Angle</h2>
      <div class="flex items-center gap-3 mb-2">
        <span>Level:</span>
        <select id="missLevel" class="border rounded px-2 py-1">
          <option value="easy" selected>easy</option>
          <option value="med">medium</option>
          <option value="hard">hard</option>
        </select>
        <button id="missNew" class="btn">New set</button>
        <button id="missCheck" class="btn maroon">Check</button>
        <button id="missExportCSV" class="btn">Export CSV</button>
        <button id="missExportJSON" class="btn">Export JSON</button>
      </div>
      <div id="missList" class="grid md:grid-cols-2 gap-4 w-full max-w-5xl"></div>
      <div id="missFb" class="mt-2 h-6 font-semibold"></div>
    </section>

    <!-- 5 • Part 1 Real‑Life (4 items with small diagrams) -->
    <section class="slide" id="p1RealSlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Part 1 Real‑Life Mini‑Tasks</h2>
      <div class="flex items-center gap-3 mb-2">
        <span>Level:</span>
        <select id="p1RealLevel" class="border rounded px-2 py-1">
          <option value="easy" selected>easy</option>
          <option value="med">medium</option>
          <option value="hard">hard</option>
        </select>
        <button id="p1RealNew" class="btn">New set</button>
        <button id="p1RealCheck" class="btn maroon">Check</button>
        <button id="p1RealExportCSV" class="btn">Export CSV</button>
        <button id="p1RealExportJSON" class="btn">Export JSON</button>
      </div>
      <div id="p1RealList" class="grid md:grid-cols-2 gap-4 w-full max-w-5xl"></div>
      <div id="p1RealFb" class="mt-2 h-6 font-semibold"></div>
    </section>

    <!-- ──────────────────────────────── PART 3 (Polygon) ───────────────────── -->
    <!-- 10 • Part 3: LO & Keywords -->
    <section class="slide" id="p3Intro">
      <h2 class="text-4xl font-extrabold text-maroon mb-2">Part 3 — Polygons: Interior & Exterior Angles</h2>
      <div class="grid md:grid-cols-2 gap-6 text-left max-w-5xl">
        <div class="card p-5">
          <h3 class="text-2xl font-bold text-maroon mb-1">Learning Outcomes (P3)</h3>
          <ul class="list-disc list-inside space-y-1 text-lg">
            <li>Use \(S=(n-2)\\cdot 180^\circ\) to find interior angle sums.</li>
            <li>For regular polygons, compute one interior and one exterior angle; use exterior sum \(=360^\circ\).</li>
            <li>Explain why the exterior turns of any convex polygon sum to \(360^\circ\).</li>
          </ul>
        </div>
        <div class="card p-5">
          <h3 class="text-2xl font-bold text-maroon mb-1">Keywords (tap for definitions)</h3>
          <div class="flex flex-wrap gap-2 text-lg">
            <span class="chip" data-key="poly">polygon</span>
            <span class="chip" data-key="reg">regular polygon</span>
            <span class="chip" data-key="sum">interior sum</span>
            <span class="chip" data-key="ext">exterior angle</span>
          </div>
        </div>
      </div>
    </section>

    <!-- 11 • Polygon Explorer (visual upgraded) -->
    <section class="slide" id="polySlide">
      <h2 class="text-3xl font-extrabold text-maroon mb-2">Polygon Explorer</h2>
      <div class="card p-5 w-full max-w-5xl text-left">
        <div class="flex flex-wrap items-center gap-3 mb-3">
          <label class="chip">Sides \(n\): <input id="polyN" type="range" min="3" max="14" value="6" class="w-64"> <b id="polyNLabel">6</b></label>
          <span class="pill">Interior Sum: <b id="polySum">720°</b></span>
          <span class="pill">Regular \(\\angle_{\\text{int}}\): <b id="polyInt">120°</b></span>
          <span class="pill">Regular \(\\angle_{\\text{ext}}\): <b id="polyExt">60°</b></span>
          <label class="pill"><input id="triToggle" type="checkbox" class="mr-2"> Show triangulation</label>
          <label class="pill"><input id="extToggle" type="checkbox" checked class="mr-2"> Show exterior turns</label>
          <button id="polyWalk" class="btn">Animate walk</button>
          <button id="polyPNG" class="btn">Export PNG</button>
        </div>
        <svg id="polyCanvas" viewBox="0 0 820 420" aria-label="Polygon canvas"></svg>
        <div class="hint mt-3 text-sm">
          Slide \(n\). Each exterior turn is \(360^\circ/n\); the “turtle walk” animation demonstrates the \(360^\circ\) sum.
        </div>
      </div>
    </section>

    <!-- 19 • Exit Ticket -->
    <section class="slide" id="exitSlide">
      <h2 class="text-4xl font-extrabold text-maroon mb-2">Exit Ticket</h2>
      <div class="grid md:grid-cols-2 gap-6 text-left max-w-5xl">
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon">3–2–1 Reflect</h3>
          <ul class="list-disc list-inside">
            <li>3 angle facts you can use instantly</li>
            <li>2 algebra steps you must show when solving</li>
            <li>1 polygon insight that surprised you</li>
          </ul>
        </div>
        <div class="card p-5">
          <h3 class="text-xl font-bold text-maroon">Up Next</h3>
          <p>Parallel lines & transversals; triangle angle sum proofs; similarity previews.</p>
        </div>
      </div>
      <div class="absolute bottom-4 left-1/2 -translate-x-1/2 w-[88%] h-[110px] banner rounded-md" style="background-image:url('qla_banner.png')"></div>
    </section>

  </div>
</div>

<!-- Controls -->
<div id="controls" role="group" aria-label="Slideshow controls">
  <button id="prev" title="Previous (←)">&laquo;</button>
  <button id="fs" title="Toggle Fullscreen (F)">⤢</button>
  <div id="counter">1 / 8</div>
  <button id="next" title="Next (→)">&raquo;</button>
</div>
<div id="progress"></div>

<!-- Part Navigator -->
<div id="partNav" aria-label="Part navigator">
  <button id="navP1" class="btn">Part&nbsp;1</button>
  <button id="navP3" class="btn">Part&nbsp;3</button>
  <button id="navExit" class="btn">Exit</button>
</div>

<!-- Glossary popover -->
<div id="pop" role="dialog" aria-modal="true" aria-live="polite">
  <span class="close" title="Close">✕</span>
  <div id="popBody"></div>
</div>

<script>
/* ---------- Core shell & helpers ---------- */
(function(){
  const slides=[...document.querySelectorAll('.slide')];
  const prev=id('prev'), next=id('next'), counter=id('counter'), progress=id('progress'), fsBtn=id('fs');
  let i=0;

  function show(k){
    i=(k+slides.length)%slides.length;
    slides.forEach((s,idx)=>s.classList.toggle('active',idx===i));
    counter.textContent=(i+1)+' / '+slides.length;
    progress.style.width=((i+1)/slides.length*100)+'%';
    renderMath(slides[i]);
    if(slides[i].id==='builderSlide') drawAngle();
    if(slides[i].id==='polySlide') drawPolygon();
  }
  prev.addEventListener('click',()=>show(i-1));
  next.addEventListener('click',()=>show(i+1));
  document.addEventListener('keydown',e=>{
    if(e.key==='ArrowRight') show(i+1);
    if(e.key==='ArrowLeft') show(i-1);
    if(e.key.toLowerCase()==='f') toggleFS();
  });
  function toggleFS(){
    const el=id('slides');
    if(!document.fullscreenElement){(el.requestFullscreen||el.webkitRequestFullscreen||el.msRequestFullscreen).call(el);}
    else{(document.exitFullscreen||document.webkitExitFullscreen||document.msExitFullscreen).call(el);}
  }
  fsBtn.addEventListener('click',toggleFS);

  /* Part Navigator */
  id('navP1').addEventListener('click',()=>{ const n=slides.findIndex(s=>s.id==='p1Intro'); if(n>=0) show(n);});
  id('navP3').addEventListener('click',()=>{ const n=slides.findIndex(s=>s.id==='p3Intro'); if(n>=0) show(n);});
  id('navExit').addEventListener('click',()=>{ const n=slides.findIndex(s=>s.id==='exitSlide'); if(n>=0) show(n);});

  function id(x){return document.getElementById(x)}
  function renderMath(root=document){ if(window._rerenderMath) window._rerenderMath(root); }
  function confetti(x=window.innerWidth/2,y=window.innerHeight/2){
    for(let k=0;k<18;k++){
      const d=document.createElement('div'); d.className='confetti';
      d.style.left=x+'px'; d.style.top=y+'px'; d.style.width='8px'; d.style.height='8px';
      d.style.background=['#6C1D45','#C7A34F','#E8D5B7','#8a3d64'][k%4];
      document.body.appendChild(d);
      const dx=(Math.random()*2-1)*240, dy=(Math.random()*-1-0.3)*300, rot=Math.random()*720;
      d.animate([{transform:'translate(0,0) rotate(0deg)'},{transform:`translate(${dx}px,${dy}px) rotate(${rot}deg)`,opacity:0}],
                {duration:900+Math.random()*700,easing:'cubic-bezier(.2,.8,.2,1)'}).onfinish=()=>d.remove();
    }
  }

  function downloadJSON(filename, data){
    const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download=filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }
  function downloadCSV(filename, rows){
    const csv=rows.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
    const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download=filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }

  /* ---------- Glossary ---------- */
  const POP=id('pop'), POP_BODY=id('popBody');
  const GLOS={
    adj:'<strong>Adjacent</strong>: share a common vertex and side; interiors do not overlap.',
    vert:'<strong>Vertical (opposite) angles</strong>: formed by two intersecting lines; opposite angles are equal.',
    comp:'<strong>Complementary</strong>: two angles whose measures sum to \\(90^\\circ\\). They need not be adjacent.',
    supp:'<strong>Supplementary</strong>: two angles whose measures sum to \\(180^\\circ\\).',
    lp:'<strong>Linear pair</strong>: adjacent angles that form a straight line (sum \\(180^\\circ\\)).',
    around:'<strong>Angles around a point</strong>: sum to \\(360^\\circ\\).',
    poly:'<strong>Polygon</strong>: closed figure with straight sides.',
    reg:'<strong>Regular polygon</strong>: all sides and interior angles equal.',
    sum:'<strong>Interior sum</strong>: \\(S=(n-2)\\cdot180^\\circ\\).',
    ext:'<strong>Exterior angle</strong>: for a regular \\(n\\)-gon, each exterior angle is \\(360^\\circ/n\\).',
  };
  function showPop(html,anchor){
    POP_BODY.innerHTML=html; POP.style.display='block';
    const r=anchor?anchor.getBoundingClientRect():{left:20,top:window.innerHeight-120};
    POP.style.left=Math.min(r.left, window.innerWidth-POP.offsetWidth-20)+'px';
    POP.style.bottom=(window.innerHeight - r.top + 10)+'px';
  }
  POP.querySelector('.close').addEventListener('click',()=>POP.style.display='none');
  document.addEventListener('click',e=>{
    const el=e.target.closest('.chip[data-key]'); if(el){const key=el.dataset.key; if(GLOS[key]) showPop(GLOS[key], el);}
  });

  /* ---------- Math helpers ---------- */
  const d2r = d => d*Math.PI/180;
  const r2d = r => r*180/Math.PI;

  /* ---------- Angle Builder ---------- */
  const svgAB = id('angleSvg');
  const angA = id('angA'), angALabel=id('angALabel'), compOut=id('compOut'), suppOut=id('suppOut'), lpOut=id('lpOut'), vertOut=id('vertOut');
  function drawAngle(){
    const A = Number(angA.value);
    angALabel.textContent = A+'°';
    compOut.textContent = (90-A>0? (90-A)+'°' : '—');
    const supp = 180-A; suppOut.textContent = supp+'°'; lpOut.textContent=supp+'°'; vertOut.textContent=A+'°';
    // draw
    svgAB.innerHTML='';
    const W=760,H=360,cx=380,cy=200,r=120;
    // axes lines
    const base1=[cx,cy, cx+180,cy], base2=[cx,cy, cx-180,cy], cross=[cx,cy, cx+180*Math.cos(d2r(A)), cy-180*Math.sin(d2r(A))];
    line(svgAB,base2,'#999',1.5); line(svgAB,base1,'#6C1D45',2.2);
    line(svgAB,cross,'#C7A34F',2.2);
    // arc for A
    arc(svgAB,cx,cy,r,0,A,'#C7A34F',4);
    label(svgAB,cx+ (r+24)*Math.cos(d2r(A/2)), cy- (r+24)*Math.sin(d2r(A/2)), 'A = '+A+'°', '#6C1D45');
    // linear pair arc
    arc(svgAB,cx,cy,r-22,A,180,'#bbb',2,'4 4');
    label(svgAB,cx+ (r+8)*Math.cos(d2r((A+180)/2)), cy- (r+8)*Math.sin(d2r((A+180)/2)), 'linear pair', '#555',10);
    // vertical indication (dashed opposite ray)
    line(svgAB,[cx,cy, cx-180*Math.cos(d2r(A)), cy+180*Math.sin(d2r(A))],'#aaa',1.5,'4 4');
    // vertex dot
    circle(svgAB,cx,cy,3,'#333');
  }
  function line(S,[x1,y1,x2,y2],stroke,w, dash){
    const L=document.createElementNS('http://www.w3.org/2000/svg','line');
    L.setAttribute('x1',x1); L.setAttribute('y1',y1); L.setAttribute('x2',x2); L.setAttribute('y2',y2);
    L.setAttribute('stroke',stroke); L.setAttribute('stroke-width',w||2);
    if(dash) L.setAttribute('stroke-dasharray',dash);
    S.appendChild(L);
  }
  function circle(S,x,y,r,fill){ const C=document.createElementNS('http://www.w3.org/2000/svg','circle'); C.setAttribute('cx',x); C.setAttribute('cy',y); C.setAttribute('r',r); C.setAttribute('fill',fill); S.appendChild(C); }
  function arc(S,cx,cy,r,a0,a1,stroke,w,dash){
    const A0=d2r(a0), A1=d2r(a1);
    const x0=cx+r*Math.cos(A0), y0=cy-r*Math.sin(A0);
    const x1=cx+r*Math.cos(A1), y1=cy-r*Math.sin(A1);
    const large = (a1-a0)>180 ? 1:0;
    const P=document.createElementNS('http://www.w3.org/2000/svg','path');
    P.setAttribute('d',`M${x0},${y0} A${r},${r} 0 ${large} 0 ${x1},${y1}`);
    P.setAttribute('fill','none'); P.setAttribute('stroke',stroke); P.setAttribute('stroke-width',w||3);
    if(dash) P.setAttribute('stroke-dasharray',dash);
    S.appendChild(P);
  }
  function label(S,x,y,txt,c,fs){ const T=document.createElementNS('http://www.w3.org/2000/svg','text'); T.setAttribute('x',x); T.setAttribute('y',y); T.setAttribute('fill',c||'#000'); T.setAttribute('font-size',fs||12); T.setAttribute('text-anchor','middle'); T.textContent=txt; S.appendChild(T); }
  angA.addEventListener('input',drawAngle);

  /* ---------- PART 1: CLASSIFY (correct, 2 big items) ---------- */
  const TYPES=['complementary','supplementary','vertical','adjacent','linear pair','neither'];
  function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
  function choice(arr){ return arr[rand(0,arr.length-1)] }

  // SVG helpers for classify/missing
  function arcPath(x,y,r,a0,a1){
    const x0=x+r*Math.cos(d2r(a0)), y0=y-r*Math.sin(d2r(a0));
    const x1=x+r*Math.cos(d2r(a1)), y1=y-r*Math.sin(d2r(a1));
    const large = ((a1-a0+360)%360)>180 ? 1:0;
    return `M${x0},${y0} A${r},${r} 0 ${large} 0 ${x1},${y1}`;
  }
  function sectorPath(x,y,r,a0,a1){ return `M${x},${y} ${arcPath(x,y,r,a0,a1).slice(1)} Z`; }

  const clfState={items:[]};
  const CLF_COUNT=2, CLF_W=460, CLF_H=240;
  function makeClassAngles(type){
    let a,b;
    if(type==='complementary'){ a=rand(15,75); b=90-a; }
    else if(type==='linear pair'){ a=rand(20,160); if(a===90) a+=1; b=180-a; }
    else if(type==='supplementary'){ a=rand(25,155); if(a===90) a+=1; b=180-a; }
    else if(type==='vertical'){ a=rand(25,140); b=a; }
    else if(type==='adjacent'){ do{ a=rand(25,70); b=rand(25,70);} while(a+b===90 || a+b===180); }
    else { do{ a=rand(20,120); b=rand(20,120);} while(a===b || a+b===90 || a+b===180); }
    return {a,b};
  }
  function svgPairHTML(type, A, B){
    const cx=CLF_W/2, cy=140, R=84;
    let g='';
    const base = `<line x1="${40}" y1="${cy}" x2="${CLF_W-40}" y2="${cy}" stroke="#6C1D45" stroke-width="2.6"/>`;
    if(type==='linear pair'){
      const a=A, b=180-A;
      g += base;
      g += `<path d="${sectorPath(cx,cy,R-6,0,a)}" fill="rgba(199,163,79,.22)"/>`;
      g += `<path d="${arcPath(cx,cy,R-6,0,a)}" fill="none" stroke="#C7A34F" stroke-width="3"/>`;
      g += `<path d="${arcPath(cx,cy,R-6,a,180)}" fill="none" stroke="#6C1D45" stroke-width="3"/>`;
      g += `<text x="${cx+(R+16)*Math.cos(d2r(a/2))}" y="${cy-(R+16)*Math.sin(d2r(a/2))}" class="svg-dim" text-anchor="middle">${a}°</text>`;
      g += `<text x="${cx+(R-6)*Math.cos(d2r((a+180)/2))}" y="${cy-(R-6)*Math.sin(d2r((a+180)/2))}" class="svg-dim" text-anchor="middle">${b}°</text>`;
      g += `<text x="${CLF_W-12}" y="${CLF_H-12}" class="svg-note" text-anchor="end">Linear pair</text>`;
    } else if(type==='supplementary'){
      const Lx=cx-130, Rx=cx+130, a=A, b=B;
      g += `<line x1="${Lx-70}" y1="${cy}" x2="${Lx+70}" y2="${cy}" stroke="#6C1D45" stroke-width="2.4"/>`;
      g += `<line x1="${Rx-70}" y1="${cy}" x2="${Rx+70}" y2="${cy}" stroke="#6C1D45" stroke-width="2.4"/>`;
      g += `<path d="${sectorPath(Lx,cy,R-10,0,a)}" fill="rgba(199,163,79,.22)"/>`;
      g += `<path d="${arcPath(Lx,cy,R-10,0,a)}" fill="none" stroke="#C7A34F" stroke-width="3"/>`;
      g += `<path d="${sectorPath(Rx,cy,R-10,0,b)}" fill="rgba(108,29,69,.10)"/>`;
      g += `<path d="${arcPath(Rx,cy,R-10,0,b)}" fill="none" stroke="#6C1D45" stroke-width="3"/>`;
      g += `<text x="${Lx+(R+16)*Math.cos(d2r(a/2))}" y="${cy-(R+16)*Math.sin(d2r(a/2))}" class="svg-dim" text-anchor="middle">${a}°</text>`;
      g += `<text x="${Rx+(R+16)*Math.cos(d2r(b/2))}" y="${cy-(R+16)*Math.sin(d2r(b/2))}" class="svg-dim" text-anchor="middle">${b}°</text>`;
      g += `<text x="${CLF_W-12}" y="${CLF_H-12}" class="svg-note" text-anchor="end">Supplementary (not adjacent)</text>`;
    } else if(type==='complementary'){
      const a=A, b=B;
      g += base + `<line x1="${cx}" y1="${cy}" x2="${cx}" y2="${cy-110}" stroke="#6C1D45" stroke-width="2.6"/>`;
      g += `<path d="M${cx+18},${cy} L${cx+18},${cy-18} L${cx},${cy-18}" stroke="#94a3b8" stroke-width="2" fill="none"/>`; // right-angle marker
      g += `<path d="${sectorPath(cx,cy,R-8,0,a)}" fill="rgba(199,163,79,.22)"/>`;
      g += `<path d="${arcPath(cx,cy,R-8,0,a)}" fill="none" stroke="#C7A34F" stroke-width="3"/>`;
      g += `<path d="${sectorPath(cx,cy,R-18,a,90)}" fill="rgba(108,29,69,.10)"/>`;
      g += `<path d="${arcPath(cx,cy,R-18,a,90)}" fill="none" stroke="#6C1D45" stroke-width="3"/>`;
      g += `<text x="${cx+(R+16)*Math.cos(d2r(a/2))}" y="${cy-(R+16)*Math.sin(d2r(a/2))}" class="svg-dim" text-anchor="middle">${a}°</text>`;
      g += `<text x="${cx+(R-6)*Math.cos(d2r((a+90)/2))}" y="${cy-(R-6)*Math.sin(d2r((a+90)/2))}" class="svg-dim" text-anchor="middle">${b}°</text>`;
      g += `<text x="${CLF_W-12}" y="${CLF_H-12}" class="svg-note" text-anchor="end">Complementary</text>`;
    } else if(type==='adjacent'){
      const a=A, b=B;
      g += base;
      g += `<path d="${sectorPath(cx,cy,R-8,0,a)}" fill="rgba(199,163,79,.22)"/>`;
      g += `<path d="${arcPath(cx,cy,R-8,0,a)}" fill="none" stroke="#C7A34F" stroke-width="3"/>`;
      g += `<path d="${arcPath(cx,cy,R-14,a,a+b)}" fill="none" stroke="#6C1D45" stroke-width="3"/>`;
      g += `<text x="${cx+(R+16)*Math.cos(d2r(a/2))}" y="${cy-(R+16)*Math.sin(d2r(a/2))}" class="svg-dim" text-anchor="middle">${a}°</text>`;
      g += `<text x="${cx+(R-6)*Math.cos(d2r(a+b/2))}" y="${cy-(R-6)*Math.sin(d2r(a+b/2))}" class="svg-dim" text-anchor="middle">${b}°</text>`;
      g += `<text x="${CLF_W-12}" y="${CLF_H-12}" class="svg-note" text-anchor="end">Adjacent</text>`;
    } else if(type==='vertical'){
      const acute=A;
      const theta=acute/2, Llen=210;
      function lineAt(ang){
        return `<line x1="${cx-Llen*Math.cos(d2r(ang))}" y1="${cy+Llen*Math.sin(d2r(ang))}"
                      x2="${cx+Llen*Math.cos(d2r(ang))}" y2="${cy-Llen*Math.sin(d2r(ang))}" stroke="#6C1D45" stroke-width="2.6"/>`;
      }
      g += lineAt(theta) + lineAt(-theta);
      const a0=-theta, a1=theta, b0=a0+180, b1=a1+180;
      g += `<path d="${arcPath(cx,cy,R-8,a0,a1)}" fill="none" stroke="#C7A34F" stroke-width="3"/>`;
      g += `<path d="${arcPath(cx,cy,R-8,b0,b1)}" fill="none" stroke="#C7A34F" stroke-width="3"/>`;
      g += `<path d="${sectorPath(cx,cy,R-8,a0,a1)}" fill="rgba(199,163,79,.18)"/>`;
      g += `<path d="${sectorPath(cx,cy,R-8,b0,b1)}" fill="rgba(199,163,79,.18)"/>`;
      const mid1=(a0+a1)/2, mid2=(b0+b1)/2;
      g += `<text x="${cx+(R+16)*Math.cos(d2r(mid1))}" y="${cy-(R+16)*Math.sin(d2r(mid1))}" class="svg-dim" text-anchor="middle">${acute}°</text>`;
      g += `<text x="${cx+(R+16)*Math.cos(d2r(mid2))}" y="${cy-(R+16)*Math.sin(d2r(mid2))}" class="svg-dim" text-anchor="middle">${acute}°</text>`;
      g += `<text x="${CLF_W-12}" y="${CLF_H-12}" class="svg-note" text-anchor="end">Vertical</text>`;
    } else {
      const Lx=cx-130, Rx=cx+130, a=A, b=B;
      g += `<line x1="${Lx-70}" y1="${cy}" x2="${Lx+70}" y2="${cy}" stroke="#6C1D45" stroke-width="2.4"/>`;
      g += `<line x1="${Rx-70}" y1="${cy}" x2="${Rx+70}" y2="${cy}" stroke="#6C1D45" stroke-width="2.4"/>`;
      g += `<path d="${arcPath(Lx,cy,R-10,0,Math.min(150,a))}" fill="none" stroke="#C7A34F" stroke-width="3"/>`;
      g += `<path d="${arcPath(Rx,cy,R-10,180,180+Math.min(150,b))}" fill="none" stroke="#6C1D45" stroke-width="3"/>`;
      g += `<text x="${Lx+(R+16)*Math.cos(d2r(Math.min(150,a)/2))}" y="${cy-(R+16)*Math.sin(d2r(Math.min(150,a)/2))}" class="svg-dim" text-anchor="middle">${a}°</text>`;
      g += `<text x="${Rx+(R+16)*Math.cos(d2r(180+Math.min(150,b)/2))}" y="${cy-(R+16)*Math.sin(d2r(180+Math.min(150,b)/2))}" class="svg-dim" text-anchor="middle">${b}°</text>`;
      g += `<text x="${CLF_W-12}" y="${CLF_H-12}" class="svg-note" text-anchor="end">Neither</text>`;
    }
    return `<svg width="${CLF_W}" height="${CLF_H}" viewBox="0 0 ${CLF_W} ${CLF_H}">
      <rect x="0" y="0" width="${CLF_W}" height="${CLF_H}" rx="16" fill="#fff"/>
      ${g}
    </svg>`;
  }
  function buildClassifyPrompt(type, lv){
    const {a,b}=makeClassAngles(type);
    const fig=svgPairHTML(type,a,b);
    const question = `<div class="mt-2 text-sm text-gray-700">Which relationship best describes the two highlighted angles?</div>`;
    if(lv==='hard' && Math.random()<0.28)
      return fig + ` <div class="hint mt-2">Reminder: complementary angles need not be adjacent.</div>` + question;
    return fig + question;
  }
  function clfNew(){
    const lv=id('clfLevel').value; clfState.items=[]; const box=id('clfList'); box.innerHTML='';
    for(let k=0;k<CLF_COUNT;k++){
      const t=choice(TYPES); const prompt=buildClassifyPrompt(t, lv);
      clfState.items.push({t, prompt});
      const row=document.createElement('div'); row.className='card p-5 text-left';
      row.innerHTML=`<div class="text-maroon font-semibold mb-2 text-lg">Item ${k+1}</div>
        <div class="mb-3">${prompt}</div>
        <div class="flex flex-wrap gap-2 text-sm">
          ${TYPES.map(s=>`<label class="pill"><input type="radio" name="clf_${k}" value="${s}" class="mr-1">${s}</label>`).join('')}
        </div>`;
      box.appendChild(row);
    }
  }
  function clfCheck(){
    let ok=0;
    [...id('clfList').children].forEach((row,idx)=>{
      const sel=[...row.querySelectorAll('input[type="radio"]')].find(x=>x.checked)?.value||'';
      const want=clfState.items[idx].t;
      row.style.borderColor=(sel===want)?'#22c55e':'#ef4444';
      if(sel===want) ok++;
    });
    id('clfFb').textContent = ok===clfState.items.length ? '✅ All correct!' : `Score: ${ok}/${clfState.items.length}`;
    if(ok===clfState.items.length) confetti();
  }
  id('clfNew').addEventListener('click',clfNew); clfNew();
  id('clfCheck').addEventListener('click',clfCheck);
  id('clfExportCSV').addEventListener('click',()=>{
    const rows=[['prompt','correct','user']];
    [...id('clfList').children].forEach((row,idx)=>{
      const user=[...row.querySelectorAll('input[type="radio"]')].find(x=>x.checked)?.value||'';
      rows.push([row.children[1].innerText.trim(), clfState.items[idx].t, user]);
    });
    downloadCSV(`G8_U2_Angle_Facts_P1_classify.csv`, rows);
  });
  id('clfExportJSON').addEventListener('click',()=>{
    const data=[...id('clfList').children].map((row,idx)=>({
      prompt:row.children[1].innerText.trim(),
      correct:clfState.items[idx].t,
      user:[...row.querySelectorAll('input[type="radio"]')].find(x=>x.checked)?.value||''
    }));
    downloadJSON(`G8_U2_Angle_Facts_P1_classify.json`, data);
  });

  /* ---------- PART 1: Missing‑angle (4 items) with diagrams ---------- */
  const missState={items:[]};
  const MISS_COUNT=4, MW=460, MH=240;
  function buildMissing(kind, lv){
    if(kind==='comp'){
      const a=rand(10,80); return {prompt:`Find the complement of <b>${a}°</b>.`, ans:90-a, draw:()=>svgRightAngle(a)};
    } else if(kind==='supp'){
      const a=rand(30,170); return {prompt:`∠1 forms a linear pair with ∠2. If \(m∠1=${a}°\), find \(m∠2\).`, ans:180-a, draw:()=>svgLinearPair(a,180-a)};
    } else if(kind==='vert'){
      const a=rand(20,160); return {prompt:`Two lines intersect. If \(m∠A=${a}°\), find its vertical angle.`, ans:a, draw:()=>svgVertical(a)};
    } else if(kind==='lp'){
      const a=rand(25,155); return {prompt:`Adjacent ∠X and ∠Y form a straight line. If \(m∠X=${a}°\), find \(m∠Y\).`, ans:180-a, draw:()=>svgLinearPair(a,180-a)};
    } else {
      const a=rand(40,140), b=rand(40,140), c=rand(40,140); const d=360-(a+b+c);
      return {prompt:`Angles around a point: ${a}°, ${b}°, ${c}°, and ∠? . Find ∠?.`, ans:d, draw:()=>svgAround(a,b,c,d)};
    }
  }
  function svgRightAngle(a){
    const cx=MW/2, cy=140, R=84, b=90-a;
    return `<svg width="${MW}" height="${MH}" viewBox="0 0 ${MW} ${MH}">
      <rect x="0" y="0" width="${MW}" height="${MH}" rx="16" fill="#fff"/>
      <line x1="${40}" y1="${cy}" x2="${MW-40}" y2="${cy}" stroke="#6C1D45" stroke-width="2.6"/>
      <line x1="${cx}" y1="${cy}" x2="${cx}" y2="${cy-110}" stroke="#6C1D45" stroke-width="2.6"/>
      <path d="M${cx+18},${cy} L${cx+18},${cy-18} L${cx},${cy-18}" stroke="#94a3b8" stroke-width="2" fill="none"/>
      <path d="${sectorPath(cx,cy,R-8,0,a)}" fill="rgba(199,163,79,.22)"/>
      <path d="${arcPath(cx,cy,R-8,0,a)}" fill="none" stroke="#C7A34F" stroke-width="3"/>
      <path d="${arcPath(cx,cy,R-18,a,90)}" fill="none" stroke="#6C1D45" stroke-width="3"/>
      <text x="${cx+(R+16)*Math.cos(d2r(a/2))}" y="${cy-(R+16)*Math.sin(d2r(a/2))}" class="svg-dim" text-anchor="middle">${a}°</text>
      <text x="${MW-12}" y="${MH-12}" class="svg-note" text-anchor="end">Complementary</text>
    </svg>`;
  }
  function svgLinearPair(a,b){
    const cx=MW/2, cy=140, R=84;
    return `<svg width="${MW}" height="${MH}" viewBox="0 0 ${MW} ${MH}">
      <rect x="0" y="0" width="${MW}" height="${MH}" rx="16" fill="#fff"/>
      <line x1="${40}" y1="${cy}" x2="${MW-40}" y2="${cy}" stroke="#6C1D45" stroke-width="2.6"/>
      <path d="${sectorPath(cx,cy,R-8,0,a)}" fill="rgba(199,163,79,.22)"/>
      <path d="${arcPath(cx,cy,R-8,0,a)}" fill="none" stroke="#C7A34F" stroke-width="3"/>
      <path d="${arcPath(cx,cy,R-12,a,180)}" fill="none" stroke="#6C1D45" stroke-width="3"/>
      <text x="${cx+(R+16)*Math.cos(d2r(a/2))}" y="${cy-(R+16)*Math.sin(d2r(a/2))}" class="svg-dim" text-anchor="middle">${a}°</text>
      <text x="${MW-12}" y="${MH-12}" class="svg-note" text-anchor="end">Linear pair</text>
    </svg>`;
  }
  function svgVertical(a){
    const cx=MW/2, cy=140, R=84, theta=a/2, Llen=210;
    function lineAt(ang){ return `<line x1="${cx-Llen*Math.cos(d2r(ang))}" y1="${cy+Llen*Math.sin(d2r(ang))}" x2="${cx+Llen*Math.cos(d2r(ang))}" y2="${cy-Llen*Math.sin(d2r(ang))}" stroke="#6C1D45" stroke-width="2.6"/>`; }
    const a0=-theta, a1=theta, b0=a0+180, b1=a1+180;
    return `<svg width="${MW}" height="${MH}" viewBox="0 0 ${MW} ${MH}">
      <rect x="0" y="0" width="${MW}" height="${MH}" rx="16" fill="#fff"/>
      ${lineAt(theta)} ${lineAt(-theta)}
      <path d="${arcPath(cx,cy,R-8,a0,a1)}" fill="none" stroke="#C7A34F" stroke-width="3"/>
      <path d="${arcPath(cx,cy,R-8,b0,b1)}" fill="none" stroke="#C7A34F" stroke-width="3"/>
      <path d="${sectorPath(cx,cy,R-8,a0,a1)}" fill="rgba(199,163,79,.18)"/>
      <path d="${sectorPath(cx,cy,R-8,b0,b1)}" fill="rgba(199,163,79,.18)"/>
      <text x="${cx+(R+16)*Math.cos(d2r((a0+a1)/2))}" y="${cy-(R+16)*Math.sin(d2r((a0+a1)/2))}" class="svg-dim" text-anchor="middle">${a}°</text>
      <text x="${MW-12}" y="${MH-12}" class="svg-note" text-anchor="end">Vertical</text>
    </svg>`;
  }
  function svgAround(a,b,c,d){
    const cx=MW/2, cy=130, R=78;
    const cuts=[a,a+b,a+b+c,a+b+c+d];
    const arcs=cuts.map((v,i)=>[i?cuts[i-1]:0, v]);
    function wedge(a0,a1,fill,stroke){ return `<path d="${sectorPath(cx,cy,R,a0,a1)}" fill="${fill}"/><path d="${arcPath(cx,cy,R,a0,a1)}" fill="none" stroke="${stroke}" stroke-width="3"/>`; }
    let g='';
    const fills=['rgba(199,163,79,.18)','rgba(108,29,69,.10)','rgba(199,163,79,.26)','rgba(108,29,69,.16)'];
    arcs.forEach((pair,idx)=>{ g+=wedge(pair[0],pair[1],fills[idx%4], idx%2? '#6C1D45':'#C7A34F'); });
    return `<svg width="${MW}" height="${MH}" viewBox="0 0 ${MW} ${MH}">
      <rect x="0" y="0" width="${MW}" height="${MH}" rx="16" fill="#fff"/>
      ${g}
      <text x="${MW-12}" y="${MH-12}" class="svg-note" text-anchor="end">Around a point</text>
    </svg>`;
  }

  function missNew(){
    const lv=id('missLevel').value; const kinds=['comp','supp','vert','around','lp'];
    missState.items=[]; const box=id('missList'); box.innerHTML='';
    // choose 4 kinds without replacement (biased to core)
    const pick=['comp','supp','lp','vert']; // ensure these appear; around may replace one at med/hard
    if(lv!=='easy' && Math.random()<.5) pick[Math.floor(Math.random()*pick.length)]='around';
    pick.forEach((kind,i)=>{
      const o=buildMissing(kind, lv); missState.items.push(o);
      const row=document.createElement('div'); row.className='card p-5 text-left';
      row.innerHTML=`<div class="text-maroon font-semibold mb-2 text-lg">Item ${i+1}</div>
        <div class="grid md:grid-cols-2 gap-3 items-center">
          <div>${o.draw()}</div>
          <div>
            <div class="mb-2">${o.prompt}</div>
            <div>Answer: <input class="minp border rounded px-2 py-1 w-28"> °</div>
          </div>
        </div>`;
      box.appendChild(row);
    });
  }
  function missCheck(){
    let ok=0;
    [...id('missList').children].forEach((row,idx)=>{
      const got=Number(row.querySelector('.minp').value); const want=missState.items[idx].ans;
      row.style.borderColor = (Math.abs(got-want)<1e-10)? '#22c55e':'#ef4444';
      if(Math.abs(got-want)<1e-10) ok++;
    });
    id('missFb').textContent = ok===missState.items.length ? '✅ Great!' : `Score: ${ok}/${missState.items.length}`;
    if(ok===missState.items.length) confetti();
  }
  id('missNew').addEventListener('click',missNew); missNew();
  id('missCheck').addEventListener('click',missCheck);
  id('missExportCSV').addEventListener('click',()=>{
    const rows=[['prompt','answer','user']];
    [...id('missList').children].forEach((row,idx)=>{
      rows.push([row.querySelector('.grid').children[1].children[0].innerText.trim(), missState.items[idx].ans, row.querySelector('.minp').value||'']);
    });
    downloadCSV(`G8_U2_Angle_Facts_P1_missing.csv`, rows);
  });
  id('missExportJSON').addEventListener('click',()=>{
    const data=[...id('missList').children].map((row,idx)=>({
      prompt:row.querySelector('.grid').children[1].children[0].innerText.trim(),
      answer:missState.items[idx].ans,
      user:row.querySelector('.minp').value||''
    }));
    downloadJSON(`G8_U2_Angle_Facts_P1_missing.json`, data);
  });

  /* ---------- Part 1 Real‑Life (4 items) ---------- */
  const p1RealState={items:[]};
  function p1RealNew(){
    const lv=id('p1RealLevel').value; p1RealState.items=[]; const box=id('p1RealList'); box.innerHTML='';
    // 1) Frame corner (complement)
    (function(){
      const a=rand(25,70), ans=90-a;
      const svg = svgRightAngle(a);
      addRealRow(box, svg, `A picture frame corner must make a right angle. If one miter cut is <b>${a}°</b> from the edge, what angle must the matching cut be?`, ans);
    })();
    // 2) Door swing to 90 (complement remaining)
    (function(){
      const a=rand(35,85), ans=90-a;
      const svg = svgRightAngle(a);
      addRealRow(box, svg, `A door opened to <b>${a}°</b>. How many more degrees to reach a right angle?`, ans);
    })();
    // 3) Wall bracket (linear pair)
    (function(){
      const a=rand(30,150), ans=180-a;
      const svg = svgLinearPair(a, 180-a);
      addRealRow(box, svg, `A wall bracket forms a straight line with a support. If the support angle is <b>${a}°</b>, find the bracket’s angle with the wall.`, ans);
    })();
    // 4) Stage lights around DJ (360)
    (function(){
      const a=rand(60,140), b=rand(40,120), c=rand(30,110); const ans=360-(a+b+c);
      const svg = svgAround(a,b,c,ans);
      addRealRow(box, svg, `Three stage spotlights make angles of ${a}°, ${b}°, ${c}° around the DJ. What angle remains to complete a full \(360^\circ\) sweep?`, ans);
    })();
  }
  function addRealRow(box, svg, text, ans){
    const row=document.createElement('div'); row.className='card p-5 text-left';
    p1RealState.items.push({ans});
    row.innerHTML=`<div class="grid md:grid-cols-2 gap-3 items-center">
      <div>${svg}</div>
      <div>
        <div>${text}</div>
        <div class="mt-2">Answer: <input class="rin border rounded px-2 py-1 w-28"> °</div>
      </div>
    </div>`;
    box.appendChild(row);
  }
  id('p1RealNew').addEventListener('click',p1RealNew); p1RealNew();
  id('p1RealCheck').addEventListener('click',()=>{
    let ok=0; [...id('p1RealList').querySelectorAll('.rin')].forEach((el,idx)=>{
      const got=Number(el.value); const want=p1RealState.items[idx].ans;
      el.style.borderColor=(Math.abs(got-want)<1e-10)? '#22c55e':'#ef4444'; if(Math.abs(got-want)<1e-10) ok++;
    });
    id('p1RealFb').textContent = ok===p1RealState.items.length? '✅ Excellent!' : `Score: ${ok}/${p1RealState.items.length}`;
    if(ok===p1RealState.items.length) confetti();
  });
  id('p1RealExportCSV').addEventListener('click',()=>{
    const rows=[['prompt','answer','user']];
    [...id('p1RealList').children].forEach((row,idx)=>rows.push([row.querySelector('.grid').children[1].children[0].innerText.trim(), p1RealState.items[idx].ans, row.querySelector('.rin').value||'']));
    downloadCSV(`G8_U2_Angle_Facts_P1_real.csv`, rows);
  });
  id('p1RealExportJSON').addEventListener('click',()=>{
    const data=[...id('p1RealList').children].map((row,idx)=>({prompt:row.querySelector('.grid').children[1].children[0].innerText.trim(), answer:p1RealState.items[idx].ans, user:row.querySelector('.rin').value||''}));
    downloadJSON(`G8_U2_Angle_Facts_P1_real.json`, data);
  });

  /* ---------- POLYGON EXPLORER (visual upgrade) ---------- */
  const polyN=id('polyN'), polyNLabel=id('polyNLabel'), polySum=id('polySum'), polyInt=id('polyInt'), polyExt=id('polyExt');
  const triToggle=id('triToggle'), extToggle=id('extToggle'), polyCanvas=id('polyCanvas');
  let walkerAnim=null;

  function regularPolygonPoints(n, cx, cy, R, startAngle=-90){
    const pts=[];
    for(let k=0;k<n;k++){
      const a=d2r(startAngle + 360*k/n);
      pts.push([cx+R*Math.cos(a), cy+R*Math.sin(a)]);
    }
    return pts;
  }
  function drawPolygon(){
    const n=Number(polyN.value); polyNLabel.textContent=n;
    const S=(n-2)*180, ext=360/n, Int=S/n;
    polySum.textContent=S+'°'; polyInt.textContent=(Math.round(Int*100)/100).toString().replace(/\.00$/,'')+'°'; polyExt.textContent=(Math.round(ext*100)/100).toString().replace(/\.00$/,'')+'°';

    const W=820,H=420,cx=W/2,cy=H/2+8,R=140;
    const pts=regularPolygonPoints(n,cx,cy,R);
    const dPts=pts.map(p=>p.join(',')).join(' ');
    const showTri=triToggle.checked, showExt=extToggle.checked;

    polyCanvas.innerHTML=`
      <defs>
        <marker id="arrow" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto">
          <path d="M0,0 L8,4 L0,8 z" fill="#6C1D45"/>
        </marker>
      </defs>
      <rect x="0" y="0" width="${W}" height="${H}" rx="12" fill="url(#grad)"/>
      <g id="polyGroup">
        <polygon points="${dPts}" fill="rgba(108,29,69,0.06)" stroke="#6C1D45" stroke-width="3" stroke-linejoin="round"/>
        ${showTri? triangulation(pts, cx, cy):''}
        ${interiorArcLabel(pts, Int)}
        ${showExt? exteriorTurns(pts, ext):''}
      </g>
      <text x="${cx}" y="${H-14}" text-anchor="middle" class="svg-note">n=${n} • S=(n−2)·180° = ${S}°</text>
    `;
  }
  function triangulation(pts, cx, cy){
    // fan triangulation from centroid
    let g=''; for(let k=0;k<pts.length;k++){
      const a=pts[k], b=pts[(k+1)%pts.length];
      g += `<polygon points="${cx},${cy} ${a[0]},${a[1]} ${b[0]},${b[1]}" fill="rgba(199,163,79,0.11)" stroke="#C7A34F" stroke-width="1.5"/>`;
    } return g;
  }
  function interiorArcLabel(pts, Int){
    // place one interior label near the first vertex
    const A=pts[0], B=pts[1], P=pts[pts.length-1];
    const v1=Math.atan2(P[1]-A[1],P[0]-A[0]), v2=Math.atan2(B[1]-A[1],B[0]-A[0]);
    const mid=(v1+v2)/2, R=34;
    const x=A[0]+R*Math.cos(mid), y=A[1]+R*Math.sin(mid);
    return `<path d="M${A[0]+18*Math.cos(v1)},${A[1]+18*Math.sin(v1)} A34,34 0 0 1 ${A[0]+18*Math.cos(v2)},${A[1]+18*Math.sin(v2)}" fill="none" stroke="#C7A34F" stroke-width="3"/>
            <text x="${x}" y="${y-6}" class="svg-dim" text-anchor="middle">${Math.round(Int)}°</text>`;
  }
  function exteriorTurns(pts, ext){
    // draw one exterior arc and optional little "turtle" arrows around
    let g=''; for(let k=0;k<pts.length;k++){
      const A=pts[k], B=pts[(k+1)%pts.length], C=pts[(k+2)%pts.length];
      const v1=Math.atan2(B[1]-A[1],B[0]-A[0]), v2=Math.atan2(C[1]-B[1],C[0]-B[0]);
      const mid=(v1+v2)/2, R=26;
      const x=B[0]+R*Math.cos(mid), y=B[1]+R*Math.sin(mid);
      // little arc at vertex B
      g+=`<path d="M${B[0]+R*Math.cos(v1)} ${B[1]+R*Math.sin(v1)} A${R},${R} 0 0 1 ${B[0]+R*Math.cos(v2)} ${B[1]+R*Math.sin(v2)}" fill="none" stroke="#6C1D45" stroke-width="2"/>`;
      if(k===1) g+=`<text x="${x}" y="${y-6}" class="svg-dim" text-anchor="middle">${Math.round(ext)}°</text>`;
    } return g;
  }
  function animateWalk(){
    if(walkerAnim){ walkerAnim.cancel(); walkerAnim=null; }
    const n=Number(polyN.value);
    const W=820,H=420,cx=W/2,cy=H/2+8,R=140;
    const pts=regularPolygonPoints(n,cx,cy,R);
    const pathD='M '+pts.map((p,i)=>`${p[0]},${p[1]}`).join(' L ')+' Z';
    const p=document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d',pathD); p.setAttribute('fill','none'); p.setAttribute('stroke','#6C1D45'); p.setAttribute('stroke-width','0');
    const totLen=p.getTotalLength();
    const cursor=document.createElementNS('http://www.w3.org/2000/svg','circle');
    cursor.setAttribute('r','6'); cursor.setAttribute('fill','#6C1D45');
    polyCanvas.appendChild(p); polyCanvas.appendChild(cursor);
    let t0=null;
    function step(ts){
      if(!t0) t0=ts; const t=(ts-t0)/1400; const dist=(t%1)*totLen;
      const pos=p.getPointAtLength(dist);
      cursor.setAttribute('cx',pos.x); cursor.setAttribute('cy',pos.y);
      walkerAnim=requestAnimationFrame(step);
    }
    walkerAnim=requestAnimationFrame(step);
    setTimeout(()=>{ if(walkerAnim){ cancelAnimationFrame(walkerAnim); walkerAnim=null; cursor.remove(); p.remove(); } }, 6000);
  }
  function exportPNG(){
    const svg=polyCanvas;
    const xml=new XMLSerializer().serializeToString(svg);
    const svg64=btoa(unescape(encodeURIComponent(xml)));
    const image64='data:image/svg+xml;base64,'+svg64;
    const img=new Image(); img.onload=()=>{
      const c=document.createElement('canvas'); c.width=820; c.height=420;
      const ctx=c.getContext('2d'); ctx.fillStyle='#ffffff'; ctx.fillRect(0,0,c.width,c.height);
      ctx.drawImage(img,0,0);
      c.toBlob(b=>{
        const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='polygon_explorer.png'; a.click();
        URL.revokeObjectURL(a.href);
      });
    }; img.src=image64;
  }
  polyN.addEventListener('input',drawPolygon);
  triToggle.addEventListener('change',drawPolygon);
  extToggle.addEventListener('change',drawPolygon);
  id('polyWalk').addEventListener('click',animateWalk);
  id('polyPNG').addEventListener('click',exportPNG);
  drawPolygon(); // initial

  /* ---------- INIT ---------- */
  window.addEventListener('resize',()=>{ if(slides[i].id==='builderSlide') drawAngle(); if(slides[i].id==='polySlide') drawPolygon(); });
  drawAngle();
  show(0);

})();
</script>
</body>
</html>
